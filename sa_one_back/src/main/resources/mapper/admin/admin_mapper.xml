<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminDashboardMapper">

    <select id="countStoreApplicationsByStatus" resultType="java.lang.Integer">
        select count
            (*)
        from
            store_application_tb
        where
            status = 'PENDING'
    </select>
    <select id="existMinimumWage" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                minimum_wage_tb
            where
                year = #{year}
        )
    </select>
    <select id="existTaxRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                tax_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existInsuranceRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                insurance_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existNationalPensionRateLimit" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                national_pension_limit_tb
            where
                year = #{year}
        )
    </select>
    <select id="existHealthInsuranceRateLimit" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                health_insurance_limit_tb
            where
                year = #{year}
        )
    </select>
    <select id="existEmploymentCompanyRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                employment_company_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existIndustrialAccidentRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                industrial_accident_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="countPendingInquiry" resultType="java.lang.Integer">
        select
            count(*)
        from
            inquiry_tb
        where
            status = 'OPEN'
    </select>
    <select id="countInProgressInquiry" resultType="java.lang.Integer">
        select
            count(*)
        from
            inquiry_tb
        where
            status = 'IN_PROGRESS'
    </select>
    <select id="selectInquiry" resultType="java.lang.Integer">
        select
            *
        from
            inquiry_tb
        where
            inquiry_id = #{inquiry_id}
    </select>
    <update id="updateInquiryStatus">
        update
            inquiry_tb
        set
            status = 'IN_PROGRESS',
            reviewed_at = now()
        where
            inquiry_id = #{inquiryId}
            and status = 'OPEN'
    </update>
</mapper>