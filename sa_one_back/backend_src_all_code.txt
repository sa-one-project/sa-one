

==================================================
FILE: src/main/java/CodeExtractor.java
==================================================

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.HashSet;
import java.util.Set;
import java.util.stream.Stream;

public class CodeExtractor {

    // 1. 추출할 대상 설정 (현재 폴더의 src)
    private static final String SRC_DIR_NAME = "src";
    private static final String OUTPUT_FILE = "backend_src_all_code.txt";

    // 2. 포함할 확장자 (백엔드 개발에 필요한 소스 코드)
    private static final Set<String> ALLOWED_EXTENSIONS = new HashSet<>(Arrays.asList(
            ".java",
            ".xml",
            ".yml",
            ".yaml",
            ".properties",
            ".sql",
            ".gradle",  // Gradle 프로젝트인 경우
            ".txt",
            ".md"
    ));

    // 3. 제외할 파일명
    private static final Set<String> IGNORE_FILES = new HashSet<>(Arrays.asList(
            "mvnw", "mvnw.cmd", ".DS_Store"
    ));

    private static int fileCount = 0;

    public static void main(String[] args) {
        Path rootPath = Paths.get(".").toAbsolutePath().normalize();
        Path srcPath = rootPath.resolve(SRC_DIR_NAME);
        File outputFile = new File(OUTPUT_FILE);

        // 기존 결과 파일이 있으면 삭제
        if (outputFile.exists()) {
            outputFile.delete();
        }

        System.out.println("--- 추출 시작 ---");

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile, StandardCharsets.UTF_8))) {

            if (!Files.exists(srcPath)) {
                System.err.println("에러: " + SRC_DIR_NAME + " 폴더를 찾을 수 없습니다.");
                return;
            }

            // 재귀적으로 파일 탐색
            processDirectory(srcPath, srcPath, writer);

            System.out.println("\n" + "=".repeat(30));
            if (fileCount > 0) {
                System.out.println("✅ 완료! 총 " + fileCount + "개의 파일이 추출되었습니다.");
                System.out.println("결과 파일: " + OUTPUT_FILE);
            } else {
                System.out.println("⚠️ 추출된 파일이 없습니다. src 폴더 위치를 확인해주세요.");
            }
            System.out.println("=".repeat(30));

        } catch (IOException e) {
            System.err.println("실행 중 에러 발생: " + e.getMessage());
            e.printStackTrace();
        }
    }

    private static void processDirectory(Path currentDir, Path rootSrcPath, BufferedWriter writer) throws IOException {
        try (Stream<Path> stream = Files.list(currentDir)) {
            stream.forEach(path -> {
                try {
                    if (Files.isDirectory(path)) {
                        processDirectory(path, rootSrcPath, writer);
                    } else {
                        extractFile(path, rootSrcPath, writer);
                    }
                } catch (IOException e) {
                    System.err.println("파일 처리 중 에러: " + path + " - " + e.getMessage());
                }
            });
        }
    }

    private static void extractFile(Path filePath, Path rootSrcPath, BufferedWriter writer) throws IOException {
        String fileName = filePath.getFileName().toString();
        String ext = "";

        int i = fileName.lastIndexOf('.');
        if (i > 0) {
            ext = fileName.substring(i).toLowerCase();
        }

        if (ALLOWED_EXTENSIONS.contains(ext) && !IGNORE_FILES.contains(fileName)) {
            // 상대 경로 계산 (src/main/java/...)
            String relativePath = SRC_DIR_NAME + File.separator + rootSrcPath.relativize(filePath).toString();

            // 윈도우의 역슬래시를 슬래시로 통일 (가독성 위해)
            relativePath = relativePath.replace("\\", "/");

            System.out.println("추출 중: " + relativePath);

            // 파일 읽기
            String content = new String(Files.readAllBytes(filePath), StandardCharsets.UTF_8);

            // 포맷에 맞춰 쓰기
            writer.write("\n\n" + "=".repeat(50) + "\n");
            writer.write("FILE: " + relativePath + "\n");
            writer.write("=".repeat(50) + "\n\n");
            writer.write(content);

            fileCount++;
        }
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/config/SecurityConfig.java
==================================================

//package com.korit.sa_one_back.config;
//
//import com.korit.sa_one_back.filter.JwtAuthenticationFilter;
//import com.korit.sa_one_back.security.JwtAuthenticationEntryPoint;
//import com.korit.sa_one_back.security.OAuth2SuccessHandler;
//import com.korit.sa_one_back.service.OAuth2UserService;
//import lombok.RequiredArgsConstructor;
//import org.springframework.context.annotation.Bean;
//import org.springframework.context.annotation.Configuration;
//import org.springframework.security.config.annotation.web.builders.HttpSecurity;
//import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
//import org.springframework.security.config.http.SessionCreationPolicy;
//import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
//import org.springframework.security.web.SecurityFilterChain;
//import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
//import org.springframework.web.cors.CorsConfiguration;
//import org.springframework.web.cors.CorsConfigurationSource;
//import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
//
//import java.util.List;
//
//@Configuration
//@EnableWebSecurity
//@RequiredArgsConstructor
//public class SecurityConfig {
//
//    private final JwtAuthenticationFilter jwtAuthenticationFilter; // IoC가 제어할 수 있는 객체
//    private final JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;
//    private final OAuth2UserService oAuth2UserService;
//    private final OAuth2SuccessHandler oAuth2SuccessHandler;
//
//    @Bean  // Security에서 꼭 세팅 필요
//    public SecurityFilterChain FilterChain(HttpSecurity http) throws Exception{
//
//        // CORS적용, 세션 비활성화, http기본 로그인 비활성화, form 로그인 비활성화, csrf 비활성화 -> csr이기때문
//
//        // 모든 세팅들은 다 람다로 들어감
//
//        // CrossOrigin 적용
//        http.cors(cors -> cors.configurationSource(corsConfigurationSource()));
//
//        // 세션 비활성화(무상태) 설정
//        http.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
//
//        // http 기본 로그인 비활성화
//        http.httpBasic(httpBasic -> httpBasic.disable());
//
//        // form 로그인 비활성화
//        http.formLogin(formLogin -> formLogin.disable());
//
//        // csrf 비활성화 ->  CSRF = 로그인된 사용자의 권한을 악용해 몰래 요청을 보내게 만드는 공격.(워터마크)
//        http.csrf(csrf -> csrf.disable());
//
//        //
//        /*
//            EndPoint호출 -> https://openapi.naver.com/v1/nid/me 호출
//
//         */
//
//        http.oauth2Login(oauth2 -> oauth2.userInfoEndpoint(userInfo -> userInfo.userService(oAuth2UserService))
//                .successHandler(oAuth2SuccessHandler));
//
//        // 특정 필터(UsernamePasswordAuthenticationFilter) 전에 직접 만든 필터(jwtAuthenticationFilter) 추가
//        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);
//
//        // 모든 요청(URL)에 대해 인증 없이 누구나 접근할 수 있도록 허용하는 설정
//        http.authorizeHttpRequests(auth -> {
//            // permission 전체 허용 -> 이 요청 url은 열어주라고 명령하는것
//            auth.requestMatchers("/api/auth/**").permitAll();
//            auth.requestMatchers("/v3/api-docs/**").permitAll();
//            auth.requestMatchers("/swagger-ui/**").permitAll();
//            auth.requestMatchers("/swagger-ui.html").permitAll();
//            auth.requestMatchers("/doc").permitAll();
//            auth.requestMatchers("/oauth2/**").permitAll();
//            auth.requestMatchers("/login/**").permitAll();
//            auth.requestMatchers("/image/**").permitAll();
//            auth.requestMatchers("/api/account/**").permitAll();
//            auth.anyRequest().authenticated();
//        });
//
//        http.exceptionHandling(exception -> exception.authenticationEntryPoint(jwtAuthenticationEntryPoint));
//
//        return http.build(); // 예외처리 필요
//    }
//
//    @Bean
//    //CorsConfigurationSource ->  reactive안붙은거 사용
//    public CorsConfigurationSource corsConfigurationSource() {
//        CorsConfiguration cors = new CorsConfiguration();
//        // 5173, 5174 프론트앤드 URL 주소로 접속하는 사람들 다 허용
//        cors.setAllowedOrigins(List.of("http://localhost:5173", "http://localhost:5174"));
//        // 허용해주고 싶은 요청들만 CrossOrigin 풀어주기
////        cors.setAllowedMethods(List.of("GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"));
//        cors.setAllowedMethods(List.of("*"));
//        // 모든 Header 다 허용
//        cors.setAllowedHeaders(List.of("*"));
//        // 인증을 할 때 인증서 등의 쿠키 허용
//        cors.setAllowCredentials(true);
//
//        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
//        //  /** : 모든 URL에 요청을 다 허용 -> 프론트앤드에서 서버로 요청을 날릴 수 있다.
//        source.registerCorsConfiguration("/**", cors);
//        return source;
//    }
//
//    @Bean
//    public BCryptPasswordEncoder passwordEncoder() {
//        return new BCryptPasswordEncoder();
//    }
//
//}

package com.korit.sa_one_back.config;

import com.korit.sa_one_back.filter.JwtAuthenticationFilter;
import com.korit.sa_one_back.security.JwtAuthenticationEntryPoint;
import com.korit.sa_one_back.security.OAuth2SuccessHandler;
import com.korit.sa_one_back.service.OAuth2UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.List;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true) //필요하면 @PreAuthorize도 쓸 수 있게 열어둠(권장)
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;
    private final JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;
    private final OAuth2UserService oAuth2UserService;
    private final OAuth2SuccessHandler oAuth2SuccessHandler;

    @Bean
    public SecurityFilterChain FilterChain(HttpSecurity http) throws Exception {

        // 1) 프론트 통신 가능하도록 CORS 열기
        http.cors(cors -> cors.configurationSource(corsConfigurationSource()));

        // 2) JWT 기반이니까 세션은 무상태(STATELESS)
        http.sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));

        // 3) 기본 로그인 기능은 다 끄기(JWT + OAuth2만 사용)
        http.httpBasic(httpBasic -> httpBasic.disable());
        http.formLogin(formLogin -> formLogin.disable());
        http.csrf(csrf -> csrf.disable());

        // 4) OAuth2 로그인 성공시 우리 서버 토큰 발급 로직으로 이동
        http.oauth2Login(oauth2 -> oauth2
                .userInfoEndpoint(userInfo -> userInfo.userService(oAuth2UserService))
                .successHandler(oAuth2SuccessHandler)
        );

        // 5) JWT 필터를 UsernamePasswordAuthenticationFilter 앞에 둬서
        //    Authorization: Bearer 토큰을 먼저 처리하게 함
        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

        // 6)여기서 "URL 별 권한"을 딱 정리한다 (핵심)
        http.authorizeHttpRequests(auth -> {

            // -------------------------
            // (A) 완전 공개(로그인 필요 없음)
            // -------------------------
            auth.requestMatchers("/api/auth/**").permitAll();
            auth.requestMatchers("/v3/api-docs/**").permitAll();
            auth.requestMatchers("/swagger-ui/**").permitAll();
            auth.requestMatchers("/swagger-ui.html").permitAll();
            auth.requestMatchers("/doc").permitAll();
            auth.requestMatchers("/oauth2/**").permitAll();
            auth.requestMatchers("/login/**").permitAll();

            auth.requestMatchers("/signin/**").permitAll();
            auth.requestMatchers("/signup/**").permitAll();
            auth.requestMatchers("/image/**").permitAll();
            auth.requestMatchers("/api/account/**").permitAll();

            auth.requestMatchers("/image/**").permitAll();       // 이미지 조회 공개 (원하면 GET만 허용하도록 나중에 강화)
            auth.requestMatchers("/api/account/**").permitAll(); // 너 프로젝트에서 열어둔거 유지

            // -------------------------
            // (B) 관리자(ADMIN) 전용
            // - 사업장 신청/등록/승인/목록 조회 등
            // -------------------------
            auth.requestMatchers("/api/admin/**").hasRole("ADMIN");
            auth.requestMatchers("/api/stores/admin/**").hasRole("ADMIN");
            auth.requestMatchers("/api/workplaces/admin/**").hasRole("ADMIN");

            // -------------------------
            // (C) 사장(OWNER) 전용
            // - 직원 등록/수정/삭제/조회
            // - 사장이 직원 선택해서 출근/퇴근 처리
            // - 사업장 출결 현황, 직원별 출결 수정
            // - 사장 마이페이지
            // -------------------------
            auth.requestMatchers("/api/workplaces/**").hasRole("OWNER");      // 사업장 기준 관리 API
            auth.requestMatchers("/api/employees/**").hasRole("OWNER");       // 직원관리 API
            auth.requestMatchers("/api/attendances/check-in").hasRole("OWNER");
            auth.requestMatchers("/api/attendances/check-out").hasRole("OWNER");
            auth.requestMatchers("/api/attendances/owner/**").hasRole("OWNER"); // (권장) 사장 전용 출결 API를 이 prefix로 묶기
            auth.requestMatchers("/api/users/owner/**").hasRole("OWNER");     // 사장 마이페이지

            // -------------------------
            // (D) 직원(EMPLOYEE) 전용
            // - 내 출결 조회
            // - 직원 마이페이지
            // -------------------------
            auth.requestMatchers("/api/attendances/me").hasRole("EMPLOYEE");
            auth.requestMatchers("/api/users/employee/**").hasRole("EMPLOYEE");

            // -------------------------
            // (E) 공통 로그인 사용자(OWNER/EMPLOYEE/ADMIN)
            // - 둘 다 접근 가능한 공용 API가 있으면 여기로
            // -------------------------
            auth.requestMatchers("/api/users/me").hasAnyRole("OWNER", "EMPLOYEE", "ADMIN");

            // -------------------------
            // (F) 그 외는 로그인만 하면 접근
            // -------------------------

            auth.anyRequest().authenticated();
        });

        // 7) 인증 예외 처리(토큰 없거나 만료 등)
        http.exceptionHandling(exception -> exception.authenticationEntryPoint(jwtAuthenticationEntryPoint));

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration cors = new CorsConfiguration();
        cors.setAllowedOrigins(List.of("http://localhost:5173", "http://localhost:5174"));
        cors.setAllowedMethods(List.of("*"));
        cors.setAllowedHeaders(List.of("*"));
        cors.setAllowCredentials(true);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", cors);
        return source;
    }

    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/config/SwaggerApiConfig.java
==================================================

package com.korit.sa_one_back.config;

import io.swagger.v3.oas.models.Components;
import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.security.SecurityRequirement;
import io.swagger.v3.oas.models.security.SecurityScheme;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SwaggerApiConfig {

    @Bean
    public OpenAPI openAPIConfig() {
        OpenAPI openAPI = new OpenAPI();
        Info info = new Info();
        info.title("SA:ONE Project");
        info.version("1.0");
        info.description("사장님 혼자 관리하는 직원 시스템");

        SecurityRequirement securityRequirement = new SecurityRequirement();
        securityRequirement.addList("Bearer Authentication");

        SecurityScheme securityScheme = new SecurityScheme();
        securityScheme.name("Bearer Authentication");
        securityScheme.type(SecurityScheme.Type.HTTP);
        securityScheme.scheme("bearer");
        securityScheme.bearerFormat("JWT");

        Components components = new Components();
        components.addSecuritySchemes("Bearer Authentication", securityScheme);

        return openAPI
                .info(info)
                .addSecurityItem(securityRequirement)
                .components(components);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/AccountController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.FindUsernameReqDto;
import com.korit.sa_one_back.dto.request.PasswordResetConfirmReqDto;
import com.korit.sa_one_back.dto.request.PasswordResetReqDto;
import com.korit.sa_one_back.service.PasswordResetService;
import com.korit.sa_one_back.service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/account")
public class AccountController {

    private final UserService userService;
    private final PasswordResetService resetService;

    @PostMapping("/api/find-username")
    public ResponseEntity<?> findUsername(@RequestBody FindUsernameReqDto dto) {
        userService.findUsernameAndSendMail(dto);

        return ResponseEntity.ok(Map.of(
                "message", "입력하신 정보와 일치하는 계정이 있으면 이메일을 전송했습니다."
        ));
    }

    @PostMapping("/api/password/reset-request")
    public ResponseEntity<?> requestPasswordReset(@RequestBody PasswordResetReqDto dto) {
        resetService.requestPasswordReset(dto.getEmail());
        return ResponseEntity.ok().body("입력하신 정보와 일치하는 계정이 있으면 이메일을 전송했습니다.");
    }

    @PostMapping("/api/password/reset")
    public ResponseEntity<?> confirmPasswordReset(@RequestBody PasswordResetConfirmReqDto dto) {
        resetService.confirmPasswordReset(dto.getToken(),
                dto.getNewPassword(),
                dto.getNewPasswordConfirm());
        return ResponseEntity.ok().body("비밀번호를 변경하였습니다.");
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/admin/AdminDashboardController.java
==================================================

package com.korit.sa_one_back.controller.admin;

import com.korit.sa_one_back.dto.response.AdminDashboardRespDto;
import com.korit.sa_one_back.service.admin.AdminDashboardService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/admin/dashboard")
@RequiredArgsConstructor
public class AdminDashboardController {

    private final AdminDashboardService adminDashboardService;

    @GetMapping
    public ResponseEntity<AdminDashboardRespDto> getDashboard() {
        AdminDashboardRespDto dto = adminDashboardService.getDashboard();
        return ResponseEntity.ok(dto);
    }
}



==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/admin/AdminInquiryController.java
==================================================

package com.korit.sa_one_back.controller.admin;

import com.korit.sa_one_back.dto.request.admin.AdminInquiryListReqDto;
import com.korit.sa_one_back.dto.request.admin.InquiryCommentReqDto;
import com.korit.sa_one_back.dto.request.admin.InquiryStatusUpdateReqDto;
import com.korit.sa_one_back.dto.response.admin.AdminInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminInquiryListItemRespDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.admin.AdminInquiryService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/admin/inquiries")
public class AdminInquiryController {

    private final AdminInquiryService adminInquiryService;

    @GetMapping
    public ResponseEntity<PageRespDto<AdminInquiryListItemRespDto>> list(
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer page,
            @RequestParam(required = false) Integer size
    ) {
        AdminInquiryListReqDto dto = AdminInquiryListReqDto.builder()
                .status(status)
                .keyword(keyword)
                .page(page)
                .size(size)
                .build();

        return ResponseEntity.ok(adminInquiryService.list(dto));
    }

    @GetMapping("/{id}")
    public ResponseEntity<AdminInquiryDetailRespDto> detail(@PathVariable Long id) {
        return ResponseEntity.ok(adminInquiryService.detail(id));
    }

    @PatchMapping("/{id}/status")
    public ResponseEntity<Void> updateStatus(
            @PathVariable Long id,
            @RequestBody InquiryStatusUpdateReqDto dto
    ) {
        adminInquiryService.updateStatus(id, dto.getStatus());
        return ResponseEntity.ok().build();
    }

    @PostMapping("/{id}/comments")
    public ResponseEntity<Void> addComment(
            @PathVariable Long id,
            @RequestBody InquiryCommentReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        Long adminUserId = principalUser.getUserId();

        adminInquiryService.addComment(id, adminUserId, dto.getContent());
        return ResponseEntity.ok().build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/admin/AdminPolicyMasterController.java
==================================================

package com.korit.sa_one_back.controller.admin;

import com.korit.sa_one_back.dto.request.admin.policy.*;
import com.korit.sa_one_back.dto.response.PolicyMasterYearRespDto;
import com.korit.sa_one_back.service.admin.AdminPolicyMasterService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/admin/policy-master")
public class AdminPolicyMasterController {

    private final AdminPolicyMasterService adminPolicyMasterService;

    @GetMapping("/{year}")
    public ResponseEntity<PolicyMasterYearRespDto> get(@PathVariable int year) {
        return ResponseEntity.ok(adminPolicyMasterService.getYear(year));
    }

    @PutMapping("/{year}/tax-rate")
    public ResponseEntity<Void> upsertTaxRate(@PathVariable int year, @RequestBody TaxRateUpsertReqDto dto) {
        adminPolicyMasterService.upsertTaxRate(year, dto);
        return ResponseEntity.ok().build();
    }

    @PutMapping("/{year}/minimum-wage")
    public ResponseEntity<Void> upsertMinimumWage(@PathVariable int year, @RequestBody MinimumWageUpsertReqDto dto) {
        adminPolicyMasterService.upsertMinimumWage(year, dto);
        return ResponseEntity.ok().build();
    }

    @PutMapping("/{year}/limits")
    public ResponseEntity<Void> upsertLimits(@PathVariable int year, @RequestBody LimitsUpsertReqDto dto) {
        adminPolicyMasterService.upsertLimits(year, dto);
        return ResponseEntity.ok().build();
    }

    @PutMapping("/{year}/insurances")
    public ResponseEntity<Void> upsertInsuranceRates(@PathVariable int year, @RequestBody InsuranceRatesUpsertReqDto dto) {
        adminPolicyMasterService.upsertInsuranceRates(year, dto);
        return ResponseEntity.ok().build();
    }

    @PutMapping("/{year}/employment-company-rates")
    public ResponseEntity<Void> upsertEmploymentCompanyRates(@PathVariable int year, @RequestBody EmploymentCompanyRatesUpsertReqDto dto) {
        adminPolicyMasterService.upsertEmploymentCompanyRates(year, dto);
        return ResponseEntity.ok().build();
    }

    @PutMapping("/{year}/industrial-accident-rates")
    public ResponseEntity<Void> upsertIndustrialAccidentRates(@PathVariable int year, @RequestBody IndustrialAccidentRatesUpsertReqDto dto) {
        adminPolicyMasterService.upsertIndustrialAccidentRates(year, dto);
        return ResponseEntity.ok().build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/admin/AdminStoreApplicationController.java
==================================================

package com.korit.sa_one_back.controller.admin;

import com.korit.sa_one_back.dto.request.admin.ApplicationRejectReqDto;
import com.korit.sa_one_back.dto.request.admin.StoreApplicationListReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.service.admin.AdminStoreApplicationService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/admin/store-applications")
public class AdminStoreApplicationController {

    private final AdminStoreApplicationService adminStoreApplicationService;

    @GetMapping
    public ResponseEntity<PageRespDto<StoreApplicationEntity>> list(
            @RequestParam(required = false) String status,
            @RequestParam(required = false) Integer page,
            @RequestParam(required = false) Integer size) {
        StoreApplicationListReqDto dto = StoreApplicationListReqDto.builder()
                .status(status)
                .page(page)
                .size(size)
                .build();

        return ResponseEntity.ok(
            adminStoreApplicationService.list(dto)
        );
    }

    @GetMapping("/{id}")
    public ResponseEntity<StoreApplicationEntity> detail(@PathVariable Long id) {
        return ResponseEntity.ok(adminStoreApplicationService.detail(id));
    }

    @PostMapping("/{id}/approve")
    public ResponseEntity<Void> approve(@PathVariable Long id) {
        adminStoreApplicationService.approve(id);
        return ResponseEntity.ok().build();
    }

    @PostMapping("/{id}/reject")
    public ResponseEntity<Void> reject(@PathVariable Long id, @RequestBody ApplicationRejectReqDto body) {
        adminStoreApplicationService.reject(id, body.getReason());
        return ResponseEntity.ok().build();
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/admin/AdminStoreListController.java
==================================================

package com.korit.sa_one_back.controller.admin;

import com.korit.sa_one_back.dto.request.admin.AdminStoreListReqDto;
import com.korit.sa_one_back.dto.response.admin.AdminStoreDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminStoreListItemRespDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.service.admin.AdminStoreService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/admin/stores")
public class AdminStoreListController {
    private final AdminStoreService adminStoreService;

    @GetMapping
    public ResponseEntity<PageRespDto<AdminStoreListItemRespDto>> list(
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer page,
            @RequestParam(required = false) Integer size) {
        AdminStoreListReqDto dto = AdminStoreListReqDto.builder()
                .keyword(keyword)
                .page(page)
                .size(size)
                .build();
        return ResponseEntity.ok(adminStoreService.list(dto));
    }

    @GetMapping("/{storeId}")
    public ResponseEntity<AdminStoreDetailRespDto> detail(@PathVariable Long storeId) {
        return ResponseEntity.ok(adminStoreService.detail(storeId));
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/AttendanceController.java
==================================================

//package com.korit.sa_one_back.controller;
//
//import com.korit.sa_one_back.dto.request.AttendanceCheckInReqDto;
//import com.korit.sa_one_back.dto.request.AttendanceCheckOutReqDto;
//import com.korit.sa_one_back.dto.response.ApiRespDto;
//import com.korit.sa_one_back.service.AttendanceService;
//import lombok.RequiredArgsConstructor;
//import org.springframework.http.ResponseEntity;
//import org.springframework.web.bind.annotation.*;
//
//@RestController
//@RequiredArgsConstructor
//@RequestMapping("/attendances")
//public class AttendanceController {
//
//    private final AttendanceService attendanceService;
//
//    @PostMapping("/check-in")
//    public ResponseEntity<?> checkIn(@RequestBody AttendanceCheckInReqDto reqDto) {
//        Long userId = 1L;
//        return ResponseEntity.status(201)
//                .body(new ApiRespDto(true, "출근 완료",
//                        attendanceService.checkIn(userId, reqDto)));
//    }
//
//    @PostMapping("/check-out")
//    public ResponseEntity<?> checkOut(@RequestBody AttendanceCheckOutReqDto reqDto) {
//        Long userId = 1L;
//        return ResponseEntity.ok(
//                new ApiRespDto(true, "퇴근 완료",
//                        attendanceService.checkOut(userId, reqDto)));
//    }
//}

//p

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.AttendanceCheckInReqDto;
import com.korit.sa_one_back.dto.request.AttendanceCheckOutReqDto;
import com.korit.sa_one_back.dto.response.ApiRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.AttendanceService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.time.LocalDate;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/attendances")
public class AttendanceController {

    private final AttendanceService attendanceService;

    @PostMapping("/api/check-in")
    public ResponseEntity<?> checkIn(@RequestBody AttendanceCheckInReqDto reqDto,
                                     @org.springframework.security.core.annotation.AuthenticationPrincipal PrincipalUser principalUser) {

        Long loginUserId = principalUser.getUserId();

        return ResponseEntity.status(201)
                .body(new ApiRespDto(true, "출근 완료",
                        attendanceService.checkIn(loginUserId, reqDto)));
    }

    @PostMapping("/api/check-out")
    public ResponseEntity<?> checkOut(@RequestBody AttendanceCheckOutReqDto reqDto,
                                      @org.springframework.security.core.annotation.AuthenticationPrincipal PrincipalUser principalUser) {

        Long loginUserId = principalUser.getUserId();

        return ResponseEntity.ok(new ApiRespDto(true, "퇴근 완료",
                attendanceService.checkOut(loginUserId, reqDto)));
    }

    @GetMapping("/api/me")
    public ResponseEntity<?> getMyAttendances(@RequestParam Long storeId,
                                              @org.springframework.security.core.annotation.AuthenticationPrincipal PrincipalUser principalUser) {

        Long loginUserId = principalUser.getUserId();

        return ResponseEntity.ok(new ApiRespDto(true, "내 출결 조회 완료",
                attendanceService.getMyAttendances(loginUserId, storeId)));
    }

    @GetMapping("/api/owner/stores/{storeId}")
    public ResponseEntity<?> getOwnerAttendances(@PathVariable Long storeId,
                                                 @RequestParam(required = false) LocalDate date,
                                                 @org.springframework.security.core.annotation.AuthenticationPrincipal PrincipalUser principalUser) {

        Long loginUserId = principalUser.getUserId();
        LocalDate workDate = (date == null) ? LocalDate.now() : date;

        return ResponseEntity.ok(new ApiRespDto(true, "매장 출근현황 조회 완료",
                attendanceService.getOwnerAttendance(storeId, loginUserId, workDate)));
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/AuthController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.DeleteUserReqDto;
import com.korit.sa_one_back.dto.request.OAuth2SignUpReqDto;
import com.korit.sa_one_back.dto.request.SignInReqDto;
import com.korit.sa_one_back.dto.request.SignUpReqDto;
import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.jwt.JwtTokenProvider;
import com.korit.sa_one_back.mapper.UserMapper;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.UserService;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.HttpStatusCode;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/api/auth")
@RequiredArgsConstructor
public class AuthController {

    private final UserService userService;
    private final JwtTokenProvider jwtTokenProvider;
    private final UserMapper userMapper;

    @PostMapping("/api/local/signup")
    public ResponseEntity<?> signUp(@RequestBody SignUpReqDto dto) {
        userService.createLocalUser(dto);
        // 가입 후 JWT 발급
        UserEntity user = userMapper.findUserByUsername(dto.getUsername());
        if (user != null) {
            String token = jwtTokenProvider.createToken(user);
            return ResponseEntity.ok().body(token);
        } else {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("회원가입 후 사용자 조회 실패");
        }
    }

    @PostMapping("/api/oauth2/signup")
    public ResponseEntity<?> oauth2SignUp(@RequestBody OAuth2SignUpReqDto dto,
                                          @AuthenticationPrincipal PrincipalUser principalUser) {
        // SecurityContext에 OAuth2 인증 정보 존재
        if (principalUser == null || principalUser.isRegistered()) {
            return ResponseEntity.badRequest().body("이미 가입된 사용자 또는 인증 정보 없음");
        }

        userService.createOauth2User(dto);

        // 가입 완료 후 DB에서 다시 조회
        var user = userMapper.findByOauth2IdAndProvider(dto.getOauth2Id(), dto.getProvider());
        String token = jwtTokenProvider.createToken(user);

        return ResponseEntity.ok().body(token);
    }

    @PostMapping("/api/local/signin")
    public ResponseEntity<?> signIn(@Valid @RequestBody SignInReqDto dto) {
        String accessToken = userService.signin(dto);
        return ResponseEntity.ok(Map.of("accessToken", accessToken));
    }

    // 회원탈퇴
    @DeleteMapping("/api/deleteuser")
    public ResponseEntity<?> deleteUser(@RequestBody(required = false) DeleteUserReqDto dto,
                                        @AuthenticationPrincipal PrincipalUser principalUser) throws IllegalAccessException {
        if (principalUser == null) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("인증 정보 없음");
        }

        String password = (dto == null) ? null : dto.getPassword();
        userService.deleteUser(principalUser.getUserId(), password);

        return ResponseEntity.ok(Map.of("message", "회원탈퇴가 완료되었습니다."));
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/EmployeeController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.CreateEmployeeReqDto;
import com.korit.sa_one_back.dto.request.DeleteEmployeeReqDto;
import com.korit.sa_one_back.dto.response.EmployeeListRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.EmployeeService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;

/**
 * 직원 추가/조회/삭제(퇴사) 컨트롤러
 */
@RestController
@RequiredArgsConstructor
public class EmployeeController {

    private final EmployeeService employeeService;

    /**
     * 직원 등록 (사장)
     */
    @PostMapping("/api/store/{storeId}/employees")
    public ResponseEntity<?> createEmployee(
            @PathVariable Long storeId,
            @RequestBody CreateEmployeeReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser

    ) {

        employeeService.createEmployee(storeId, principalUser.getUserId(), dto);
        return ResponseEntity.ok().build();

    }


    /**
     * 직원 목록 조회
     * - workplaceId를 storeId로 사용
     */
    @GetMapping("/api/workplaces/{workplaceId}/employees")
    public ResponseEntity<List<EmployeeListRespDto>> getEmployees(
            @PathVariable Long workplaceId,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        System.out.println(
                principalUser.getAuthorities()
                        .stream()
                        .map(GrantedAuthority::getAuthority)
                        .toList()
        );
        return ResponseEntity.ok(employeeService.getEmployees(workplaceId, principalUser.getUserId()));
    }

    /**
     * 직원 삭제(퇴사 처리) - 다중
     * DELETE /store/{storeId}/employees
     */
    @DeleteMapping("/api/store/{storeId}/employees")
    public ResponseEntity<?> deleteEmployees(
            @PathVariable Long storeId,
            @RequestBody DeleteEmployeeReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        employeeService.deleteEmployees(storeId, principalUser.getUserId(), dto);
        return ResponseEntity.ok()
                .body(Map.of(
                        "success", true,
                        "message", "직원삭제 완료"
                ));
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/inquiry/EmployeeInquiryController.java
==================================================

package com.korit.sa_one_back.controller.inquiry;

import com.korit.sa_one_back.dto.request.inquiry.InquiryCommentReqDto;
import com.korit.sa_one_back.dto.request.inquiry.InquiryCreateReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryListItemRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.inquiry.EmployeeInquiryService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/employee/inquiries")
public class EmployeeInquiryController {

    private final EmployeeInquiryService employeeInquiryService;

    // 문의 목록
    @GetMapping
    public ResponseEntity<PageRespDto<EmployeeInquiryListItemRespDto>> list(
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer page,
            @RequestParam(required = false) Integer size,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        return ResponseEntity.ok(
                employeeInquiryService.list(principalUser.getUserId(), status, keyword, page, size)
        );
    }

    // 문의 작성
    @PostMapping
    public ResponseEntity<Void> create(
            @RequestBody InquiryCreateReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        employeeInquiryService.create(principalUser.getUserId(), dto);
        return ResponseEntity.ok().build();
    }

    // 문의 상세 + 댓글
    @GetMapping("/{id}")
    public ResponseEntity<EmployeeInquiryDetailRespDto> detail(
            @PathVariable Long id,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        return ResponseEntity.ok(employeeInquiryService.detail(principalUser.getUserId(), id));
    }

    // 내 문의에 댓글로 추가 작성
    @PostMapping("/{id}/comments")
    public ResponseEntity<Void> addComment(
            @PathVariable Long id,
            @RequestBody InquiryCommentReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        employeeInquiryService.addComment(principalUser.getUserId(), id, dto.getContent());
        return ResponseEntity.ok().build();
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/inquiry/OwnerInquiryController.java
==================================================

package com.korit.sa_one_back.controller.inquiry;

import com.korit.sa_one_back.dto.request.inquiry.InquiryCommentReqDto;
import com.korit.sa_one_back.dto.request.inquiry.InquiryCreateReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryListItemRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.inquiry.OwnerInquiryService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/owner/inquiries")
public class OwnerInquiryController {

    private final OwnerInquiryService ownerInquiryService;

    // 문의 목록
    @GetMapping
    public ResponseEntity<PageRespDto<OwnerInquiryListItemRespDto>> list(
            @RequestParam(required = false) String status,
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer page,
            @RequestParam(required = false) Integer size,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        return ResponseEntity.ok(
                ownerInquiryService.list(principalUser.getUserId(), status, keyword, page, size)
        );
    }

    // 문의 작성
    @PostMapping
    public ResponseEntity<Void> create(
            @RequestBody InquiryCreateReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        ownerInquiryService.create(principalUser.getUserId(), dto);
        return ResponseEntity.ok().build();
    }

    // 문의 상세 + 댓글
    @GetMapping("/{id}")
    public ResponseEntity<OwnerInquiryDetailRespDto> detail(
            @PathVariable Long id,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        return ResponseEntity.ok(ownerInquiryService.detail(principalUser.getUserId(), id));
    }

    // 내 문의에 댓글로 추가 작성
    @PostMapping("/{id}/comments")
    public ResponseEntity<Void> addComment(
            @PathVariable Long id,
            @RequestBody InquiryCommentReqDto dto,
            @AuthenticationPrincipal PrincipalUser principalUser
    ) {
        ownerInquiryService.addComment(principalUser.getUserId(), id, dto.getContent());
        return ResponseEntity.ok().build();
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/MyCalendarController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.response.ApiRespDto;
import com.korit.sa_one_back.dto.response.MyCalendarRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.MyCalendarService;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/stores/{storeId}/me")
public class MyCalendarController {

    private final MyCalendarService myCalendarService;

    // 직원 본인: store 선택 후 월 캘린더 조회
    @GetMapping("/api/calendar")
    public ApiRespDto<MyCalendarRespDto> getMyMonth(@PathVariable Long storeId,
                                                    @RequestParam int year,
                                                    @RequestParam int month,
                                                    @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        MyCalendarRespDto data = myCalendarService.getMyMonth(storeId, year, month, userId, role);
        return ApiRespDto.ok("내 캘린더 조회 성공", data);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/OwnerAttendanceController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.response.ApiRespDto;
import com.korit.sa_one_back.dto.response.OwnerDayAttendanceRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.OwnerAttendanceService;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.time.LocalDate;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/stores/{storeId}/owner")
public class OwnerAttendanceController {

    private final OwnerAttendanceService ownerAttendanceService;

    // 예: /stores/1/owner/attendance?date=2026-01-26
    @GetMapping("/api/attendance")
    public ApiRespDto<OwnerDayAttendanceRespDto> getDay(@PathVariable Long storeId,
                                                        @RequestParam("date") LocalDate date,
                                                        @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        OwnerDayAttendanceRespDto data = ownerAttendanceService.getDay(storeId, date, userId, role);
        return ApiRespDto.ok("출근 현황 조회 성공", data);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/OwnerCalendarController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.response.ApiRespDto;
import com.korit.sa_one_back.dto.response.EmployeeCalendarRespDto;
import com.korit.sa_one_back.dto.response.OwnerCalendarRespDto;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.OwnerCalendarService;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/stores/{storeId}/owner")
public class OwnerCalendarController {

    private final OwnerCalendarService ownerCalendarService;

    // 사장 월 캘린더 전체
    @GetMapping("/api/calendar")
    public ApiRespDto<OwnerCalendarRespDto> getOwnerMonth(@PathVariable Long storeId,
                                                          @RequestParam int year,
                                                          @RequestParam int month,
                                                          @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        OwnerCalendarRespDto data = ownerCalendarService.getOwnerMonth(storeId, year, month, userId, role);
        return ApiRespDto.ok("직원 캘린더 조회 성공", data);
    }

    // 사장 -> 직원 개인 캘린더(월)
    @GetMapping("/api/employees/{storeEmployeeId}/calendar")
    public ApiRespDto<EmployeeCalendarRespDto> getOwnerEmployeeMonth(@PathVariable Long storeId,
                                                                     @PathVariable Long storeEmployeeId,
                                                                     @RequestParam int year,
                                                                     @RequestParam int month,
                                                                     @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        EmployeeCalendarRespDto data = ownerCalendarService.getOwnerEmployeeMonth(
                storeId, storeEmployeeId, year, month, userId, role
        );
        return ApiRespDto.ok("직원 개인 캘린더 조회 성공", data);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/OwnerScheduleController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.CreateScheduleReqDto;
import com.korit.sa_one_back.dto.request.UpdateScheduleReqDto;
import com.korit.sa_one_back.dto.response.ApiRespDto;
import com.korit.sa_one_back.entity.ScheduleEntity;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.OwnerScheduleService;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/stores/{storeId}/owner")
public class OwnerScheduleController {

    private final OwnerScheduleService ownerScheduleService;

    // 등록: 사장이 가게 + 직원 선택 후 스케줄 저장
    @PostMapping("/api/employees/{storeEmployeeId}/schedules")
    public ApiRespDto<Map<String, Object>> create(@PathVariable Long storeId,
                                                  @PathVariable Long storeEmployeeId,
                                                  @RequestBody CreateScheduleReqDto req,
                                                  @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        ScheduleEntity entity = req.toEntity(storeEmployeeId);

        Long scheduleId = ownerScheduleService.create(storeId, storeEmployeeId, entity, userId, role);

        return ApiRespDto.ok("스케줄이 등록되었습니다", Map.of("scheduleId", scheduleId));
    }

    // 수정: 팝업에서 기존 스케줄 수정 후 저장
    @PutMapping("/api/schedules/{scheduleId}")
    public ApiRespDto<Void> update(@PathVariable Long storeId,
                                   @PathVariable Long scheduleId,
                                   @RequestBody UpdateScheduleReqDto req,
                                   @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        ScheduleEntity entity = req.toEntity(scheduleId);
        ownerScheduleService.update(storeId, scheduleId, entity, userId, role);

        return ApiRespDto.ok("스케줄이 수정되었습니다", null);
    }

    // 삭제: 사장만 가능
    @DeleteMapping("/api/schedules/{scheduleId}")
    public ApiRespDto<Void> delete(@PathVariable Long storeId,
                                   @PathVariable Long scheduleId,
                                   @AuthenticationPrincipal PrincipalUser principal) {

        Long userId = principal.getUserId();
        String role = principal.getAuthorities().iterator().next().getAuthority();

        ownerScheduleService.delete(storeId, scheduleId, userId, role);
        return ApiRespDto.ok("스케줄이 삭제되었습니다", null);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/PayrollController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.response.PayrollDetailRespDto;
import com.korit.sa_one_back.dto.response.PayrollIdRespDto;
import com.korit.sa_one_back.entity.payroll.PayrollDetailEntity;
import com.korit.sa_one_back.entity.payroll.PayrollEntity;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.payroll.PayrollService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/payrolls")
public class PayrollController {

    private final PayrollService payrollService;

    @GetMapping("/me")
    public ResponseEntity<List<PayrollEntity>> listMyPayrolls(
            @AuthenticationPrincipal PrincipalUser principalUser,
            @RequestParam Long storeId
    ) {
        Long userId = principalUser.getUserId();
        return ResponseEntity.ok(payrollService.listMyPayrolls(userId, storeId));
    }

    @GetMapping("/me/{yyyyMM}")
    public ResponseEntity<PayrollDetailRespDto> getMyPayrollDetail(
            @AuthenticationPrincipal PrincipalUser principalUser,
            @RequestParam Long storeId,
            @PathVariable String yyyyMM
    ) {
        Long userId = principalUser.getUserId();
        return ResponseEntity.ok(payrollService.getMyPayrollDetail(userId, storeId, yyyyMM));
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/StoreController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.admin.StoreApplicationReqDto;
import com.korit.sa_one_back.dto.response.MyStoreRespDto;
import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.StoreApplicationService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/stores")
@RequiredArgsConstructor
public class StoreController {

    private final StoreApplicationService storeService;

    @PostMapping("")
    public void postStoreInformationByOwner(
            @RequestBody StoreApplicationReqDto dto,
            @AuthenticationPrincipal PrincipalUser user
    ) {
        storeService.postMyApplication(dto, user.getUserId());
    }

    @GetMapping("/api/my_application")

    public StoreApplicationEntity getMyApplication(@AuthenticationPrincipal PrincipalUser user) {
        return storeService.getMyApplication(user.getUserId());
    }

    @GetMapping("/api/me")
    public ResponseEntity<List<MyStoreRespDto>> getMyStores(@AuthenticationPrincipal PrincipalUser principalUser) {
        Long userId = principalUser.getUserId();;
        return ResponseEntity.ok(storeService.getMyStores(userId));
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/controller/UserController.java
==================================================

package com.korit.sa_one_back.controller;

import com.korit.sa_one_back.dto.request.UpdateMyPageReqDto;
import com.korit.sa_one_back.dto.response.UserMeRespDto;
import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.security.PrincipalUser;
import com.korit.sa_one_back.service.UserService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/users")
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;

//    @GetMapping("/me")
//    public ResponseEntity<UserEntity> getMe(@AuthenticationPrincipal PrincipalUser principalUser) {
//
//        return ResponseEntity.ok(principalUser.getUser());
//    }
    @GetMapping("/api/me")
    public ResponseEntity<UserMeRespDto> getMyPage(
            Authentication authentication,
            @RequestParam(required = false) Long storeId
    ) {

        PrincipalUser principalUser = (PrincipalUser) authentication.getPrincipal();
        Long userId = principalUser.getUser().getUserId();
        UserMeRespDto resp = userService.getMyPage(userId, storeId);

        return ResponseEntity.ok(resp);
    }

    @PatchMapping("/api/me")
    public ResponseEntity<Void> updateMyPage(
            Authentication authentication,
            @RequestBody UpdateMyPageReqDto dto
    ) {
        PrincipalUser principalUser = (PrincipalUser) authentication.getPrincipal();
        Long userId = principalUser.getUser().getUserId();
        userService.updateMyPage(userId, dto);
        return ResponseEntity.ok().build();
    }

//    @PostMapping("/api/delete/me")
//    public ResponseEntity<?> deleteMe(@AuthenticationPrincipal PrincipalUser principalUser) throws IllegalAccessException {
//
//        if (principalUser == null) {
//            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build();
//        }
//
//        userService.deleteUser(principalUser.getUserId());
//
//        return ResponseEntity.ok().body("회원탈퇴 완료");
//    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/AdminInquiryListReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.*;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminInquiryListReqDto {
    private String status;
    private String keyword;
    private Integer page;
    private Integer size;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/AdminStoreListReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminStoreListReqDto {
    private String keyword;
    private Integer page;
    private Integer size;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/ApplicationRejectReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.Data;

@Data
public class ApplicationRejectReqDto {
    private String reason;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/InquiryCommentReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.Data;

@Data
public class InquiryCommentReqDto {
    private String content;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/InquiryStatusUpdateReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.Data;

@Data
public class InquiryStatusUpdateReqDto {
    private String status;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/EmploymentCompanyRatesUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.util.List;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmploymentCompanyRatesUpsertReqDto {
    private List<Item> items;

    @Getter
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Item {
        private String companyType;
        private String employerRate;
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/IndustrialAccidentRatesUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.util.List;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class IndustrialAccidentRatesUpsertReqDto {
    private List<Item> items;

    @Getter
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Item {
        private String industryCode;
        private String employerRate;
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/InsuranceRatesUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.util.List;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class InsuranceRatesUpsertReqDto {
    private List<InsuranceRateUpsertItemDto> items;

    @Getter
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class InsuranceRateUpsertItemDto {
        private Long insuranceId;
        private String employeeRate;
        private String employerRate;
        private String totalRate;
        private String note;
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/LimitsUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class LimitsUpsertReqDto {
    private Integer nationalPensionLower;
    private Integer nationalPensionUpper;
    private Integer healthInsuranceLower;
    private Integer healthInsuranceUpper;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/MinimumWageUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.time.LocalDate;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MinimumWageUpsertReqDto {
    private Integer hourlyWage;
    private LocalDate effectiveFrom;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/policy/TaxRateUpsertReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin.policy;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class TaxRateUpsertReqDto {
    private String incomeTaxRate;
    private String localTaxRate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/StoreApplicationListReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreApplicationListReqDto {
    private String status;
    private Integer page;
    private Integer size;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/admin/StoreApplicationReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.admin;

import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.entity.StoreEntity;
import lombok.Data;

import java.time.LocalDateTime;

@Data
public class StoreApplicationReqDto {

    private Long storeApplicationId;
    private String storeName;
    private String address;
    private String businessNumber;
    private String ownerName;
    private String storePhone;
    private String status;
    private String rejectReason;
    private LocalDateTime reviewedAt;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private Long userId;

    public StoreApplicationEntity toStoreApplicationEntity(Long userId) {
        return StoreApplicationEntity.builder()
                .storeName(storeName)
                .address(address)
                .businessNumber(businessNumber)
                .ownerName(ownerName)
                .storePhone(storePhone)
                .userId(userId)
                .build();
    }

    public StoreEntity toStoreEntity() {
        return StoreEntity.builder()
                .storeName(storeName)
                .address(address)
                .businessNumber(businessNumber)
                .ownerName(ownerName)
                .storePhone(storePhone)
                .userId(userId)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/AttendanceCheckInReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.AttendanceEntity;
import lombok.Data;

import java.time.LocalDateTime;

@Data
public class AttendanceCheckInReqDto {
    private Long storeId;
    private String storeEmployeeName;
    private String employeeNo;

    private LocalDateTime checkInTime;
    private String checkInImgUrl;

    public AttendanceEntity toEntity(Long storeEmployeeId) {
        return AttendanceEntity.builder()
                .storeEmployeeId(storeEmployeeId)
                .workDate(checkInTime.toLocalDate())
                .checkInTime(checkInTime)
                .checkInImgUrl(checkInImgUrl)
                .attendanceStatus("WORKING")
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/AttendanceCheckOutReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.AttendanceEntity;
import lombok.Data;

import java.time.LocalDateTime;


@Data
public class AttendanceCheckOutReqDto {

    private Long storeId;
    private String storeEmployeeName;
    private String employeeNo;

    private LocalDateTime checkOutTime;
    private String checkOutImgUrl;

    public AttendanceEntity toEntity(Long attendanceId, int workMinutes) {
        return AttendanceEntity.builder()
                .attendanceId(attendanceId)
                .checkOutTime(checkOutTime)
                .checkOutImgUrl(checkOutImgUrl)
                .workMinutes(workMinutes)
                .attendanceStatus("DONE")
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/builderCalendar.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.dto.response.CalendarDayRespDto;
import com.korit.sa_one_back.dto.response.CalendarItemRespDto;
import com.korit.sa_one_back.dto.response.CalendarRowRespDto;
import com.korit.sa_one_back.dto.response.OwnerCalendarRespDto;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

public class builderCalendar {
    private OwnerCalendarRespDto buildOwnerCalendar(List<CalendarRowRespDto> rows) {

        // 스케줄이 하나도 없는 경우
        if (rows == null || rows.isEmpty()) {
            return OwnerCalendarRespDto.builder()
                    .storeId(null)
                    .storeName(null)
                    .items(List.of())
                    .build();
        }

        Long storeId = rows.get(0).getStoreId();
        String storeName = rows.get(0).getStoreName();

        Map<LocalDate, List<CalendarItemRespDto>> grouped = new LinkedHashMap<>();

        for (CalendarRowRespDto row : rows) {

            // left join 결과라 날짜가 null일 수 있음
            if (row.getWorkDate() == null) continue;

            grouped.putIfAbsent(row.getWorkDate(), new ArrayList<>());

            grouped.get(row.getWorkDate()).add(
                    CalendarItemRespDto.builder()
                            .storeEmployeeId(row.getStoreEmployeeId())
                            .name(row.getName())
                            .scheduleId(row.getScheduleId())
                            .startTime(row.getStartTime())
                            .endTime(row.getEndTime())
                            .breakMinutes(row.getBreakMinutes())
//                            .note(row.getNote())
                            .status(row.getScheduleId() != null ? "SCHEDULED" : "NONE")
                            .build()
            );
        }

        List<CalendarDayRespDto> days = new ArrayList<>();
        for (Map.Entry<LocalDate, List<CalendarItemRespDto>> entry : grouped.entrySet()) {
            days.add(
                    CalendarDayRespDto.builder()
                            .workDate(entry.getKey())
//                            .employees(entry.getValue())
                            .build()
            );
        }

        return OwnerCalendarRespDto.builder()
                .storeId(storeId)
                .storeName(storeName)
                .items(days)
                .build();
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/CreateEmployeeReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
public class CreateEmployeeReqDto {

    private String name;
    private LocalDate birthDate;
    private String address;
    private String email;
    private String phone;

    private String imgUrl;
    private String imgPath;

    private String  employeeNo; // 사번 - store_employee_tb
    private LocalDate joinDate; // 입사일 - store_employee_tb
    private String positionName; // 고용형태 - position_tb

    // pay_tb
    private String payType; // 시급 또는 월급
    private int hourlyRate; // 시급
    private int monthlySalary; // 월급



}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/CreateScheduleReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.ScheduleEntity;
import lombok.Data;

import java.time.LocalDate;
import java.time.LocalTime;

/*

- 사장이 "새 스케줄을 등록"할 때 사용하는 요청 DTO
- 아직 scheduleId가 없는 상태에서 사용됨
- POST /stores/{storeId}/owner/employees/{empId}/schedules

*/
@Data
public class CreateScheduleReqDto {

    // 근무 날짜
    private LocalDate workDate;

    // 출근 시간
    private LocalTime startTime;

    // 퇴근 시간
    private LocalTime endTime;

    // 휴게 시간(분 단위)
    private Integer breakMinutes;

    // 메모(사유 등)
    private String note;

    // Request DTO → Entity 변환
    public ScheduleEntity toEntity(Long storeEmployeeId) {
        return ScheduleEntity.builder()
                .storeEmployeeId(storeEmployeeId)
                .workDate(workDate)
                .startTime(startTime)
                .endTime(endTime)
                .breakMinutes(breakMinutes)
                .note(note)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/DeleteEmployeeReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

import java.util.List;

@Data
public class DeleteEmployeeReqDto {

    private List<Long> storeEmployeeId;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/DeleteUserReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

@Data
public class DeleteUserReqDto {
    private String password;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/FindUsernameReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

@Data
public class FindUsernameReqDto {
    private String name;
    private String email;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/inquiry/InquiryCommentReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.inquiry;

import lombok.Data;

@Data
public class InquiryCommentReqDto {
    private String content;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/inquiry/InquiryCreateReqDto.java
==================================================

package com.korit.sa_one_back.dto.request.inquiry;

import lombok.Data;

@Data
public class InquiryCreateReqDto {
    private Long storeId;
    private String title;
    private String content;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/OAuth2SignUpReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.UserEntity;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import lombok.Data;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;

@Data
public class OAuth2SignUpReqDto {

    private int roleId;
    private String username;
    private String password;
    private String oauth2Id;
    private String provider;
    private String name;
    private String phone;
    @Email
    @NotBlank
    private String email;
    private String imgUrl;
    private String imgPath;

    private String tempToken;
    private String gender;
    private LocalDate birthDate;
    private boolean isDeleted;

    public UserEntity toOauth2Entity(String password) {
        return UserEntity.builder()
                .roleId(roleId)
                .username(provider + "_" + oauth2Id.substring(0, 12))
                .password(password)
                .name(name)
                .phone(phone)
                .email(email)
                .imgUrl(imgUrl)
                .imgPath(imgPath)
                .oauth2Id(oauth2Id)
                .provider(provider)
                .gender(gender)
                .birthDate(birthDate)
                .isDeleted(false)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/PasswordResetConfirmReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

@Data
public class PasswordResetConfirmReqDto {
    private String token;
    private String newPassword;
    private String newPasswordConfirm;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/PasswordResetReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

@Data
public class PasswordResetReqDto {
    private String email;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/payroll/PayrollDetailDto.java
==================================================

package com.korit.sa_one_back.dto.request.payroll;

import com.korit.sa_one_back.entity.payroll.PayrollDetailEntity;
import lombok.Builder;
import lombok.Data;

@Data
@Builder
public class PayrollDetailDto {
    private String itemCode;
    private int amount;

    private Integer minutes;
    private Double quantity;
    private Integer unitPrice;
    private Double multiplier;
    private String memo;

    public PayrollDetailEntity toEntity(Long payrollId, Long payrollItemId) {
        return PayrollDetailEntity.builder()
                .payrollId(payrollId)
                .payrollItemId(payrollItemId)
                .amount(amount)
                .minutes(minutes)
                .quantity(quantity)
                .unitPrice(unitPrice)
                .multiplier(multiplier)
                .memo(memo)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/payroll/PayrollDto.java
==================================================

package com.korit.sa_one_back.dto.request.payroll;

import com.korit.sa_one_back.entity.payroll.PayrollEntity;
import lombok.Builder;
import lombok.Data;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
public class PayrollDto {

    private Long storeEmployeeId;
    private String payslipYearMonth;

    private LocalDate periodStart;
    private LocalDate periodEnd;
    private LocalDate payDate; // nullable

    private String status; // "DRAFT" / "ISSUED" / "CONFIRMED"

    private boolean weeklyAllowanceYn;

    private double overtimeMultiplier;
    private double nightMultiplier;

    private int totalWorkMinutes;
    private int totalOvertimeMinutes;
    private int totalNightMinutes;

    private int grossPay;
    private int totalDeduction;
    private int netPay;

    private Double incomeTaxRate;
    private Double localTaxRate;
    private Double nationalPensionRate;
    private Double healthInsuranceRate;
    private Double employmentInsuranceRate;

    private int industrialAccidentInsurance;
    private LocalDateTime issuedAt;
    private LocalDateTime confirmedAt;

    public PayrollEntity toEntity() {
        return PayrollEntity.builder()
                .storeEmployeeId(storeEmployeeId)
                .payslipYearMonth(payslipYearMonth)
                .periodStart(periodStart)
                .periodEnd(periodEnd)
                .payDate(payDate)
                .status(status)

                .weeklyAllowanceYn(weeklyAllowanceYn)
                .overtimeMultiplier(overtimeMultiplier)
                .nightMultiplier(nightMultiplier)

                .totalWorkMinutes(totalWorkMinutes)
                .totalOvertimeMinutes(totalOvertimeMinutes)
                .totalNightMinutes(totalNightMinutes)

                .grossPay(grossPay)
                .totalDeduction(totalDeduction)
                .netPay(netPay)

                .incomeTaxRate(incomeTaxRate)
                .localTaxRate(localTaxRate)
                .nationalPensionRate(nationalPensionRate)
                .healthInsuranceRate(healthInsuranceRate)
                .employmentInsuranceRate(employmentInsuranceRate)

                .industrialAccidentInsurance(industrialAccidentInsurance)

                .issuedAt(issuedAt)
                .confirmedAt(confirmedAt)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/SignInReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Pattern;
import lombok.Data;

@Data
public class SignInReqDto {


    @Pattern(regexp = "^[a-z0-9_-]{5,20}$",
            message = "아이디: 5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.")
    private String username;
    @Pattern(regexp = "^(?=.*[A-Z])(?=.*[a-z])(?=.*\\d)(?=.*[^A-Za-z0-9])[A-Za-z0-9^A-Za-z0-9\\W]{8,16}$",
            message = "비밀번호: 8~16자의 영문 대/소문자, 숫자, 특수문자를 사용해 주세요.")
    private String password;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/SignUpReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.UserEntity;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Pattern;
import lombok.Data;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

import java.time.LocalDate;
import java.util.Date;

@Data
public class SignUpReqDto {

    private int roleId;
    @Pattern(regexp = "^[a-z0-9_-]{5,20}$",
            message = "아이디: 5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.")
    private String username;
    @Pattern(regexp = "^(?=.*[A-Z])(?=.*[a-z])(?=.*\\d)(?=.*[^A-Za-z0-9])[A-Za-z0-9^A-Za-z0-9\\W]{8,16}$",
            message = "비밀번호: 8~16자의 영문 대/소문자, 숫자, 특수문자를 사용해 주세요.")
    private String password;
    private String name;
    private String phone;
    @Email
    @NotBlank
    private String email;
    private String imgUrl;
    private String imgPath;
    private String gender;
    private LocalDate birthDate;
    private boolean isDeleted;
    private String address;

    public UserEntity toLocalEntity(BCryptPasswordEncoder passwordEncoder) {
        return UserEntity.builder()
                .roleId(roleId)
                .username(username)
                .password(passwordEncoder.encode(password))
                .name(name)
                .phone(phone)
                .email(email)
                .imgUrl(imgUrl)
                .imgPath(imgPath)
                .oauth2Id(null)
                .provider(null)
                .gender(gender)
                .birthDate(birthDate)
                .isDeleted(false)
                .address(address)
                .build();
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/UpdateMyPageReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import lombok.Data;

@Data
public class UpdateMyPageReqDto {

    private String email;
    private String phone;
    private String imgUrl;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/request/UpdateScheduleReqDto.java
==================================================

package com.korit.sa_one_back.dto.request;

import com.korit.sa_one_back.entity.ScheduleEntity;
import lombok.Data;

import java.time.LocalDate;
import java.time.LocalTime;

/*

- 이미 존재하는 스케줄을 "수정"할 때 사용하는 요청 DTO
- PUT /stores/{storeId}/owner/schedules/{scheduleId}

*/
@Data
public class UpdateScheduleReqDto {

    private LocalDate workDate;
    private LocalTime startTime;
    private LocalTime endTime;
    private Integer breakMinutes;
    private String note;

    // 수정은 scheduleId가 반드시 있어야 해서, 여기서 같이 조립
    public ScheduleEntity toEntity(Long scheduleId) {
        return ScheduleEntity.builder()
                .scheduleId(scheduleId)
                .workDate(workDate)
                .startTime(startTime)
                .endTime(endTime)
                .breakMinutes(breakMinutes)
                .note(note)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/admin/AdminInquiryDetailRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.admin;

import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import lombok.*;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminInquiryDetailRespDto {
    private Long inquiryId;
    private String title;
    private String content;
    private String status;

    private Long userId;
    private String userName;
    private String userEmail;

    private Long storeId;
    private String storeName;

    private String createdAt;
    private String reviewedAt;

    private List<InquiryCommentEntity> comments;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/admin/AdminInquiryListItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.admin;

import lombok.*;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminInquiryListItemRespDto {
    private Long inquiryId;
    private String title;
    private String status;
    private String userName;
    private Long userId;
    private String storeName;
    private String createdAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/admin/AdminStoreDetailRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.admin;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminStoreDetailRespDto {
    private Long storeId;
    private String storeName;
    private String address;
    private String businessNumber;
    private String ownerName;
    private String storePhone;

    private Long userId;

    private String companyType;
    private String industryCode;
    private String industryName;

    private String createdAt;
    private String updatedAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/admin/AdminStoreListItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.admin;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminStoreListItemRespDto {
    private Long storeId;
    private String storeName;
    private String address;
    private String businessNumber;
    private String ownerName;
    private String storePhone;

    private String companyType;
    private String industryCode;
    private String industryName;

    private String createdAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/admin/PageRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.admin;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PageRespDto<T> {
    private List<T> items;
    private int page;   // 1-base
    private int size;
    private int total;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/AdminDashboardRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;


import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import java.util.Map;

@Getter
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AdminDashboardRespDto {
    private int pendingApplications;
    private int openInquiries;
    private Map<String, Boolean> policyAlerts;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/ApiRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/*
    모든 API 응답을 { success, message, data } 형태로 통일하기 위한 Wrapper
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ApiRespDto<T> {
    private boolean success;
    private String message;
    private T data;

    public static <T> ApiRespDto<T> ok(String message, T data) {
        return ApiRespDto.<T>builder()
                .success(true)
                .message(message)
                .data(data)
                .build();
    }

    public static <T> ApiRespDto<T> fail(String message, T data) {
        return ApiRespDto.<T>builder()
                .success(false)
                .message(message)
                .data(data)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/AttendanceCheckInRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class AttendanceCheckInRespDto {

    private Long attendanceId;
    private Long storeId;
    private Long storeEmployeeId;
    private String employeeName;
    private LocalDateTime checkInTime;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/AttendanceCheckOutRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AttendanceCheckOutRespDto {

    private Long attendanceId;
    private Long storeId;
    private Long storeEmployeeId;
    private String employeeName;
    private LocalDateTime checkOutTime;
    private Integer workedMinutes;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/AttendanceInfoRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

/*
    attendance_tb 결과 표시 DTO
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AttendanceInfoRespDto {
    private Long attendanceId;
    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;
    private Integer workMinutes;
    private String attendanceStatus;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/CalendarDayRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.fasterxml.jackson.annotation.JsonInclude;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalTime;
import java.util.List;

@JsonInclude(JsonInclude.Include.NON_NULL)
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class CalendarDayRespDto {
    //- 캘린더의 "하루"를 표현하는 DTO
    //- 날짜 + 해당 날짜의 직원 목록
    private LocalDate workDate;

    private LocalTime startTime;
    private LocalTime endTime;
    private Integer breakMinutes;
    private String note;

    private Integer totalWorkMinutes; // attendance_tb.work_minutes (없으면 null)

    private AttendanceInfoRespDto attendance;
    private LeaveInfoRespDto leave;

    private List<EmployeeCalendarRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/CalendarItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class CalendarItemRespDto {

    private Long storeEmployeeId;
    private String name;

    private Long scheduleId;
    private LocalTime startTime;
    private LocalTime endTime;
    private Integer breakMinutes;
    private String note;

    // SCHEDULED / NONE
    private String status;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/CalendarRowRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class CalendarRowRespDto {
    // - DB JOIN 결과 "한 줄(row)"을 그대로 담는 DTO
    //- Service에서 날짜별로 묶기 전 단계에서만 사용됨
    // store
    private Long storeId;
    private String storeName;

    // employee
    private Long storeEmployeeId;
    private Long userId;
    private String name;

    // schedule_tb
    private Long scheduleId;
    private LocalDate workDate;
    private LocalTime startTime;
    private LocalTime endTime;
    private Integer breakMinutes;
    private String scheduleNote; // schedule_tb.note

    // attendance_tb
    private Long attendanceId;
    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;
    private Integer workMinutes;
    private String attendanceStatus; // attendance_tb.attendance_status
    private String attendanceNote;   // attendance_tb.attendance_note (없으면 null)

    // leave_tb + leave_type_tb
    private Long leaveId;
    private String leaveType;       // leave_type_tb.leave_type_name or code를 쓰고 싶으면 여기로
    private String leaveTypeName;   // 표시용 "휴가/연차/병가" 등


}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/EmployeeCalendarItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmployeeCalendarItemRespDto {

    private LocalDate workDate;

    private Long scheduleId;
    private LocalTime startTime;
    private LocalTime endTime;
    private Integer breakMinutes;
    private String note;

    private AttendanceInfoRespDto attendance;
    private LeaveInfoRespDto leave;

    private List<EmployeeCalendarRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/EmployeeCalendarRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.fasterxml.jackson.annotation.JsonInclude;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import com.fasterxml.jackson.annotation.JsonIgnore;

import java.time.LocalDateTime;
import java.time.LocalTime;
import java.util.List;

import static com.fasterxml.jackson.annotation.JsonInclude.Include.NON_NULL;

@JsonInclude(NON_NULL)
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor

public class EmployeeCalendarRespDto {

    private Long storeId;
    private String storeName;

    private Long storeEmployeeId;
    private Long userId;
    private String name;

    // 요약(월 캘린더 hover용)
//    @JsonIgnore
    private LocalTime startTime;
//    @JsonIgnore
    private LocalTime endTime;
//    @JsonIgnore
    private String note;

    // 출결 연동(팝업 또는 hover에 표시 가능)
//    @JsonIgnore
    private LocalDateTime checkInTime;
//    @JsonIgnore
    private LocalDateTime checkOutTime;
//    @JsonIgnore
    private String attendanceStatus;

    // 휴가/결근 표시
//    @JsonIgnore
    private LeaveInfoRespDto leave;

    // 사장 -> 직원 개인 캘린더 상세보기에서만 사용
    private List<EmployeeCalendarItemRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/EmployeeListRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class EmployeeListRespDto {

    // store_employee_tb
    private Long storeEmployeeId;
    private Long storeId;
    private Long userId;
    private String employeeNo;
    private Long positionId;
    private LocalDate joinDate;
    private String workStatus;

    // user_tb
    private String name;
    private String email;
    private String phone;
    private String imgUrl;
    private String imgPath;
    private LocalDate birthDate;

    // position_tb
    private String positionName;

    // pay_tb
    private String payType;
    private Integer hourlyRate;
    private Integer monthlySalary;
    private LocalDate startDate;
    private LocalDate endDate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/EmployeeSimpleRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmployeeSimpleRespDto {
    // - 사장이 가게 선택 후 "직원 목록"을 볼 때 사용하는 DTO
    //- 직원 선택용 데이터만 담는다

    // store_employee_tb.store_employee_id
    private Long storeEmployeeId;

    // store_employee_tb.user_id
    private Long userId;

    // store_employee_tb.employee_no
    private String employeeNo;

    // user_tb.name
    private String name;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/inquiry/EmployeeInquiryDetailRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.inquiry;

import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import lombok.*;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmployeeInquiryDetailRespDto {
    private Long inquiryId;
    private String title;
    private String content;
    private String status;

    private Long userId;
    private String userName;
    private String userEmail;

    private Long storeId;
    private String storeName;

    private String createdAt;
    private String reviewedAt;

    private List<InquiryCommentEntity> comments;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/inquiry/EmployeeInquiryListItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.inquiry;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmployeeInquiryListItemRespDto {
    private Long inquiryId;
    private String title;
    private String content;
    private String status;
    private String storeName;
    private String createdAt;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/inquiry/OwnerInquiryDetailRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.inquiry;

import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerInquiryDetailRespDto {
    private Long inquiryId;
    private String title;
    private String content;
    private String status;

    private Long userId;
    private String userName;
    private String userEmail;

    private Long storeId;
    private String storeName;

    private String createdAt;
    private String reviewedAt;

    private List<InquiryCommentEntity> comments;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/inquiry/OwnerInquiryListItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response.inquiry;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerInquiryListItemRespDto {
    private Long inquiryId;
    private String title;
    private String content;
    private String status;
    private String storeName;
    private String createdAt;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/LeaveInfoRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/*
    leave_tb + leave_type_tb 결과를 화면에 표시하기 위한 DTO
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class LeaveInfoRespDto {
    private Long leaveId;
    private String leaveType;     // 코드처럼 쓰고 싶으면 사용
    private String leaveTypeName; // 화면 표시용
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/MyAttendanceListRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class MyAttendanceListRespDto {
    private List<MyAttendanceRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/MyAttendanceRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class MyAttendanceRespDto {
    private Long attendanceId;
    private Long workplaceId;
    private String workplaceName;
    private LocalDate date;
    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;
    private Integer workedMinutes;
    private String status;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/MyCalendarRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MyCalendarRespDto {
    //- 직원 본인이 보는 "내 캘린더" 응답 DTO
    private Long storeId;
    private String storeName;

    private Long storeEmployeeId;
    private String name;

    private List<CalendarDayRespDto> items;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/MyStoreRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.korit.sa_one_back.entity.MyStoreEntity;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MyStoreRespDto {
    private Long storeId;
    private String storeName;
    private String address;

    public static MyStoreRespDto fromEntity(MyStoreEntity entity) {
        return MyStoreRespDto.builder()
                .storeId(entity.getStoreId())
                .storeName(entity.getStoreName())
                .address(entity.getAddress())
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerAbsentEmployeeRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class OwnerAbsentEmployeeRespDto {

    private Long employeeId;
    private String employeeName;
    private String reason;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerAttendanceRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class OwnerAttendanceRespDto {
    private Long attendanceId;
    private Long employeeId;
    private String employeeName;
    private LocalDate date;
    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;
    private Integer workedMinutes;
    private String status;
    private String absentReason;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerAttendanceSummaryRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerAttendanceSummaryRespDto {
    private String storeName;
    private String storeAddress;
    private String storeIntro;
    private String storeHoliday;
    private LocalDateTime openTime;
    private LocalDateTime closeTime;
    private Integer totalCheckInCount;
    private List<String> checkInEmployeeNames;
    private Integer totalAbsentCount;
    private List<OwnerAbsentEmployeeRespDto> absentEmployees;
    private List<OwnerAttendanceRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerCalendarRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

/*
- 사장이 보는 "직원 캘린더" 최종 응답 DTO
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerCalendarRespDto {
    // 사장이 "가게 캘린더 전체"를 볼 때 응답
    private Long storeId;
    private String storeName;

    // 날짜별로 직원 리스트가 묶여서 내려감
    private List<CalendarDayRespDto> items;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerDayAttendanceItemRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.time.LocalTime;

/*
    날짜별 출근 현황 팝업의 "직원 1명 row"
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerDayAttendanceItemRespDto {
    private Long storeEmployeeId;
    private Long userId;
    private String name;

    // 원래 스케줄
    private LocalTime startTime;
    private LocalTime endTime;

    // 실제 출근/퇴근
    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;

    private String attendanceStatus;

    private LeaveInfoRespDto leave;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/OwnerDayAttendanceRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.util.List;

/*
    사장이 캘린더 날짜를 클릭했을 때 뜨는 "출근 현황" 팝업 응답
*/
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OwnerDayAttendanceRespDto {
    private Long storeId;
    private String storeName;
    private LocalDate workDate;

    private List<OwnerDayAttendanceItemRespDto> items;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/PayrollDetailRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.korit.sa_one_back.entity.payroll.PayrollEntity;
import lombok.AllArgsConstructor;
import lombok.Data;

import java.util.List;

@Data
@AllArgsConstructor
public class PayrollDetailRespDto {
    private PayrollEntity payroll;
    private List<PayrollDetailViewRespDto> details;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/PayrollDetailViewRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.Data;

@Data
public class PayrollDetailViewRespDto {
    private Long payrollDetailId;
    private Long payrollId;
    private Long payrollItemId;

    private String itemName;
    private String itemType;
    private Boolean taxable;

    private Integer amount;
    private Integer minutes;
    private Integer unitPrice;
    private Double multiplier;
    private String memo;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/PayrollIdRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class PayrollIdRespDto {
    private Long payrollId;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/PolicyMasterYearRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.korit.sa_one_back.entity.payroll.*;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PolicyMasterYearRespDto {
    private int year;

    private TaxRateEntity taxRate;
    private MinimumWageEntity minimumWage;

    private NationalPensionLimitEntity nationalPensionLimit;
    private HealthInsuranceLimitEntity healthInsuranceLimit;

    private List<InsuranceRateEntity> insuranceRates;
    private List<EmploymentCompanyRateEntity> employmentCompanyRates;
    private List<IndustrialAccidentRateEntity> industrialAccidentRates;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/StoreRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreRespDto {
    private String storeName;
    private String storeAddress;
    private String storeIntro;
    private String storeHoliday;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/TokenRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import com.korit.sa_one_back.entity.UserEntity;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class TokenRespDto {

    private String accessToken;
    private UserEntity user;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/dto/response/UserMeRespDto.java
==================================================

package com.korit.sa_one_back.dto.response;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;
import java.util.List;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UserMeRespDto {

    // 공통 유저 정보
    private Long userId;
    private String role;
    private String username;

    private String email;
    private String phone;

    private String name;
    private String gender;
    private LocalDate birthDate;

    private String imgUrl;

    private EmployeeInfo employeeInfo;

    private OwnerInfo ownerInfo;


    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor

    public static class EmployeeInfo {

        private Long storeEmployeeId;
        private String storeName;
        private String employeeNo;
        private Date joinDate;
        private String workState;
        private String payType;
        private int hourlyRate;
        private int monthlySalary;

    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor

    public static class OwnerInfo {

        private List<StoreInfo> storeList;
        private StoreInfo selectedStore;

    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor

    public static class StoreInfo {

        private Long storeId;
        private String storeName;
        private String businessNumber;
        private String storePhone;
        private String address;

        private String companyType;   // 특례사항
        private String industryName;  // 고용보험업종
        private String industryCode;  // 업종코드

    }

}



==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/AttendanceEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class AttendanceEntity {

    private Long attendanceId;
    private Long storeEmployeeId;
    private LocalDate workDate;

    private LocalDateTime checkInTime;
    private LocalDateTime checkOutTime;

    private String attendanceStatus;
    private int workMinutes;
    private int overtimeMinutes;
    private int nightMinutes;
    private int lateMinutes;
    private int earlyLeaveMinutes;

    private String checkInImgUrl;
    private String checkOutImgUrl;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/inquiry/InquiryCommentEntity.java
==================================================

package com.korit.sa_one_back.entity.inquiry;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class InquiryCommentEntity {
    private Long commentId;
    private Long inquiryId;
    private Long userId;
    private String content;
    private String createdAt;
    private String updatedAt;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/inquiry/InquiryEntity.java
==================================================

package com.korit.sa_one_back.entity.inquiry;

public class InquiryEntity {
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/inquiry/InquiryStatus.java
==================================================

package com.korit.sa_one_back.entity.inquiry;

public enum InquiryStatus {
    OPEN,
    IN_PROGRESS,
    CLOSED
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/MyStoreEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MyStoreEntity {
    private Long storeId;
    private String storeName;
    private String address;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/PayEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PayEntity {

    private Long payId;
    private Long storeEmployeeId;
    private String payType;
    private Integer hourlyRate;
    private Integer monthlySalary;

    private LocalDate startDate;
    private LocalDate endDate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/EmploymentCompanyRateEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EmploymentCompanyRateEntity {
    private Long companyRateId;
    private Integer year;
    private String companyType;
    private BigDecimal employerRate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/HealthInsuranceLimitEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class HealthInsuranceLimitEntity {
    private Long healthInsuranceLimitId;
    private Integer year;
    private Integer lowerLimit;
    private Integer upperLimit;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/IndustrialAccidentRateEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.math.BigDecimal;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class IndustrialAccidentRateEntity {
    private Long industrialRateId;
    private String industryCode;
    private Integer year;
    private BigDecimal employerRate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/InsuranceRateEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class InsuranceRateEntity {
    private String insuranceCode;
    private int year;

    private double employeeRate;
    private double employerRate;
    private double totalRate;

    private String note;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/LimitEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class LimitEntity {
    private int year;
    private int lowerLimit;
    private int upperLimit;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/MinimumWageEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MinimumWageEntity {
    private Long minimumWageId;
    private Integer year;
    private Integer hourlyWage;
    private LocalDate effectiveFrom;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/MonthlyAttendanceSummaryEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class MonthlyAttendanceSummaryEntity {
    private Long summaryId;
    private Long storeEmployeeId;
    private String payslipYearMonth;

    private int workDays;
    private int totalWorkMinutes;
    private int totalOvertimeMinutes;
    private int totalNightMinutes;

    private int lateCount;
    private int earlyLeaveCount;
    private int absentCount;
    private int leaveDays;

    private LocalDateTime createdAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/NationalPensionLimitEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class NationalPensionLimitEntity {
    private Long nationalPensionLimitId;
    private Integer year;
    private Integer lowerLimit;
    private Integer upperLimit;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/PayPolicyEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PayPolicyEntity {
    private Long payPolicyId;
    private Long storeId;

    private LocalDate effectiveFrom;
    private LocalDate effectiveTo;
    private boolean active;

    private boolean weeklyAllowanceYn;
    private double overtimeMultiplier;
    private double nightMultiplier;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/PayrollDetailEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PayrollDetailEntity {
    private Long payrollDetailId;
    private Long payrollId;
    private Long payrollItemId;

    private int amount;

    private Integer minutes;
    private Double quantity;
    private Integer unitPrice;
    private Double multiplier;
    private String memo;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/PayrollEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class PayrollEntity {
    private Long payrollId;
    private Long storeEmployeeId;

    private String payslipYearMonth;
    private LocalDate periodStart;
    private LocalDate periodEnd;
    private LocalDate payDate;

    private String status;

    private boolean weeklyAllowanceYn;
    private double overtimeMultiplier;
    private double nightMultiplier;

    private int totalWorkMinutes;
    private int totalOvertimeMinutes;
    private int totalNightMinutes;

    private int grossPay;
    private int totalDeduction;
    private int netPay;

    private Double incomeTaxRate;
    private Double localTaxRate;
    private Double nationalPensionRate;
    private Double healthInsuranceRate;
    private Double employmentInsuranceRate;

    private int industrialAccidentInsurance;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private LocalDateTime issuedAt;
    private LocalDateTime confirmedAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/StoreBusinessInfoEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreBusinessInfoEntity {
    private Long storeId;
    private String companyType;
    private String industryCode;
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/payroll/TaxRateEntity.java
==================================================

package com.korit.sa_one_back.entity.payroll;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class TaxRateEntity {
    private int year;
    private double incomeTaxRate;
    private double localTaxRate;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/ScheduleEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ScheduleEntity {
    private Long scheduleId;
    private Long storeEmployeeId;

    private LocalDate workDate;
    private LocalTime startTime;
    private LocalTime endTime;

    private Integer breakMinutes;
    private String note;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/StoreApplicationEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreApplicationEntity {
    private Long storeApplicationId;
    private String storeName;
    private String address;
    private String businessNumber;
    private String ownerName;
    private String storePhone;
    private String status;
    private String rejectReason;
    private LocalDateTime reviewedAt;
    private LocalDateTime createdAt;
    private Long userId;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/StoreEmployeeEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreEmployeeEntity {
    private Long storeEmployeeId;

    private Long storeId;
    private Long userId;

    private String employeeNo;
    private Long positionId;
    private LocalDate joinDate;

    private String workStatus;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/StoreEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class StoreEntity {
    private Long storeId;
    private String storeName;
    private String address;
    private String businessNumber;
    private String ownerName;
    private String storePhone;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private Long userId;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/entity/UserEntity.java
==================================================

package com.korit.sa_one_back.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;


@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UserEntity {
    private Long userId; // PK, NN, AI
    private String username; // NN, UQ
    private String password;
    private String oauth2Id;
    private String provider;
    private String name;
    private String phone; // UQ
    private String email;
    private String imgUrl;
    private String imgPath;
    private int roleId; // NN
    private LocalDateTime createdAt; // NN
    private LocalDateTime updatedAt; // NN
    private String gender;
    private LocalDate birthDate;
    private boolean isDeleted;
    private LocalDateTime deletedAt;
    private String address;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/exception/GlobalExceptionHandler.java
==================================================

package com.korit.sa_one_back.exception;

import com.sun.net.httpserver.HttpsServer;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(StoreApplicationException.class)
    public ResponseEntity<?> handleNotFound(RuntimeException e) {
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
                .body(e.getMessage());
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/exception/StoreApplicationException.java
==================================================

package com.korit.sa_one_back.exception;

public class StoreApplicationException extends RuntimeException{
    public StoreApplicationException() {
        super("요청하신 신청 정보를 찾을 수 없습니다.");
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/filter/JwtAuthenticationFilter.java
==================================================

//package com.korit.sa_one_back.filter;
//
//import com.korit.sa_one_back.entity.UserEntity;
//import com.korit.sa_one_back.jwt.JwtTokenProvider;
//import com.korit.sa_one_back.mapper.UserMapper;
//import com.korit.sa_one_back.security.PrincipalUser;
//import jakarta.servlet.FilterChain;
//import jakarta.servlet.ServletException;
//import jakarta.servlet.http.HttpServletRequest;
//import jakarta.servlet.http.HttpServletResponse;
//import lombok.RequiredArgsConstructor;
//import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
//import org.springframework.security.core.context.SecurityContextHolder;
//import org.springframework.stereotype.Component;
//import org.springframework.web.filter.OncePerRequestFilter;
//
//import java.io.IOException;
//import java.util.Map;
//
//@Component
//@RequiredArgsConstructor
//public class JwtAuthenticationFilter extends OncePerRequestFilter {
//
//    private final JwtTokenProvider jwtTokenProvider;
//    private final UserMapper userMapper;
//
//    @Override
//    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
//
//        String bearerToken = request.getHeader("Authorization");
//        // 토큰이 안들어왔거나 잘못된 토큰일 경우를 검사
//        if (bearerToken == null || !bearerToken.startsWith("Bearer ")) {
//            filterChain.doFilter(request, response);
//            return;
//        }
//        System.out.println(bearerToken);
//        // replaceAll -> Bearer 을 공백으로 바꿔줌 -> 제거
//        String accessToken = bearerToken.replaceAll("Bearer ", "");
//
//        if (!jwtTokenProvider.validateToken(accessToken)) {
//            filterChain.doFilter(request, response);
//            return;
//        }
//
//        // 토큰이 유효할 경우
//        int userId = jwtTokenProvider.getUserId(accessToken);
//        UserEntity foundUser = userMapper.findByUserId(userId);
//
//        if (foundUser == null) {
//            filterChain.doFilter(request, response);
//            return;
//        }
//
////        String role = foundUser.getRoleId() == 1 ? "ROLE_OWNER" : "ROLE_STAFF";
//
////        Collection<? extends GrantedAuthority> authorities = List.of(new SimpleGrantedAuthority(role));
//
//        // oauth2Id null 방지
//        String oauth2Id = foundUser.getOauth2Id() == null ? "" : foundUser.getOauth2Id();
//
//        String provider = foundUser.getProvider() == null ? "" : foundUser.getProvider();
//        String email = foundUser.getEmail() == null ? "" : foundUser.getEmail();
//        String name = foundUser.getName() == null ? "" : foundUser.getName();
//
//        PrincipalUser principalUser = new PrincipalUser(
//                Map.of("id", oauth2Id),
//                oauth2Id,
//                provider,
//                email,
//                name,
//                foundUser
//        );
//
//        UsernamePasswordAuthenticationToken authentication =
//                new UsernamePasswordAuthenticationToken(principalUser, "", principalUser.getAuthorities());
//
//        SecurityContextHolder.getContext().setAuthentication(authentication);
//        // 필터 연결
//        filterChain.doFilter(request, response);
//    }
//
//}
///*
//    서버 -> 처음으로 사이트에 들어왔으면 회원가입 하기
//    회원가입 -> 로그인할 정보를 제공하는 것
//    요청을 날려야 함  -> 인증이 필요 없음 -> 필터를 타면 안됨.
//    -> 이 필터는 인증이 필요할 때만 타는 필터
//    permitAll() : 인가 -> 회원가입 URL이 있어야 통과시킴
//    회원가입을 하면 DB에 데이터가 저장됨
//    ->로그인
//    -> ID, PW를 입력한 다음 이전에 알려준 정보와 일치하면(인증)
//    -> 인증 요청을 날림
//    -> 서버 측에서는 ID, PW 맞는지 확인한 다음에
//    -> 응답으로 토큰을 발행해 줌
//    -> 클라이언트는 토큰을 가지고 있고, 이 클라이언트의 토큰을 이후의 다른 요청에 사용
//    -> 로그인할 때 인증이 되어있어야 하나? --> NO
//    => 로그인 요청도 permitAll();
//    --> 데이터를 요청할 경우 인가가 필요
//    -> 인증 이후의 받은 토큰을 가지고 인가를 받아야 함.
//    ->회원가입, 로그인 외의 나머지 다른 모든 요청들은 인가받아야함.
//*/

/// /////////////////////////////////////
package com.korit.sa_one_back.filter;

import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.jwt.JwtTokenProvider;
import com.korit.sa_one_back.mapper.UserMapper;
import com.korit.sa_one_back.security.PrincipalUser;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;
import java.util.Map;

@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtTokenProvider jwtTokenProvider;
    private final UserMapper userMapper;

    @Override
    protected void doFilterInternal(
            HttpServletRequest request,
            HttpServletResponse response,
            FilterChain filterChain
    ) throws ServletException, IOException {

        String bearerToken = request.getHeader("Authorization");

        // 토큰이 없으면 그냥 통과 (permitAll 경로 포함)
        if (bearerToken == null || !bearerToken.startsWith("Bearer ")) {
            filterChain.doFilter(request, response);
            return;
        }

        String accessToken = bearerToken.replace("Bearer ", "");

        // 토큰 유효성 검사
        if (!jwtTokenProvider.validateToken(accessToken)) {
            filterChain.doFilter(request, response);
            return;
        }

        // 토큰 → userId 추출
        int userId = jwtTokenProvider.getUserId(accessToken);
        UserEntity foundUser = userMapper.findByUserId(userId);

        if (foundUser == null) {
            filterChain.doFilter(request, response);
            return;
        }

        // null 방어
        String oauth2Id = foundUser.getOauth2Id() == null ? "" : foundUser.getOauth2Id();
        String provider = foundUser.getProvider() == null ? "" : foundUser.getProvider();
        String email = foundUser.getEmail() == null ? "" : foundUser.getEmail();
        String name = foundUser.getName() == null ? "" : foundUser.getName();

        // PrincipalUser 생성 (여기서 ROLE 생성됨)
        PrincipalUser principalUser = new PrincipalUser(
                Map.of("id", oauth2Id),
                oauth2Id,
                provider,
                email,
                name,
                foundUser
        );

        //  SecurityContext에 인증 객체 등록
        UsernamePasswordAuthenticationToken authentication =
                new UsernamePasswordAuthenticationToken(
                        principalUser,
                        null,
                        principalUser.getAuthorities()
                );

        SecurityContextHolder.getContext().setAuthentication(authentication);

        filterChain.doFilter(request, response);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/jwt/JwtTokenProvider.java
==================================================

package com.korit.sa_one_back.jwt;

import com.korit.sa_one_back.entity.UserEntity;
import io.jsonwebtoken.JwtException;
import io.jsonwebtoken.JwtParser;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.util.Date;

@Component
public class JwtTokenProvider {

    private final SecretKey key;

    public JwtTokenProvider(@Value("${jwt.secret}") String secret) {
        key = Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));
    }

    public String createToken(UserEntity userEntity) {

        Date now = new Date();

        long expiredTime = now.getTime() + (1000L * 60L * 60L * 24L);
        Date expiredDate = new Date(expiredTime);

        return Jwts.builder()
                .subject("server token")
                .issuer("wan03224")
                .issuedAt(new Date())
                .expiration(expiredDate)    // 필수
                .claim("userId", userEntity.getUserId())    // 필수
                .signWith(key, SignatureAlgorithm.HS256)    // 필수
                .compact();
        // 토큰이 만들어진다.
    }

    public boolean validateToken(String token) {
        try {
            JwtParser jwtParser = Jwts.parser()
                    .setSigningKey(key)
                    .build();
            jwtParser.parseClaimsJws(token);
            return true;
        } catch (JwtException e) {
            return false;
        }
    }

    public int getUserId(String token) {
        return (int) Jwts.parser()
                .setSigningKey(key)
                .build()
                .parseClaimsJws(token)
                .getPayload()
                .get("userId");
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminDashboardMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

@Mapper
public interface AdminDashboardMapper {
    int countStoreApplicationsByStatus();

    int countPendingInquiry();
    int countInquiryByStatus(String status);

    int updateInquiryStatus(Long inquiryId);
    int selectInquiry(Long inquiryId);

    int existMinimumWage(int year);
    int existTaxRate(int year);
    int existInsuranceRate(int year);
    int existNationalPensionRateLimit(int year);
    int existHealthInsuranceRateLimit(int year);
    int existEmploymentCompanyRate(int year);
    int existIndustrialAccidentRate(int year);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminInquiryMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import com.korit.sa_one_back.dto.response.admin.AdminInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminInquiryListItemRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.data.repository.query.Param;

import java.util.List;

@Mapper
public interface AdminInquiryMapper {

    int count(@Param("status") String status,
              @Param("keyword") String keyword);

    List<AdminInquiryListItemRespDto> findList(
            @Param("status") String status,
            @Param("keyword") String keyword,
            @Param("offset") int offset,
            @Param("size") int size
    );

    AdminInquiryDetailRespDto findDetail(@Param("id") Long id);

    List<InquiryCommentEntity> findComments(@Param("inquiryId") Long inquiryId);

    int updateStatus(@Param("id") Long id,
                     @Param("status") String status);

    int insertComment(@Param("inquiryId") Long inquiryId,
                      @Param("userId") Long userId,
                      @Param("content") String content);
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminPolicyMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import com.korit.sa_one_back.entity.payroll.PayPolicyEntity;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface AdminPolicyMapper {
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminPolicyMasterMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import com.korit.sa_one_back.dto.request.admin.policy.EmploymentCompanyRatesUpsertReqDto;
import com.korit.sa_one_back.dto.request.admin.policy.IndustrialAccidentRatesUpsertReqDto;
import com.korit.sa_one_back.dto.request.admin.policy.InsuranceRatesUpsertReqDto;
import com.korit.sa_one_back.entity.payroll.*;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.data.repository.query.Param;

import java.time.LocalDate;
import java.util.List;

@Mapper
public interface AdminPolicyMasterMapper {

    TaxRateEntity findTaxRate(@Param("year") int year);
    MinimumWageEntity findMinimumWage(@Param("year") int year);
    NationalPensionLimitEntity findNationalPensionLimit(@Param("year") int year);
    HealthInsuranceLimitEntity findHealthInsuranceLimit(@Param("year") int year);
    List<InsuranceRateEntity> findInsuranceRates(@Param("year") int year);
    List<EmploymentCompanyRateEntity> findEmploymentCompanyRates(@Param("year") int year);
    List<IndustrialAccidentRateEntity> findIndustrialAccidentRates(@Param("year") int year);

    int upsertTaxRate(@Param("year") int year,
                      @Param("incomeTaxRate") String incomeTaxRate,
                      @Param("localTaxRate") String localTaxRate);

    int upsertMinimumWage(@Param("year") int year,
                          @Param("hourlyWage") Integer hourlyWage,
                          @Param("effectiveFrom") LocalDate effectiveFrom);

    int upsertNationalPensionLimit(@Param("year") int year,
                                   @Param("lower") Integer lower,
                                   @Param("upper") Integer upper);

    int upsertHealthInsuranceLimit(@Param("year") int year,
                                   @Param("lower") Integer lower,
                                   @Param("upper") Integer upper);

    int upsertInsuranceRates(@Param("year") int year,
                             @Param("items") List<InsuranceRatesUpsertReqDto.InsuranceRateUpsertItemDto> items);

    int upsertEmploymentCompanyRates(@Param("year") int year,
                                     @Param("items") List<EmploymentCompanyRatesUpsertReqDto.Item> items);

    int upsertIndustrialAccidentRates(@Param("year") int year,
                                      @Param("items") List<IndustrialAccidentRatesUpsertReqDto.Item> items);
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminStoreApplicationMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.entity.StoreEntity;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.data.repository.query.Param;

import java.util.List;

@Mapper
public interface AdminStoreApplicationMapper {

    int countByStatus(@Param("status") String status);

    List<StoreApplicationEntity> findByStatus(
            @Param("status") String status,
            @Param("offset") int offset,
            @Param("size") int size
    );

    StoreApplicationEntity findById(@Param("id") Long id);

    int updateApproved(@Param("id") Long id);

    int updateRejected(@Param("id") Long id, @Param("reason") String reason);

    int insertStore(StoreEntity store);

    int insertStoreBusinessInfo(@Param("storeId") Long storeId);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/AdminStoreMapper.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import com.korit.sa_one_back.dto.response.admin.AdminStoreDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminStoreListItemRespDto;
import org.apache.ibatis.annotations.Mapper;
import org.springframework.data.repository.query.Param;

import java.util.List;

@Mapper
public interface AdminStoreMapper {

    int countStores(@Param("keyword") String keyword);

    List<AdminStoreListItemRespDto> findStores(
            @Param("keyword") String keyword,
            @Param("offset") int offset,
            @Param("size") int size
    );

    AdminStoreDetailRespDto findStoreDetail(@Param("storeId") Long storeId);
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/admin/PolicyType.java
==================================================

package com.korit.sa_one_back.mapper.admin;

import lombok.Getter;

import java.util.function.ToIntBiFunction;

public enum PolicyType {
    MINIMUM_WAGE ("MINIMUM_WAGE", AdminDashboardMapper::existMinimumWage),
    TAX_RATE ("TAX_RATE", AdminDashboardMapper::existTaxRate),
    INSURANCE_RATE ("INSURANCE_RATE", AdminDashboardMapper::existInsuranceRate),
    NATIONAL_PENSION_LIMIT ("NATIONAL_PENSION_LIMIT", AdminDashboardMapper::existNationalPensionRateLimit),
    HEALTH_INSURANCE_LIMIT ("HEALTH_INSURANCE_LIMIT", AdminDashboardMapper::existHealthInsuranceRateLimit),
    EMPLOYMENT_COMPANY_RATE ("EMPLOYMENT_COMPANY_RATE", AdminDashboardMapper::existEmploymentCompanyRate),
    INDUSTRIAL_ACCIDENT_RATE ("INSURANCE_ACCIDENT_RATE", AdminDashboardMapper::existIndustrialAccidentRate);

    @Getter
    private final String key;
    private final ToIntBiFunction<AdminDashboardMapper, Integer> queryFunction;

    PolicyType(String key, ToIntBiFunction<AdminDashboardMapper, Integer> queryFunction) {
        this.key = key;
        this.queryFunction = queryFunction;
    }

    public boolean exists(AdminDashboardMapper mapper, int year) {
        return queryFunction.applyAsInt(mapper, year) == 1;
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/AttendanceMapper.java
==================================================

//package com.korit.sa_one_back.mapper;
//
//import com.korit.sa_one_back.dto.response.MyAttendanceRespDto;
//import com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto;
//import com.korit.sa_one_back.dto.response.StoreRespDto;
//import com.korit.sa_one_back.entity.AttendanceEntity;
//import org.apache.ibatis.annotations.Mapper;
//import org.apache.ibatis.annotations.Param;
//
//import java.time.LocalDate;
//import java.time.LocalDateTime;
//import java.util.List;
//
//@Mapper
//public interface AttendanceMapper {
//
//    Long findStoreEmployeeId(@Param("userId") Long userId,
//                                               @Param("storeId") Long storeId);
//
//    int countTodayAttendance(@Param("storeEmployeeId") Long storeEmployeeId,
//                             @Param("workDate") LocalDate workDate);
//
//    void insertCheckIn(AttendanceEntity entity);
//
//    AttendanceEntity findTodayAttendanceForCheckOut(@Param("storeEmployeeId") Long storeEmployeeId,
//                                                    @Param("workDate") LocalDate workDate);
//
//    void updateCheckOut(AttendanceEntity entity);
//
//    List<MyAttendanceRespDto> findMyAttendances(@Param("storeEmployeeId") Long storeEmployeeId);
//
//    List<OwnerAttendanceRespDto> findOwnerAttendanceItems(@Param("storeId") Long storeId,
//                                                          @Param("workDate") LocalDate workDate);
//
//    LocalDateTime findOpenTime(@Param("storeId") Long storeId,
//                               @Param("workDate") LocalDate workDate);
//
//    LocalDateTime findCloseTime(@Param("storeId") Long storeId,
//                                @Param("workDate") LocalDate workDate);
//
//    StoreRespDto findStoreCard(@Param("storeId") Long storeId);
//}

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.MyAttendanceRespDto;
import com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto;
import com.korit.sa_one_back.dto.response.StoreRespDto;
import com.korit.sa_one_back.entity.AttendanceEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;

@Mapper
public interface AttendanceMapper {

    Long findStoreEmployeeId(@Param("userId") Long userId,
                             @Param("storeId") Long storeId);

    // 사장이 직원 선택(사번+이름)해서 store_employee_id 찾기
    Long findStoreEmployeeIdByNoAndName(@Param("storeId") Long storeId,
                                        @Param("employeeNo") String employeeNo,
                                        @Param("storeEmployeeName") String storeEmployeeName);

    int countTodayAttendance(@Param("storeEmployeeId") Long storeEmployeeId,
                             @Param("workDate") LocalDate workDate);

    void insertCheckIn(AttendanceEntity entity);

    AttendanceEntity findTodayAttendanceForCheckOut(@Param("storeEmployeeId") Long storeEmployeeId,
                                                    @Param("workDate") LocalDate workDate);

    void updateCheckOut(AttendanceEntity entity);

    List<MyAttendanceRespDto> findMyAttendances(@Param("storeEmployeeId") Long storeEmployeeId);

    List<OwnerAttendanceRespDto> findOwnerAttendanceItems(@Param("storeId") Long storeId,
                                                          @Param("workDate") LocalDate workDate);

    LocalDateTime findOpenTime(@Param("storeId") Long storeId,
                               @Param("workDate") LocalDate workDate);

    LocalDateTime findCloseTime(@Param("storeId") Long storeId,
                                @Param("workDate") LocalDate workDate);

    StoreRespDto findStoreCard(@Param("storeId") Long storeId);

    // 사장 소유 매장 확인
    int countOwnerStore(@Param("storeId") Long storeId,
                        @Param("userId") Long userId);

    // 직원 소속 확인
    int countActiveEmployee(@Param("storeId") Long storeId,
                            @Param("userId") Long userId);

    String findEmployeeName(@Param("storeEmployeeId") Long storeEmployeeId);
}



==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/EmployeeMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.EmployeeListRespDto;
import com.korit.sa_one_back.entity.StoreEmployeeEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.util.List;

@Mapper
public interface EmployeeMapper {
    boolean existsActiveEmployee(@Param("storeId") Long storeId,
                                 @Param("userId") Long userId);

    int insertStoreEmployee(StoreEmployeeEntity entity);

    List<EmployeeListRespDto> selectEmployees(@Param("storeId") Long storeId,
                                              @Param("today") LocalDate today);

    int countBelonging(@Param("storeId") Long storeId,
                       @Param("ids") List<Long> ids);

    int updateWorkStatus(@Param("storeEmployeeId") Long storeEmployeeId,
                         @Param("workStatus") String workStatus);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/inquiry/EmployeeInquiryMapper.java
==================================================

package com.korit.sa_one_back.mapper.inquiry;

import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryListItemRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface EmployeeInquiryMapper {

    // store_employee_tb에 존재하는지 (매장 소속 검증)
    boolean existsEmployeeInStore(@Param("userId") Long userId,
                                  @Param("storeId") Long storeId);

    // 내 문의인지 검증
    boolean existsMyInquiry(@Param("userId") Long userId,
                            @Param("inquiryId") Long inquiryId);

    int countMyInquiries(@Param("userId") Long userId,
                         @Param("status") String status,
                         @Param("keyword") String keyword);

    List<EmployeeInquiryListItemRespDto> findMyInquiryList(
            @Param("userId") Long userId,
            @Param("status") String status,
            @Param("keyword") String keyword,
            @Param("offset") int offset,
            @Param("size") int size
    );

    int insertInquiry(@Param("userId") Long userId,
                      @Param("storeId") Long storeId,
                      @Param("title") String title,
                      @Param("content") String content);

    EmployeeInquiryDetailRespDto findDetail(@Param("inquiryId") Long inquiryId);

    List<InquiryCommentEntity> findComments(@Param("inquiryId") Long inquiryId);

    int insertComment(@Param("inquiryId") Long inquiryId,
                      @Param("userId") Long userId,
                      @Param("content") String content);
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/inquiry/OwnerInquiryMapper.java
==================================================

package com.korit.sa_one_back.mapper.inquiry;

import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryListItemRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface OwnerInquiryMapper {

    // store_tb.user_id = ownerUserId (내 매장 검증)
    boolean existsOwnerStore(@Param("ownerUserId") Long ownerUserId,
                             @Param("storeId") Long storeId);

    // inquiry_tb.user_id = userId (내 문의 검증)
    boolean existsMyInquiry(@Param("userId") Long userId,
                            @Param("inquiryId") Long inquiryId);

    int countMyInquiries(@Param("userId") Long userId,
                         @Param("status") String status,
                         @Param("keyword") String keyword);

    List<OwnerInquiryListItemRespDto> findMyInquiryList(
            @Param("userId") Long userId,
            @Param("status") String status,
            @Param("keyword") String keyword,
            @Param("offset") int offset,
            @Param("size") int size
    );

    int insertInquiry(@Param("userId") Long userId,
                      @Param("storeId") Long storeId,
                      @Param("title") String title,
                      @Param("content") String content);

    OwnerInquiryDetailRespDto findDetail(@Param("inquiryId") Long inquiryId);

    List<InquiryCommentEntity> findComments(@Param("inquiryId") Long inquiryId);

    int insertComment(@Param("inquiryId") Long inquiryId,
                      @Param("userId") Long userId,
                      @Param("content") String content);
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/MyCalendarMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.CalendarRowRespDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.util.List;

@Mapper
public interface MyCalendarMapper {

    // 직원 본인 + store 기준 월 캘린더 row 조회
    List<CalendarRowRespDto> findMyMonthRows(
            @Param("storeId") Long storeId,
            @Param("userId") Long userId,
            @Param("start") LocalDate start,
            @Param("end") LocalDate end
    );

    // 직원이 해당 store에서 근무중인지 확인용
    int countMyStoreEmployee(@Param("storeId") Long storeId,
                             @Param("userId") Long userId);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/MyPageMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.UserMeRespDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

@Mapper
public interface MyPageMapper {

    // ===== 직원 전용 =====
    UserMeRespDto.EmployeeInfo findEmployeeInfoByUserId(Long userId);

    // ===== 사장/매니저 전용 =====
    List<UserMeRespDto.StoreInfo> findMyStoreList(Long userId);
    Long findFirstStoreId(Long userId);

    UserMeRespDto.StoreInfo findMyStoreDetail(@Param("userId") Long userId,
                                                  @Param("storeId") Long storeId);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/OwnerAttendanceMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.CalendarRowRespDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.util.List;

@Mapper
public interface OwnerAttendanceMapper {

    List<CalendarRowRespDto> findOwnerDayAttendanceRows(
            @Param("storeId") Long storeId,
            @Param("workDate") LocalDate workDate
    );
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/OwnerCalendarMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.response.CalendarRowRespDto;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.util.List;

@Mapper
public interface OwnerCalendarMapper {

    // 사장 월 캘린더(전체) row 조회
    List<CalendarRowRespDto> findOwnerMonthRows(
            @Param("storeId") Long storeId,
            @Param("start") LocalDate start,
            @Param("end") LocalDate end
    );

    // 사장 -> 직원 개인 월 캘린더 row 조회
    List<CalendarRowRespDto> findOwnerEmployeeMonthRows(
            @Param("storeId") Long storeId,
            @Param("storeEmployeeId") Long storeEmployeeId,
            @Param("start") LocalDate start,
            @Param("end") LocalDate end
    );
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/PayMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.entity.PayEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;

@Mapper
public interface PayMapper {
    int insertPay(PayEntity entity);

    int closeCurrentPayByEmployee(@Param("storeEmployeeId") Long storeEmployeeId,
                                  @Param("today") LocalDate today);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/PayrollMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.request.payroll.*;
import com.korit.sa_one_back.dto.response.PayrollDetailViewRespDto;
import com.korit.sa_one_back.entity.PayEntity;
import com.korit.sa_one_back.entity.payroll.*;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;
import java.util.List;
import java.util.Map;

@Mapper
public interface PayrollMapper {
    Long findStoreEmployeePayrollByUserIdAndStoreId(
            @Param("userId") Long userId,
            @Param("storeId") Long storeId
    );

    PayrollEntity findPayrollByYm (
            @Param("storeEmployeeId") Long storeEmployeeId,
            @Param("payslipYearMonth") String payslipYearMonth
    );
    void insertPayroll(PayrollEntity entity);

    List<PayrollDetailEntity> findPayrollDetailsByPayrollId(Long payrollId);
    int insertPayrollDetails(List<PayrollDetailEntity> details);

    List<Map<String, Object>> findPayrollItemCodeIdList();
    Long findPayrollItemIdByCode (String itemCode);

    MonthlyAttendanceSummaryEntity findMonthlySummary (
            @Param("storeEmployeeId") Long storeEmployeeId,
            @Param("payslipYearMonth") String payslipYearMonth
    );

    PayEntity findEffectivePay (
            @Param("storeEmployeeId") Long storeEmployeeId,
            @Param("asOf") LocalDate asOf
    );

    PayPolicyEntity findEffectivePolicy (
            @Param("storeId") Long storeId,
            @Param("asOf") LocalDate asOf
    );

    Integer sumWeeklyAllowanceAmountInMonth (
            @Param("storeEmployeeId") Long storeEmployeeId,
            @Param("monthStart") LocalDate monthStart,
            @Param("monthEnd") LocalDate monthEnd
    );

    TaxRateEntity findTaxRate (int year);

    LimitEntity findNationalPensionLimit (int year);
    LimitEntity findHealthInsuranceLimit (int year);

    InsuranceRateEntity findInsuranceRate (
            @Param("insuranceCode") String insuranceCode,
            @Param("year") int year
    );

    StoreBusinessInfoEntity findStoreBusinessInfo (Long storeId);

    List<PayrollEntity> findPayrollListByStoreEmployeeId(Long storeEmployeeId);

    List<PayrollDetailViewRespDto> findPayrollDetailViewByPayrollId(Long payrollId);
}



==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/PositionMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

@Mapper
public interface PositionMapper {
    Long findPositionIdByName(@Param("positionName") String positionName);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/ScheduleMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.entity.ScheduleEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDate;

@Mapper
public interface ScheduleMapper {

    int insertSchedule(ScheduleEntity entity);

    int updateSchedule(ScheduleEntity entity);

    int deleteSchedule(@Param("scheduleId") Long scheduleId);

    // 이 scheduleId가 이 store 소속인지 검증 (사장 수정/삭제 보안용)
    int countScheduleInStore(@Param("storeId") Long storeId,
                             @Param("scheduleId") Long scheduleId);

    // 직원이 store에 속하는지 검증 (사장 상세조회/등록 시 사용)
    int countStoreEmployeeInStore(@Param("storeId") Long storeId,
                                  @Param("storeEmployeeId") Long storeEmployeeId);
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/StoreMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.entity.MyStoreEntity;
import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.entity.StoreEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.time.LocalDateTime;
import java.util.List;

@Mapper
public interface StoreMapper {

    int insertStoreApplication(StoreApplicationEntity entity);

    StoreApplicationEntity selectByUserId(Long userId);

    StoreApplicationEntity selectByApplicationIdForAdmin(Long storeApplicationId);

    int insertStore(StoreEntity store);

    int updateApplicationStatus(@Param("storeApplicationId") Long storeApplicationId,
                                @Param("status") String status,
                                @Param("reviewedAt") LocalDateTime reviewedAt,
                                @Param("rejectReason") String rejectReason);

    int countByStoreId(@Param("storeId") Long storeId);
    Long findOwnerUserId(@Param("storeId") Long storeId);

    List<MyStoreEntity> findMyStoresByUserId(Long userId);

    // 사장 소유 매장 목록 (사장 캘린더/가게 선택용)
    List<MyStoreEntity> findOwnerStoresByUserId(Long userId);

    // 매장명 단건 조회 (캘린더 응답 보조용)
    String findStoreName(@Param("storeId") Long storeId);
    // 기존 그대로 두고 아래 2개만 추가
    int countEmployeeInStoreByUserId(@Param("storeId") Long storeId, @Param("userId") Long userId);



}

==================================================
FILE: src/main/java/com/korit/sa_one_back/mapper/UserMapper.java
==================================================

package com.korit.sa_one_back.mapper;

import com.korit.sa_one_back.dto.request.CreateEmployeeReqDto;
import com.korit.sa_one_back.entity.UserEntity;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

@Mapper
public interface UserMapper {

    int insertLocalUser(UserEntity user);
    int insertOauth2User(UserEntity user);

    UserEntity findByUserId(long userId);
    UserEntity findUserByUsername(String username);
    UserEntity findByOauth2IdAndProvider(String provider, String oauth2Id);

    Long findUserIdByEmail(@Param("email") String email);
    String findRoleNameByUserId(Long userId);

    int updateMyPage(UserEntity user);

    int softDelete(long userId);
    int updateEmployeeProfile(
            @Param("userId") Long userId,
            @Param("dto") CreateEmployeeReqDto dto);

    String findUsernameByNameAndEmail(String name, String email);

    int updatePassword(@Param("userId") Long userId, @Param("password") String password);

    int findRoleIdByUserId(@Param("userId") Long userId);

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/SaOneBackApplication.java
==================================================

package com.korit.sa_one_back;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SaOneBackApplication {

    public static void main(String[] args) {
        SpringApplication.run(SaOneBackApplication.class, args);
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/security/JwtAuthenticationEntryPoint.java
==================================================

package com.korit.sa_one_back.security;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.stereotype.Component;

import java.io.IOException;

@Component
public class JwtAuthenticationEntryPoint implements AuthenticationEntryPoint {

    // 인증 예외 처리
    // 원래라면 에러가 터졌을 때 로그인창으로 보내는데, 404가 뜨면 404 그대로 주고 , 다른 에러면 401에러를 준다
    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
        if (response.getStatus() == HttpServletResponse.SC_NOT_FOUND) {
            response.sendError(HttpServletResponse.SC_NOT_FOUND);
        } else {
            response.sendError(HttpServletResponse.SC_UNAUTHORIZED, "인증 실패");
        }
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/security/OAuth2SuccessHandler.java
==================================================

package com.korit.sa_one_back.security;

import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.jwt.JwtTokenProvider;
import com.korit.sa_one_back.mapper.UserMapper;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.Authentication;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
import org.springframework.stereotype.Component;

import java.io.IOException;
@Component
@RequiredArgsConstructor
public class OAuth2SuccessHandler implements AuthenticationSuccessHandler {

    private final JwtTokenProvider jwtTokenProvider;
    private final UserMapper userMapper;

    @Override
    public void onAuthenticationSuccess(HttpServletRequest request,
                                        HttpServletResponse response,
                                        Authentication authentication)
            throws IOException {

        PrincipalUser principal = (PrincipalUser) authentication.getPrincipal();

        // 이미 가입된 사용자
        if (principal.isRegistered()) {
            String token = jwtTokenProvider.createToken(principal.getUser());
            response.sendRedirect(
                    "http://localhost:5173/auth/login/oauth2?accessToken=" + token
            );
            return;
        }

        // 신규 OAuth2 사용자
        response.sendRedirect(
                "http://localhost:5173/auth/signup/oauth2"
        );
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/security/PrincipalUser.java
==================================================

package com.korit.sa_one_back.security;

import com.korit.sa_one_back.entity.UserEntity;
import lombok.Getter;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.oauth2.core.user.OAuth2User;

import java.util.Collection;
import java.util.List;
import java.util.Map;

@Getter
public class PrincipalUser implements OAuth2User {

    private final Map<String, Object> attributes;
    private final Long userId;
    private final String oauth2Id;
    private final String provider;
    private final String email;
    private final String name;

    private final UserEntity user;

    public PrincipalUser(Map<String, Object> attributes,
                         String oauth2Id,
                         String provider,
                         String email,
                         String name,
                         UserEntity user) {

        this.attributes = attributes;
        this.userId = user != null ? user.getUserId() : null;
        this.oauth2Id = oauth2Id;
        this.provider = provider;
        this.email = email;
        this.name = name;
        this.user = user;
    }

    public boolean isRegistered() {
        return user != null;
    }

    @Override
    public Map<String, Object> getAttributes() {
        return attributes;
    }

//    @Override
//    public Collection<? extends GrantedAuthority> getAuthorities() {
//        if (isRegistered()) {
//            String role = user.getRoleId() == 1 ? "ROLE_OWNER" : "ROLE_STAFF";
//            return java.util.List.of((GrantedAuthority) () -> role);
//        }
//        return java.util.List.of((GrantedAuthority) () -> "ROLE_GUEST");
//    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {

        if (isRegistered()) {

            String role = user.getRoleId() == 1 ? "ROLE_ADMIN" : user.getRoleId() == 2 ? "ROLE_OWNER" : "ROLE_STAFF";

            return java.util.List.of((GrantedAuthority) () -> role);

        }
        String role;
        if (user.getRoleId() == 1) {
            role = "ROLE_OWNER";
        } else if (user.getRoleId() == 2) {
            role = "ROLE_EMPLOYEE";
        } else if (user.getRoleId() == 3) {
            role = "ROLE_ADMIN";
        } else {
            // 시스템상 존재하면 안 되는 값 → 권한 없음 처리
            return List.of();
        }

        return List.of((GrantedAuthority) () -> role);
    }


    @Override
    public String getName() {
        return oauth2Id != null ? oauth2Id : "";
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/security/RoleResolver.java
==================================================

package com.korit.sa_one_back.security;

import org.springframework.stereotype.Component;

@Component
public class RoleResolver {

    public String resolveRoleName(long roleId) {
        if (roleId == 1) return "ROLE_ADMIN"; // 관리자
        if (roleId == 2) return "ROLE_OWNER"; // 사장
        if (roleId == 3) return "ROLE_STAFF"; // 직원
        return "ROLE_GUEST"; // 기본값 (예: role_id가 0이거나 비정상일 때)
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/security/RoleType.java
==================================================

package com.korit.sa_one_back.security;

import lombok.Getter;

public enum RoleType {
    ADMIN(1, "ROLE_ADMIN"),
    OWNER(2, "ROLE_OWNER"),
    STAFF(3, "ROLE_STAFF"),
    GUEST(0, "ROLE_GUEST");

    private final int id;
    @Getter
    private final String roleName;

    RoleType(int id, String roleName) {
        this.id = id;
        this.roleName = roleName;
    }

    public static RoleType fromId(long id) {
        for (RoleType role : values()) {
            if (role.id == id) return role;
        }
        return GUEST;
    }

    public long getId() {
        return id;
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/admin/AdminDashboardService.java
==================================================

package com.korit.sa_one_back.service.admin;

import com.korit.sa_one_back.dto.response.AdminDashboardRespDto;
import com.korit.sa_one_back.mapper.admin.AdminDashboardMapper;
import com.korit.sa_one_back.mapper.admin.PolicyType;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class AdminDashboardService {

    private final AdminDashboardMapper adminDashboardMapper;

    public AdminDashboardRespDto getDashboard() {
        return AdminDashboardRespDto.builder()
                .pendingApplications(countPendingApplication())
                .openInquiries(countPendingInquiry())
                .policyAlerts(getPolicyAlertsIfDue())
                .build();
    }

    public int countPendingApplication() {
        return adminDashboardMapper.countStoreApplicationsByStatus();
    }

    public int countPendingInquiry() {
        return adminDashboardMapper.countPendingInquiry();
    }

    public Map<String, Boolean> getPolicyAlertsIfDue() {
        int targetYear = LocalDate.now().getYear() + 1;

        LocalDate now = LocalDate.now();
        LocalDate dueStartDate = LocalDate.of(targetYear, 1, 1).minusMonths(1);

        if (now.isBefore(dueStartDate)) {
            return Collections.emptyMap();
        }

        Map<String, Boolean> statusMap = countPolicyAlert(targetYear);

        Map<String, Boolean> alerts = new LinkedHashMap<>();

        for (Map.Entry<String, Boolean> e : statusMap.entrySet()) {
            if (!e.getValue()) {
                alerts.put(e.getKey(), false);
            }
        }
        return alerts;
    }

    private Map<String, Boolean> countPolicyAlert(int year) {
        Map<String, Boolean> result = new LinkedHashMap<>();

        for (PolicyType policy : PolicyType.values()) {
            result.put(policy.getKey(), policy.exists(adminDashboardMapper, year));
        }
        return result;
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/admin/AdminInquiryService.java
==================================================

package com.korit.sa_one_back.service.admin;

import com.korit.sa_one_back.dto.request.admin.AdminInquiryListReqDto;
import com.korit.sa_one_back.dto.response.admin.AdminInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminInquiryListItemRespDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import com.korit.sa_one_back.mapper.admin.AdminInquiryMapper;
import com.korit.sa_one_back.util.PageParam;
import com.korit.sa_one_back.util.PageUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@RequiredArgsConstructor
public class AdminInquiryService {

    private final AdminInquiryMapper adminInquiryMapper;

    public PageRespDto<AdminInquiryListItemRespDto> list(AdminInquiryListReqDto dto) {

        String status = (dto.getStatus() == null || dto.getStatus().isBlank())
                ? "OPEN"
                : dto.getStatus();

        PageParam pageParam = PageUtil.resolve(dto.getPage(), dto.getSize());

        int total = adminInquiryMapper.count(status, dto.getKeyword());
        List<AdminInquiryListItemRespDto> items =
                adminInquiryMapper.findList(status, dto.getKeyword(),
                        pageParam.getOffset(), pageParam.getSize());

        return PageRespDto.<AdminInquiryListItemRespDto>builder()
                .items(items)
                .page(pageParam.getPage())
                .size(pageParam.getSize())
                .total(total)
                .build();
    }

    public AdminInquiryDetailRespDto detail(Long inquiryId) {
        AdminInquiryDetailRespDto detail = adminInquiryMapper.findDetail(inquiryId);
        if (detail == null) throw new IllegalArgumentException("문의가 존재하지 않습니다.");

        List<InquiryCommentEntity> comments =
                adminInquiryMapper.findComments(inquiryId);

        detail.setComments(comments);
        return detail;
    }

    @Transactional
    public void updateStatus(Long inquiryId, String status) {
        if (!List.of("OPEN", "IN_PROGRESS", "CLOSED").contains(status)) {
            throw new IllegalArgumentException("잘못된 상태값입니다.");
        }

        adminInquiryMapper.updateStatus(inquiryId, status);
    }

    @Transactional
    public void addComment(Long inquiryId, Long adminUserId, String content) {
        if (content == null || content.isBlank()) {
            throw new IllegalArgumentException("댓글 내용이 비어있습니다.");
        }

        adminInquiryMapper.insertComment(inquiryId, adminUserId, content);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/admin/AdminPolicyMasterService.java
==================================================

package com.korit.sa_one_back.service.admin;

import com.korit.sa_one_back.dto.request.admin.policy.*;
import com.korit.sa_one_back.dto.response.PolicyMasterYearRespDto;
import com.korit.sa_one_back.mapper.admin.AdminPolicyMasterMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@RequiredArgsConstructor
public class AdminPolicyMasterService {

    private final AdminPolicyMasterMapper adminPolicyMasterMapper;

    public PolicyMasterYearRespDto getYear(int year) {
        return PolicyMasterYearRespDto.builder()
                .year(year)
                .taxRate(adminPolicyMasterMapper.findTaxRate(year))
                .minimumWage(adminPolicyMasterMapper.findMinimumWage(year))
                .nationalPensionLimit(adminPolicyMasterMapper.findNationalPensionLimit(year))
                .healthInsuranceLimit(adminPolicyMasterMapper.findHealthInsuranceLimit(year))
                .insuranceRates(adminPolicyMasterMapper.findInsuranceRates(year))
                .employmentCompanyRates(adminPolicyMasterMapper.findEmploymentCompanyRates(year))
                .industrialAccidentRates(adminPolicyMasterMapper.findIndustrialAccidentRates(year))
                .build();
    }

    public void upsertTaxRate(int year, TaxRateUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertTaxRate(year, dto.getIncomeTaxRate(), dto.getLocalTaxRate());
    }

    public void upsertMinimumWage(int year, MinimumWageUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertMinimumWage(year, dto.getHourlyWage(), dto.getEffectiveFrom());
    }

    @Transactional
    public void upsertLimits(int year, LimitsUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertNationalPensionLimit(year, dto.getNationalPensionLower(), dto.getNationalPensionUpper());
        adminPolicyMasterMapper.upsertHealthInsuranceLimit(year, dto.getHealthInsuranceLower(), dto.getHealthInsuranceUpper());
    }

    @Transactional
    public void upsertInsuranceRates(int year, InsuranceRatesUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertInsuranceRates(year, dto.getItems());
    }

    @Transactional
    public void upsertEmploymentCompanyRates(int year, EmploymentCompanyRatesUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertEmploymentCompanyRates(year, dto.getItems());
    }

    @Transactional
    public void upsertIndustrialAccidentRates(int year, IndustrialAccidentRatesUpsertReqDto dto) {
        adminPolicyMasterMapper.upsertIndustrialAccidentRates(year, dto.getItems());
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/admin/AdminStoreApplicationService.java
==================================================

package com.korit.sa_one_back.service.admin;

import com.korit.sa_one_back.dto.request.admin.StoreApplicationListReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.entity.StoreEntity;
import com.korit.sa_one_back.mapper.admin.AdminStoreApplicationMapper;
import com.korit.sa_one_back.util.PageParam;
import com.korit.sa_one_back.util.PageUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@RequiredArgsConstructor
public class AdminStoreApplicationService {

    private final AdminStoreApplicationMapper adminStoreApplicationMapper;

    public PageRespDto<StoreApplicationEntity> list(StoreApplicationListReqDto dto) {
        String status = (dto.getStatus() == null || dto.getStatus().isBlank()) ? "PENDING" : dto.getStatus();

        PageParam pageParam = PageUtil.resolve(dto.getPage(), dto.getSize());

        int page = pageParam.getPage();
        int size = pageParam.getSize();
        int offset = pageParam.getOffset();

        int total = adminStoreApplicationMapper.countByStatus(status);
        List<StoreApplicationEntity> items = adminStoreApplicationMapper.findByStatus(status, offset, size);

        return PageRespDto.<StoreApplicationEntity>builder()
                .items(items)
                .page(page)
                .size(size)
                .total(total)
                .build();
    }

    public StoreApplicationEntity detail(Long id) {
        StoreApplicationEntity app = adminStoreApplicationMapper.findById(id);
        if (app == null) throw new IllegalArgumentException("신청 내역을 찾을 수 없습니다.");
        return app;
    }

    @Transactional
    public void approve(Long id) {
        StoreApplicationEntity app = detail(id);

        if (!"PENDING".equalsIgnoreCase(app.getStatus())) {
            throw new IllegalStateException("이미 처리된 신청입니다.");
        }

        StoreEntity store = StoreEntity.builder()
                .storeName(app.getStoreName())
                .address(app.getAddress())
                .businessNumber(app.getBusinessNumber())
                .ownerName(app.getOwnerName())
                .storePhone(app.getStorePhone())
                .userId(app.getUserId())
                .build();

        adminStoreApplicationMapper.insertStore(store);

        adminStoreApplicationMapper.insertStoreBusinessInfo(store.getStoreId());

        adminStoreApplicationMapper.updateApproved(id);
    }

    @Transactional
    public void reject(Long id, String reason) {
        StoreApplicationEntity app = detail(id);

        if (!"PENDING".equalsIgnoreCase(app.getStatus())) {
            throw new IllegalStateException("이미 처리된 신청입니다.");
        }

        if (reason == null || reason.isBlank()) {
            throw new IllegalArgumentException("반려 사유가 필요합니다.");
        }

        adminStoreApplicationMapper.updateRejected(id, reason);
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/admin/AdminStoreService.java
==================================================

package com.korit.sa_one_back.service.admin;

import com.korit.sa_one_back.dto.request.admin.AdminStoreListReqDto;
import com.korit.sa_one_back.dto.response.admin.AdminStoreDetailRespDto;
import com.korit.sa_one_back.dto.response.admin.AdminStoreListItemRespDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.mapper.admin.AdminStoreMapper;
import com.korit.sa_one_back.util.PageParam;
import com.korit.sa_one_back.util.PageUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class AdminStoreService {

    private final AdminStoreMapper adminStoreMapper;

    public PageRespDto<AdminStoreListItemRespDto> list(AdminStoreListReqDto dto) {
        PageParam pageParam = PageUtil.resolve(dto.getPage(), dto.getSize());

        int page = pageParam.getPage();
        int size = pageParam.getSize();
        int offset = pageParam.getOffset();

        String keyword = (dto.getKeyword() == null || dto.getKeyword().isBlank())
                ? null
                : dto.getKeyword().trim();

        int total = adminStoreMapper.countStores(keyword);
        List<AdminStoreListItemRespDto> items = adminStoreMapper.findStores(keyword, offset, size);

        return PageRespDto.<AdminStoreListItemRespDto>builder()
                .items(items)
                .page(page)
                .size(size)
                .total(total)
                .build();
    }

    public AdminStoreDetailRespDto detail(Long storeId) {
        AdminStoreDetailRespDto dto = adminStoreMapper.findStoreDetail(storeId);
        if (dto == null) throw new IllegalArgumentException("매장을 찾을 수 없습니다.");
        return dto;
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/AttendanceService.java
==================================================

//package com.korit.sa_one_back.service;
//
//import com.korit.sa_one_back.dto.request.AttendanceCheckInReqDto;
//import com.korit.sa_one_back.dto.request.AttendanceCheckOutReqDto;
//import com.korit.sa_one_back.dto.response.AttendanceCheckInRespDto;
//import com.korit.sa_one_back.dto.response.AttendanceCheckOutRespDto;
//import com.korit.sa_one_back.entity.AttendanceEntity;
//import com.korit.sa_one_back.mapper.AttendanceMapper;
//import lombok.RequiredArgsConstructor;
//import org.springframework.stereotype.Service;
//
//import java.time.Duration;
//import java.time.LocalDate;
//
//@Service
//@RequiredArgsConstructor
//public class AttendanceService {
//
//    private final AttendanceMapper attendanceMapper;
//
//    public AttendanceCheckInRespDto checkIn(Long userId, AttendanceCheckInReqDto reqDto) {
//
//        Long storeEmployeeId =
//                attendanceMapper.findStoreEmployeeId(userId, reqDto.getStoreId());
//        if (storeEmployeeId == null) throw new RuntimeException("직원 아님");
//
//        LocalDate workDate = reqDto.getCheckInTime().toLocalDate();
//        if (attendanceMapper.countTodayAttendance(storeEmployeeId, workDate) > 0)
//            throw new RuntimeException("이미 출근");
//
//        AttendanceEntity entity = reqDto.toEntity(storeEmployeeId);
//        attendanceMapper.insertCheckIn(entity);
//
//        return AttendanceCheckInRespDto.builder()
//                .attendanceId(entity.getAttendanceId())
//                .storeId(reqDto.getStoreId())
//                .checkInTime(reqDto.getCheckInTime())
//                .build();
//    }
//
//    public AttendanceCheckOutRespDto checkOut(Long userId, AttendanceCheckOutReqDto reqDto) {
//
//        Long storeEmployeeId =
//                attendanceMapper.findStoreEmployeeId(userId, reqDto.getStoreId());
//        if (storeEmployeeId == null) throw new RuntimeException("직원 아님");
//
//        AttendanceEntity today =
//                attendanceMapper.findTodayAttendanceForCheckOut(
//                        storeEmployeeId, reqDto.getCheckOutTime().toLocalDate());
//
//        if (today == null || today.getCheckInTime() == null)
//            throw new RuntimeException("출근 기록 없음");
//
//        int minutes = (int) Duration
//                .between(today.getCheckInTime(), reqDto.getCheckOutTime()).toMinutes();
//
//        attendanceMapper.updateCheckOut(
//                AttendanceEntity.builder()
//                        .attendanceId(today.getAttendanceId())
//                        .checkOutTime(reqDto.getCheckOutTime())
//                        .checkOutImgUrl(reqDto.getCheckOutImgUrl())
//                        .workMinutes(minutes)
//                        .attendanceStatus("DONE")
//                        .build()
//        );
//
//        return AttendanceCheckOutRespDto.builder()
//                .attendanceId(today.getAttendanceId())
//                .storeId(reqDto.getStoreId())
//                .checkOutTime(reqDto.getCheckOutTime())
//                .workedMinutes(minutes)
//                .build();
//    }
//}

//package com.korit.sa_one_back.service;
//
//import com.korit.sa_one_back.dto.request.AttendanceCheckInReqDto;
//import com.korit.sa_one_back.dto.request.AttendanceCheckOutReqDto;
//import com.korit.sa_one_back.dto.response.AttendanceCheckInRespDto;
//import com.korit.sa_one_back.dto.response.AttendanceCheckOutRespDto;
//import com.korit.sa_one_back.dto.response.MyAttendanceRespDto;
//import com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto;
//import com.korit.sa_one_back.entity.AttendanceEntity;
//import com.korit.sa_one_back.mapper.AttendanceMapper;
//import com.korit.sa_one_back.mapper.UserMapper;
//import lombok.RequiredArgsConstructor;
//import org.springframework.stereotype.Service;
//
//import java.time.Duration;
//import java.time.LocalDate;
//import java.util.HashMap;
//import java.util.List;
//import java.util.Map;
//
//@Service
//@RequiredArgsConstructor
//public class AttendanceService {
//
//    private final AttendanceMapper attendanceMapper;
//    private final UserMapper userMapper;
//
//    /**
//     *  사장(OWNER) 로그인 상태에서 직원 선택 후 출근 처리
//     *
//     * [개발자 흐름]
//     * 1) 토큰 유저 roleId 확인 → OWNER만 가능
//     * 2) storeId가 "내 매장"인지 검증(countOwnerStore)
//     * 3) (storeId + 사번 + 이름)으로 storeEmployeeId 조회
//     * 4) 오늘 이미 출근했는지 중복 체크
//     * 5) 출근 insert (사진 URL 포함)
//     */
//    public AttendanceCheckInRespDto checkIn(Long ownerUserId, AttendanceCheckInReqDto reqDto) {
//
//        Long roleId = userMapper.findRoleIdByUserId(ownerUserId);
//        if (roleId == null) throw new RuntimeException("UNAUTHORIZED");
//
//        // OWNER = 1L, EMPLOYEE = 2L, ADMIN = 3L
//        if (roleId != 1L) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
//
//
//        //  사장 소유 매장인지 검증
//        if (attendanceMapper.countOwnerStore(reqDto.getStoreId(), ownerUserId) == 0) {
//            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
//        }
//
//        //  직원 선택(사번+이름)으로 storeEmployeeId 찾기
//        Long storeEmployeeId = attendanceMapper.findStoreEmployeeIdByNoAndName(
//                reqDto.getStoreId(),
//                reqDto.getEmployeeNo(),
//                reqDto.getStoreEmployeeName()
//        );
//        if (storeEmployeeId == null) throw new RuntimeException("EMPLOYEE_NOT_FOUND");
//
//        LocalDate workDate = reqDto.getCheckInTime().toLocalDate();
//        if (attendanceMapper.countTodayAttendance(storeEmployeeId, workDate) > 0) {
//            throw new RuntimeException("ALREADY_CHECKED_IN");
//        }
//
//        AttendanceEntity entity = reqDto.toEntity(storeEmployeeId);
//        attendanceMapper.insertCheckIn(entity);
//
//        // 응답용 이름(선택한 값 그대로 써도 되지만 DB 기준으로 맞추려면 조회)
//        String employeeName = attendanceMapper.findEmployeeName(storeEmployeeId);
//
//        return AttendanceCheckInRespDto.builder()
//                .attendanceId(entity.getAttendanceId())
//                .storeId(reqDto.getStoreId())
//                .storeEmployeeId(storeEmployeeId)
//                .employeeName(employeeName)
//                .checkInTime(reqDto.getCheckInTime())
//                .build();
//    }
//
//    /**
//     * 사장(OWNER) 로그인 상태에서 직원 선택 후 퇴근 처리
//     *
//     * [개발자 흐름]
//     * 1) OWNER 확인
//     * 2) 내 매장인지 확인
//     * 3) 직원 선택(사번+이름)으로 storeEmployeeId 조회
//     * 4) 오늘 출근 기록 가져오기
//     * 5) 근무시간 계산 후 update (퇴근 사진 URL 포함)
//     */
//    public AttendanceCheckOutRespDto checkOut(Long ownerUserId, AttendanceCheckOutReqDto reqDto) {
//
//        Integer roleId = userMapper.findRoleIdByUserId(ownerUserId);
//        if (roleId == null) throw new RuntimeException("UNAUTHORIZED");
//        if (roleId != 1) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
//
//        if (attendanceMapper.countOwnerStore(reqDto.getStoreId(), ownerUserId) == 0) {
//            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
//        }
//
//        Long storeEmployeeId = attendanceMapper.findStoreEmployeeIdByNoAndName(
//                reqDto.getStoreId(),
//                reqDto.getEmployeeNo(),
//                reqDto.getStoreEmployeeName()
//        );
//        if (storeEmployeeId == null) throw new RuntimeException("EMPLOYEE_NOT_FOUND");
//
//        LocalDate workDate = reqDto.getCheckOutTime().toLocalDate();
//
//        AttendanceEntity today = attendanceMapper.findTodayAttendanceForCheckOut(storeEmployeeId, workDate);
//        if (today == null || today.getCheckInTime() == null) {
//            throw new RuntimeException("NO_CHECK_IN_RECORD");
//        }
//
//        int minutes = (int) Duration.between(today.getCheckInTime(), reqDto.getCheckOutTime()).toMinutes();
//        if (minutes < 0) minutes = 0;
//
//        attendanceMapper.updateCheckOut(reqDto.toEntity(today.getAttendanceId(), minutes));
//
//        String employeeName = attendanceMapper.findEmployeeName(storeEmployeeId);
//
//        return AttendanceCheckOutRespDto.builder()
//                .attendanceId(today.getAttendanceId())
//                .storeId(reqDto.getStoreId())
//                .storeEmployeeId(storeEmployeeId)
//                .employeeName(employeeName)
//                .checkOutTime(reqDto.getCheckOutTime())
//                .workedMinutes(minutes)
//                .build();
//    }
//
//    /**
//     * 직원: 내 출결 조회 (직원 로그인 화면)
//     * - 이건 EMPLOYEE 로그인 기준 유지
//     * - 사장이 보는 페이지는 getOwnerAttendance로 처리
//     */
//    public List<MyAttendanceRespDto> getMyAttendances(Long userId, Long storeId) {
//
//        Integer roleId = userMapper.findRoleIdByUserId(userId);
//        if (roleId == null) throw new RuntimeException("UNAUTHORIZED");
//        if (roleId != 2) throw new RuntimeException("FORBIDDEN_EMPLOYEE_ONLY");
//
//        Long storeEmployeeId = attendanceMapper.findStoreEmployeeId(userId, storeId);
//        if (storeEmployeeId == null) throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
//
//        return attendanceMapper.findMyAttendances(storeEmployeeId);
//    }
//
//    /**
//     *  사장: 매장 출근현황 조회
//     */
//    public Map<String, Object> getOwnerAttendance(Long storeId, Long ownerUserId, LocalDate workDate) {
//
//        Integer roleId = userMapper.findRoleIdByUserId(ownerUserId);
//        if (roleId == null) throw new RuntimeException("UNAUTHORIZED");
//        if (roleId != 1) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
//
//        if (attendanceMapper.countOwnerStore(storeId, ownerUserId) == 0) {
//            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
//        }
//
//        List<OwnerAttendanceRespDto> items = attendanceMapper.findOwnerAttendanceItems(storeId, workDate);
//
//        Map<String, Object> resp = new HashMap<>();
//        resp.put("storeCard", attendanceMapper.findStoreCard(storeId));
//        resp.put("openTime", attendanceMapper.findOpenTime(storeId, workDate));
//        resp.put("closeTime", attendanceMapper.findCloseTime(storeId, workDate));
//        resp.put("items", items);
//        return resp;
//    }
//}


package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.request.AttendanceCheckInReqDto;
import com.korit.sa_one_back.dto.request.AttendanceCheckOutReqDto;
import com.korit.sa_one_back.dto.response.AttendanceCheckInRespDto;
import com.korit.sa_one_back.dto.response.AttendanceCheckOutRespDto;
import com.korit.sa_one_back.dto.response.MyAttendanceRespDto;
import com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto;
import com.korit.sa_one_back.entity.AttendanceEntity;
import com.korit.sa_one_back.mapper.AttendanceMapper;
import com.korit.sa_one_back.mapper.UserMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.Duration;
import java.time.LocalDate;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class AttendanceService {

    private final AttendanceMapper attendanceMapper;
    private final UserMapper userMapper;

    /**
     * 사장 로그인 → 직원(사번+이름) 선택 → 출근 처리
     */
    public AttendanceCheckInRespDto checkIn(Long loginUserId, AttendanceCheckInReqDto reqDto) {

        int roleId = userMapper.findRoleIdByUserId(loginUserId);
        if (roleId != 2) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");

        if (attendanceMapper.countOwnerStore(reqDto.getStoreId(), loginUserId) == 0) {
            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
        }

        Long storeEmployeeId = attendanceMapper.findStoreEmployeeIdByNoAndName(
                reqDto.getStoreId(),
                reqDto.getEmployeeNo(),
                reqDto.getStoreEmployeeName()
        );
        if (storeEmployeeId == null) throw new RuntimeException("EMPLOYEE_NOT_FOUND");

        LocalDate workDate = reqDto.getCheckInTime().toLocalDate();
        if (attendanceMapper.countTodayAttendance(storeEmployeeId, workDate) > 0) {
            throw new RuntimeException("ALREADY_CHECKED_IN");
        }

        AttendanceEntity entity = reqDto.toEntity(storeEmployeeId);
        attendanceMapper.insertCheckIn(entity);

        String employeeName = attendanceMapper.findEmployeeName(storeEmployeeId);

        return AttendanceCheckInRespDto.builder()
                .attendanceId(entity.getAttendanceId())
                .storeId(reqDto.getStoreId())
                .storeEmployeeId(storeEmployeeId)
                .employeeName(employeeName)
                .checkInTime(reqDto.getCheckInTime())
                .build();
    }

    /**
     * 사장 로그인 → 직원(사번+이름) 선택 → 퇴근 처리
     */
    public AttendanceCheckOutRespDto checkOut(Long loginUserId, AttendanceCheckOutReqDto reqDto) {

        int roleId = userMapper.findRoleIdByUserId(loginUserId);
        if (roleId != 2) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");

        if (attendanceMapper.countOwnerStore(reqDto.getStoreId(), loginUserId) == 0) {
            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
        }

        Long storeEmployeeId = attendanceMapper.findStoreEmployeeIdByNoAndName(
                reqDto.getStoreId(),
                reqDto.getEmployeeNo(),
                reqDto.getStoreEmployeeName()
        );
        if (storeEmployeeId == null) throw new RuntimeException("EMPLOYEE_NOT_FOUND");

        LocalDate workDate = reqDto.getCheckOutTime().toLocalDate();
        AttendanceEntity today = attendanceMapper.findTodayAttendanceForCheckOut(storeEmployeeId, workDate);

        if (today == null || today.getCheckInTime() == null) {
            throw new RuntimeException("NO_CHECK_IN_RECORD");
        }

        int minutes = (int) Duration.between(today.getCheckInTime(), reqDto.getCheckOutTime()).toMinutes();
        if (minutes < 0) minutes = 0;

        attendanceMapper.updateCheckOut(reqDto.toEntity(today.getAttendanceId(), minutes));

        String employeeName = attendanceMapper.findEmployeeName(storeEmployeeId);

        return AttendanceCheckOutRespDto.builder()
                .attendanceId(today.getAttendanceId())
                .storeId(reqDto.getStoreId())
                .storeEmployeeId(storeEmployeeId)
                .employeeName(employeeName)
                .checkOutTime(reqDto.getCheckOutTime())
                .workedMinutes(minutes)
                .build();
    }

    /**
     * 직원 로그인: 내 출결 조회
     */
    public List<MyAttendanceRespDto> getMyAttendances(Long loginUserId, Long storeId) {

        int roleId = userMapper.findRoleIdByUserId(loginUserId);
        if (roleId != 3) throw new RuntimeException("FORBIDDEN_EMPLOYEE_ONLY");

        Long storeEmployeeId = attendanceMapper.findStoreEmployeeId(loginUserId, storeId);
        if (storeEmployeeId == null) throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");

        return attendanceMapper.findMyAttendances(storeEmployeeId);
    }

    /**
     * 사장: 매장 출근현황 조회
     */
    public Map<String, Object> getOwnerAttendance(Long storeId, Long loginUserId, LocalDate workDate) {

        int roleId = userMapper.findRoleIdByUserId(loginUserId);
        if (roleId != 2) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");

        if (attendanceMapper.countOwnerStore(storeId, loginUserId) == 0) {
            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
        }

        List<OwnerAttendanceRespDto> items = attendanceMapper.findOwnerAttendanceItems(storeId, workDate);

        Map<String, Object> resp = new HashMap<>();
        resp.put("storeCard", attendanceMapper.findStoreCard(storeId));
        resp.put("openTime", attendanceMapper.findOpenTime(storeId, workDate));
        resp.put("closeTime", attendanceMapper.findCloseTime(storeId, workDate));
        resp.put("items", items);
        return resp;
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/EmployeeService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.request.CreateEmployeeReqDto;
import com.korit.sa_one_back.dto.request.DeleteEmployeeReqDto;
import com.korit.sa_one_back.dto.response.EmployeeListRespDto;
import com.korit.sa_one_back.entity.PayEntity;
import com.korit.sa_one_back.entity.StoreEmployeeEntity;
import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.mapper.*;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.util.List;

/**
 * 직원 추가/조회/삭제(퇴사) 서비스
 */
@Service
@RequiredArgsConstructor
public class EmployeeService {

    private final StoreMapper storeMapper;
    private final UserMapper userMapper;
    private final EmployeeMapper employeeMapper;
    private final PayMapper payMapper;
    private final PositionMapper positionMapper;

    @Transactional
    public void createEmployee(Long storeId, Long ownerUserId, CreateEmployeeReqDto dto) {

        // 1) store 존재 확인
        if (storeMapper.countByStoreId(storeId) == 0) {
            throw new RuntimeException("WORKPLACE_NOT_FOUND");
        }

        // 2) 사장 권한 확인
        Long storeOwnerId = storeMapper.findOwnerUserId(storeId);
        if (storeOwnerId == null || !storeOwnerId.equals(ownerUserId)) {
            throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
        }

        // 3) positionName -> positionId 변환
        Long positionId = positionMapper.findPositionIdByName(dto.getPositionName());
        if (positionId == null) {
            throw new RuntimeException("POSITION_NOT_FOUND");
        }

        // 4) user 처리 (email 기준)
        Long employeeUserId = userMapper.findUserIdByEmail(dto.getEmail());

        if (employeeUserId == null) {
            throw new RuntimeException("USER_NOT_FOUND");
        }
        userMapper.updateEmployeeProfile(employeeUserId, dto);

        // 5) 중복 직원 체크 (storeId + userId, ACTIVE)
        if (employeeMapper.existsActiveEmployee(storeId, employeeUserId)) {
            throw new RuntimeException("DUPLICATE_EMPLOYEE");
        }

        // 6) store_employee insert
        StoreEmployeeEntity se = StoreEmployeeEntity.builder()
                .storeId(storeId)
                .userId(employeeUserId)
                .employeeNo(dto.getEmployeeNo())
                .positionId(positionId)
                .joinDate(dto.getJoinDate())
                .workStatus("ACTIVE")
                .build();

        employeeMapper.insertStoreEmployee(se);

        // 7) pay insert
        PayEntity pay = PayEntity.builder()
                .storeEmployeeId(se.getStoreEmployeeId())
                .payType(dto.getPayType())
                .hourlyRate(dto.getHourlyRate())
                .monthlySalary(dto.getMonthlySalary())
                .startDate(dto.getJoinDate())
                .endDate(null)
                .build();

        payMapper.insertPay(pay);
    }


    /**
     * 직원 목록 조회
     * - 사장만 조회 가능
     */
    @Transactional(readOnly = true)
    public List<EmployeeListRespDto> getEmployees(Long storeId, Long requestUserId) {

        if (storeMapper.countByStoreId(storeId) == 0) {
            throw new RuntimeException("WORKPLACE_NOT_FOUND");
        }

        Long storeOwnerId = storeMapper.findOwnerUserId(storeId);
        if (storeOwnerId == null || !storeOwnerId.equals(requestUserId)) {
            throw new RuntimeException("FORBIDDEN_WORKPLACE_ACCESS");
        }

        return employeeMapper.selectEmployees(storeId, LocalDate.now());
    }

    /**
     * 직원 삭제(퇴사 처리)
     * - 물리삭제 X
     * - store_employee_tb.work_status = INACTIVE
     * - 현재 유효 pay_tb.end_date = 오늘로 종료
     */
    @Transactional
    public void deleteEmployees(Long storeId, Long ownerUserId, DeleteEmployeeReqDto dto) {

        Long storeOwnerId = storeMapper.findOwnerUserId(storeId);
        if (storeOwnerId == null || !storeOwnerId.equals(ownerUserId)) {
            throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
        }

        if (dto.getStoreEmployeeId() == null || dto.getStoreEmployeeId().isEmpty()) {
            throw new RuntimeException("INVALID_REQUEST");
        }

        // 요청된 ids가 전부 이 store 소속인지 검증
        int belongCount = employeeMapper.countBelonging(storeId, dto.getStoreEmployeeId());
        if (belongCount != dto.getStoreEmployeeId().size()) {
            throw new RuntimeException("INVALID_REQUEST");
        }

        LocalDate today = LocalDate.now();

        for (Long storeEmployeeId : dto.getStoreEmployeeId()) {
            employeeMapper.updateWorkStatus(storeEmployeeId, "INACTIVE");
            payMapper.closeCurrentPayByEmployee(storeEmployeeId, today);
        }
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/inquiry/EmployeeInquiryService.java
==================================================

package com.korit.sa_one_back.service.inquiry;

import com.korit.sa_one_back.dto.request.inquiry.InquiryCreateReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryListItemRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import com.korit.sa_one_back.mapper.inquiry.EmployeeInquiryMapper;
import com.korit.sa_one_back.util.PageParam;
import com.korit.sa_one_back.util.PageUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@RequiredArgsConstructor
public class EmployeeInquiryService {

    private final EmployeeInquiryMapper employeeInquiryMapper;

    public PageRespDto<EmployeeInquiryListItemRespDto> list(
            Long userId, String status, String keyword, Integer page, Integer size
    ) {
        String resolvedStatus = (status == null || status.isBlank()) ? "OPEN" : status;
        PageParam pageParam = PageUtil.resolve(page, size);

        int total = employeeInquiryMapper.countMyInquiries(userId, resolvedStatus, keyword);
        List<EmployeeInquiryListItemRespDto> items =
                employeeInquiryMapper.findMyInquiryList(userId, resolvedStatus, keyword,
                        pageParam.getOffset(), pageParam.getSize());

        return PageRespDto.<EmployeeInquiryListItemRespDto>builder()
                .items(items)
                .page(pageParam.getPage())
                .size(pageParam.getSize())
                .total(total)
                .build();
    }

    @Transactional
    public void create(Long userId, InquiryCreateReqDto dto) {
        if (dto.getTitle() == null || dto.getTitle().isBlank()) {
            throw new IllegalArgumentException("제목이 비어있습니다.");
        }
        if (dto.getContent() == null || dto.getContent().isBlank()) {
            throw new IllegalArgumentException("내용이 비어있습니다.");
        }

        // storeId가 있으면: 해당 매장 소속 직원인지 검증
        if (dto.getStoreId() != null) {
            boolean ok = employeeInquiryMapper.existsEmployeeInStore(userId, dto.getStoreId());
            if (!ok) throw new IllegalArgumentException("해당 매장 소속 직원이 아닙니다.");
        }

        employeeInquiryMapper.insertInquiry(userId, dto.getStoreId(), dto.getTitle(), dto.getContent());
    }

    public EmployeeInquiryDetailRespDto detail(Long userId, Long inquiryId) {
        boolean mine = employeeInquiryMapper.existsMyInquiry(userId, inquiryId);
        if (!mine) throw new IllegalArgumentException("조회 권한이 없습니다.");

        EmployeeInquiryDetailRespDto detail = employeeInquiryMapper.findDetail(inquiryId);
        if (detail == null) throw new IllegalArgumentException("문의가 존재하지 않습니다.");

        List<InquiryCommentEntity> comments = employeeInquiryMapper.findComments(inquiryId);
        detail.setComments(comments);
        return detail;
    }

    @Transactional
    public void addComment(Long userId, Long inquiryId, String content) {
        if (content == null || content.isBlank()) {
            throw new IllegalArgumentException("댓글 내용이 비어있습니다.");
        }

        boolean mine = employeeInquiryMapper.existsMyInquiry(userId, inquiryId);
        if (!mine) throw new IllegalArgumentException("댓글 권한이 없습니다.");

        employeeInquiryMapper.insertComment(inquiryId, userId, content);
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/inquiry/OwnerInquiryService.java
==================================================

package com.korit.sa_one_back.service.inquiry;

import com.korit.sa_one_back.dto.request.inquiry.InquiryCreateReqDto;
import com.korit.sa_one_back.dto.response.admin.PageRespDto;
import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryDetailRespDto;
import com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryListItemRespDto;
import com.korit.sa_one_back.entity.inquiry.InquiryCommentEntity;
import com.korit.sa_one_back.mapper.inquiry.OwnerInquiryMapper;
import com.korit.sa_one_back.util.PageParam;
import com.korit.sa_one_back.util.PageUtil;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@RequiredArgsConstructor
public class OwnerInquiryService {

    private final OwnerInquiryMapper ownerInquiryMapper;

    public PageRespDto<OwnerInquiryListItemRespDto> list(
            Long ownerUserId, String status, String keyword, Integer page, Integer size
    ) {
        String resolvedStatus = (status == null || status.isBlank()) ? "OPEN" : status;
        PageParam pageParam = PageUtil.resolve(page, size);

        int total = ownerInquiryMapper.countMyInquiries(ownerUserId, resolvedStatus, keyword);
        List<OwnerInquiryListItemRespDto> items =
                ownerInquiryMapper.findMyInquiryList(ownerUserId, resolvedStatus, keyword,
                        pageParam.getOffset(), pageParam.getSize());

        return PageRespDto.<OwnerInquiryListItemRespDto>builder()
                .items(items)
                .page(pageParam.getPage())
                .size(pageParam.getSize())
                .total(total)
                .build();
    }

    @Transactional
    public void create(Long ownerUserId, InquiryCreateReqDto dto) {
        if (dto.getTitle() == null || dto.getTitle().isBlank()) {
            throw new IllegalArgumentException("제목이 비어있습니다.");
        }
        if (dto.getContent() == null || dto.getContent().isBlank()) {
            throw new IllegalArgumentException("내용이 비어있습니다.");
        }

        // storeId가 있으면: 내 매장인지 검증
        if (dto.getStoreId() != null) {
            boolean ok = ownerInquiryMapper.existsOwnerStore(ownerUserId, dto.getStoreId());
            if (!ok) throw new IllegalArgumentException("본인 매장이 아닙니다.");
        }

        ownerInquiryMapper.insertInquiry(ownerUserId, dto.getStoreId(), dto.getTitle(), dto.getContent());
    }

    public OwnerInquiryDetailRespDto detail(Long ownerUserId, Long inquiryId) {
        boolean mine = ownerInquiryMapper.existsMyInquiry(ownerUserId, inquiryId);
        if (!mine) throw new IllegalArgumentException("조회 권한이 없습니다.");

        OwnerInquiryDetailRespDto detail = ownerInquiryMapper.findDetail(inquiryId);
        if (detail == null) throw new IllegalArgumentException("문의가 존재하지 않습니다.");

        List<InquiryCommentEntity> comments = ownerInquiryMapper.findComments(inquiryId);
        detail.setComments(comments);
        return detail;
    }

    @Transactional
    public void addComment(Long ownerUserId, Long inquiryId, String content) {
        if (content == null || content.isBlank()) {
            throw new IllegalArgumentException("댓글 내용이 비어있습니다.");
        }

        boolean mine = ownerInquiryMapper.existsMyInquiry(ownerUserId, inquiryId);
        if (!mine) throw new IllegalArgumentException("댓글 권한이 없습니다.");

        ownerInquiryMapper.insertComment(inquiryId, ownerUserId, content);
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/MailService.java
==================================================

package com.korit.sa_one_back.service;

import lombok.RequiredArgsConstructor;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class MailService {
    private final JavaMailSender mailSender;

    public void sendMarkedUsername(String toEmail, String maskedUsername) {
        SimpleMailMessage msg = new SimpleMailMessage();
        msg.setTo(toEmail);
        msg.setSubject("[SA:ONE] 아이디 찾기 안내");
        msg.setText(
                "요청하신 아이디는 다음과 같습니다."
                + maskedUsername + "\n\n" +
                "본인이 요청하지 않으셨다면 무시하세요."
        );
        mailSender.send(msg);
    }

    public void sendPasswordResetMail(String toEmail, String resetLink) {
        SimpleMailMessage msg = new SimpleMailMessage();
        msg.setTo(toEmail);
        msg.setSubject("[SA:ONE] 비밀번호 재설정 안내");
        msg.setText(
                "비밀번호 재설정을 요청하셨습니다.\n\n" +
                "아래 링크에서 새 비밀번호를 설정해 주세요. \n" +
                "본 링크는 30분 후에 만료됩니다. \n" +
                resetLink + "\n\n" +
                "본인이 요청하지 않으셨다면 무시하세요."
        );
        mailSender.send(msg);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/MyCalendarService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.response.*;
import com.korit.sa_one_back.mapper.MyCalendarMapper;
import com.korit.sa_one_back.mapper.StoreMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.YearMonth;
import java.util.ArrayList;
import java.util.List;

/*
    직원 본인 캘린더
    - 직원은 수정 불가, 조회만 가능
    - store를 선택해서 "해당 store에서의 내 근무 캘린더" 조회
*/
@Service
@RequiredArgsConstructor
public class MyCalendarService {

    private final StoreMapper storeMapper;
    private final MyCalendarMapper myCalendarMapper;

    private void validateStaff(Long storeId, Long userId, String role) {
        if (!"ROLE_STAFF".equals(role)) throw new RuntimeException("FORBIDDEN_STAFF_ONLY");
        if (storeMapper.countByStoreId(storeId) == 0) throw new RuntimeException("STORE_NOT_FOUND");
    }

    public MyCalendarRespDto getMyMonth(Long storeId, int year, int month, Long userId, String role) {
        validateStaff(storeId, userId, role);

        YearMonth ym = YearMonth.of(year, month);
        LocalDate start = ym.atDay(1);
        LocalDate end = ym.atEndOfMonth();

        List<CalendarRowRespDto> rows = myCalendarMapper.findMyMonthRows(storeId, userId, start, end);

        // 내 정보(직원명/스토어명/storeEmployeeId)는 row에서 꺼내기
        Long storeEmployeeId = rows.isEmpty() ? null : rows.get(0).getStoreEmployeeId();
        String name = rows.isEmpty() ? null : rows.get(0).getName();
        String storeName = rows.isEmpty() ? null : rows.get(0).getStoreName();

        List<CalendarDayRespDto> items = new ArrayList<>();
        for (CalendarRowRespDto r : rows) {
            if (r.getWorkDate() == null) continue;

            AttendanceInfoRespDto attendance = null;
            if (r.getAttendanceId() != null) {
                attendance = AttendanceInfoRespDto.builder()
                        .attendanceId(r.getAttendanceId())
                        .checkInTime(r.getCheckInTime())
                        .checkOutTime(r.getCheckOutTime())
                        .workMinutes(r.getWorkMinutes())
                        .attendanceStatus(r.getAttendanceStatus())
                        .build();
            }

            LeaveInfoRespDto leave = null;
            if (r.getLeaveId() != null) {
                leave = LeaveInfoRespDto.builder()
                        .leaveId(r.getLeaveId())
                        .leaveTypeName(r.getLeaveTypeName())
                        .build();
            }

            items.add(CalendarDayRespDto.builder()
                    .workDate(r.getWorkDate())
                    .startTime(r.getStartTime())
                    .endTime(r.getEndTime())
                    .breakMinutes(r.getBreakMinutes())
                    .note(r.getScheduleNote())
                    .totalWorkMinutes(r.getWorkMinutes())
                    .attendance(attendance)
                    .leave(leave)
                    .build());
        }

        return MyCalendarRespDto.builder()
                .storeId(storeId)
                .storeName(storeName)
                .storeEmployeeId(storeEmployeeId)
                .name(name)
                .items(items)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/OAuth2UserService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.mapper.UserMapper;
import com.korit.sa_one_back.security.PrincipalUser;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.oauth2.client.userinfo.DefaultOAuth2UserService;
import org.springframework.security.oauth2.client.userinfo.OAuth2UserRequest;
import org.springframework.security.oauth2.core.OAuth2AuthenticationException;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.stereotype.Service;

import java.util.Collection;
import java.util.LinkedHashMap;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class OAuth2UserService extends DefaultOAuth2UserService {

//    @Override
//    public OAuth2User loadUser(OAuth2UserRequest userRequest)
//            throws OAuth2AuthenticationException {
//
//        OAuth2User oAuth2User = super.loadUser(userRequest);
//        String clientName = userRequest.getClientRegistration().getClientName();
//
//        Collection<? extends GrantedAuthority> authorities = oAuth2User.getAuthorities();
//        Map<String, Object> attributes = new LinkedHashMap<>();
//        String nameAttributeKey = null;
//        UserEntity user = null;
//
//        if ("NAVER".equalsIgnoreCase(clientName)) {
//            Map<String, Object> response =
//                    (Map<String, Object>) oAuth2User.getAttributes().get("response");
//
//            attributes.putAll(response);
//            nameAttributeKey = "id";
//
//            user = UserEntity.builder()
//                    .oauth2Id((String) response.get("id"))
//                    .name((String) response.get("name"))
//                    .email((String) response.get("email"))
//                    .provider(clientName)
//                    .imgUrl((String) response.get("profile_image"))
//                    .imgPath(null)
//                    .roleId(0) // 가입유형 미정
//                    .build();
//        }
//
//
//        return new PrincipalUser(authorities, attributes, nameAttributeKey, user);
//    }

    private final UserMapper userMapper;

    @Override
    public PrincipalUser loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {
        OAuth2User oauth2User = super.loadUser(userRequest);

        String provider = userRequest.getClientRegistration().getRegistrationId().toUpperCase();
        String oauth2Id = oauth2User.getAttribute("sub");
        String email = oauth2User.getAttribute("email");
        String name = oauth2User.getAttribute("name");

        UserEntity user = userMapper.findByOauth2IdAndProvider(provider, oauth2Id);

        return new PrincipalUser(
                oauth2User.getAttributes(),
                oauth2Id,
                provider,
                email,
                name,
                user // null 가능
        );
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/OwnerAttendanceService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.response.*;
import com.korit.sa_one_back.mapper.OwnerAttendanceMapper;
import com.korit.sa_one_back.mapper.StoreMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

/*
    사장: 특정 날짜 클릭 -> 출근 현황 팝업 데이터 제공
*/
@Service
@RequiredArgsConstructor
public class OwnerAttendanceService {

    private final StoreMapper storeMapper;
    private final OwnerAttendanceMapper ownerAttendanceMapper;

    private void validateOwner(Long storeId, Long userId, String role) {
        if (!"ROLE_OWNER".equals(role)) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
        if (storeMapper.countByStoreId(storeId) == 0) throw new RuntimeException("STORE_NOT_FOUND");
        Long ownerUserId = storeMapper.findOwnerUserId(storeId);
        if (ownerUserId == null || !ownerUserId.equals(userId)) throw new RuntimeException("FORBIDDEN_STORE_ACCESS");
    }

    public OwnerDayAttendanceRespDto getDay(Long storeId, LocalDate workDate, Long userId, String role) {
        validateOwner(storeId, userId, role);

        List<CalendarRowRespDto> rows = ownerAttendanceMapper.findOwnerDayAttendanceRows(storeId, workDate);

        List<OwnerDayAttendanceItemRespDto> items = new ArrayList<>();
        for (CalendarRowRespDto r : rows) {
            items.add(OwnerDayAttendanceItemRespDto.builder()
                    .storeEmployeeId(r.getStoreEmployeeId())
                    .userId(r.getUserId())
                    .name(r.getName())
                    .startTime(r.getStartTime())
                    .endTime(r.getEndTime())
                    .checkInTime(r.getCheckInTime())
                    .checkOutTime(r.getCheckOutTime())
                    .attendanceStatus(r.getAttendanceStatus())
                    .leave(r.getLeaveId() == null ? null : LeaveInfoRespDto.builder()
                            .leaveId(r.getLeaveId())
                            .leaveTypeName(r.getLeaveTypeName())
                            .build())
                    .build());
        }

        String storeName = rows.isEmpty() ? null : rows.get(0).getStoreName();

        return OwnerDayAttendanceRespDto.builder()
                .storeId(storeId)
                .storeName(storeName)
                .workDate(workDate)
                .items(items)
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/OwnerCalendarService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.response.*;
import com.korit.sa_one_back.mapper.OwnerCalendarMapper;
import com.korit.sa_one_back.mapper.ScheduleMapper;
import com.korit.sa_one_back.mapper.StoreMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.YearMonth;
import java.util.*;

/*
    사장 캘린더 관련 서비스

    핵심 알고리즘
    1) 사장 권한/가게 소유권 검증
    2) year/month로 해당 월의 start/end 생성
    3) MyBatis row 리스트 조회 (schedule/attendance/leave 조인)
    4) row들을 workDate 기준으로 묶기
    5) 날짜별 employees 리스트를 만들어 OwnerCalendarRespDto 구성
*/
@Service
@RequiredArgsConstructor
public class OwnerCalendarService {

    private final StoreMapper storeMapper;
    private final OwnerCalendarMapper ownerCalendarMapper;
    private final ScheduleMapper scheduleMapper;

    private void validateOwner(Long storeId, Long userId, String role) {
        if (!"ROLE_OWNER".equals(role)) {
            throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
        }
        if (storeMapper.countByStoreId(storeId) == 0) {
            throw new RuntimeException("STORE_NOT_FOUND");
        }
        Long ownerUserId = storeMapper.findOwnerUserId(storeId);
        if (ownerUserId == null || !ownerUserId.equals(userId)) {
            throw new RuntimeException("FORBIDDEN_STORE_ACCESS");
        }
    }

    public OwnerCalendarRespDto getOwnerMonth(Long storeId, int year, int month, Long userId, String role) {
        validateOwner(storeId, userId, role);

        YearMonth ym = YearMonth.of(year, month);
        LocalDate start = ym.atDay(1);
        LocalDate end = ym.atEndOfMonth();

        List<CalendarRowRespDto> rows = ownerCalendarMapper.findOwnerMonthRows(storeId, start, end);

        // 1) 날짜별로 묶기
        Map<LocalDate, List<CalendarRowRespDto>> byDate = new LinkedHashMap<>();
        for (CalendarRowRespDto r : rows) {
            // schedule이 없는 직원은 work_date가 null일 수 있음
            // 월 캘린더에 표시할 "기준 날짜"가 없으니 제외(원하면 정책 바꿀 수 있음)
            if (r.getWorkDate() == null) continue;

            byDate.computeIfAbsent(r.getWorkDate(), k -> new ArrayList<>()).add(r);
        }

        // 2) 날짜별 응답 DTO 구성
        List<CalendarDayRespDto> items = new ArrayList<>();
        for (Map.Entry<LocalDate, List<CalendarRowRespDto>> entry : byDate.entrySet()) {
            LocalDate workDate = entry.getKey();
            List<CalendarRowRespDto> dayRows = entry.getValue();

            List<EmployeeCalendarRespDto> employees = new ArrayList<>();
            for (CalendarRowRespDto r : dayRows) {
                employees.add(buildEmployeeSummary(r));
            }

            items.add(CalendarDayRespDto.builder()
                    .workDate(workDate)
                    .items(employees)
                    .build());
        }

//        String storeName = rows.isEmpty() ? null : rows.get(0).getStoreName();
        String storeName = storeMapper.findStoreName(storeId);
        return OwnerCalendarRespDto.builder()
                .storeId(storeId)
                .storeName(storeName)
                .items(items)
                .build();
    }

    // 사장 -> 직원 개인 캘린더 상세(월)
    public EmployeeCalendarRespDto getOwnerEmployeeMonth(Long storeId, Long storeEmployeeId,
                                                         int year, int month,
                                                         Long userId, String role) {
        validateOwner(storeId, userId, role);

        if (scheduleMapper.countStoreEmployeeInStore(storeId, storeEmployeeId) == 0) {
            throw new RuntimeException("STORE_EMPLOYEE_NOT_FOUND");
        }

        YearMonth ym = YearMonth.of(year, month);
        LocalDate start = ym.atDay(1);
        LocalDate end = ym.atEndOfMonth();

        List<CalendarRowRespDto> rows =
                ownerCalendarMapper.findOwnerEmployeeMonthRows(storeId, storeEmployeeId, start, end);

        // 직원 정보는 rows 첫 줄에서 가져옴(없으면 가게에 직원은 있는데 해당 월 일정이 없을 수 있음)
        Long userIdFromRow = rows.isEmpty() ? null : rows.get(0).getUserId();
        String nameFromRow = rows.isEmpty() ? null : rows.get(0).getName();
        String storeName = rows.isEmpty() ? null : rows.get(0).getStoreName();

        List<EmployeeCalendarItemRespDto> items = new ArrayList<>();
        for (CalendarRowRespDto r : rows) {
            if (r.getWorkDate() == null) continue;

            items.add(EmployeeCalendarItemRespDto.builder()
                    .workDate(r.getWorkDate())
                    .scheduleId(r.getScheduleId())
                    .startTime(r.getStartTime())
                    .endTime(r.getEndTime())
                    .breakMinutes(r.getBreakMinutes())
                    .note(r.getScheduleNote())
                    .attendance(buildAttendance(r))
                    .leave(buildLeave(r))
                    .build());
        }

        return EmployeeCalendarRespDto.builder()
                .storeId(storeId)
                .storeName(storeName)
                .storeEmployeeId(storeEmployeeId)
                .userId(userIdFromRow)
                .name(nameFromRow)
                .items(items)
                .build();
    }

    private EmployeeCalendarRespDto buildEmployeeSummary(CalendarRowRespDto r) {
        return EmployeeCalendarRespDto.builder()
                .storeId(r.getStoreId())
                .storeName(r.getStoreName())
                .storeEmployeeId(r.getStoreEmployeeId())
                .userId(r.getUserId())
                .name(r.getName())
                .startTime(r.getStartTime())
                .endTime(r.getEndTime())
                .note(r.getScheduleNote())
                .checkInTime(r.getCheckInTime())
                .checkOutTime(r.getCheckOutTime())
                .attendanceStatus(r.getAttendanceStatus())
                .leave(buildLeave(r))
                .build();
    }

    private AttendanceInfoRespDto buildAttendance(CalendarRowRespDto r) {
        if (r.getAttendanceId() == null) return null;
        return AttendanceInfoRespDto.builder()
                .attendanceId(r.getAttendanceId())
                .checkInTime(r.getCheckInTime())
                .checkOutTime(r.getCheckOutTime())
                .workMinutes(r.getWorkMinutes())
                .attendanceStatus(r.getAttendanceStatus())
                .build();
    }

    private LeaveInfoRespDto buildLeave(CalendarRowRespDto r) {
        if (r.getLeaveId() == null) return null;
        return LeaveInfoRespDto.builder()
                .leaveId(r.getLeaveId())
                .leaveType(r.getLeaveType())
                .leaveTypeName(r.getLeaveTypeName())
                .build();
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/OwnerScheduleService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.entity.ScheduleEntity;
import com.korit.sa_one_back.mapper.ScheduleMapper;
import com.korit.sa_one_back.mapper.StoreMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

/*
    사장이 직원 스케줄을 등록/수정/삭제하는 서비스

    권한 정책
    - ROLE_OWNER만 가능
    - 해당 storeId의 진짜 소유주인지 확인
    - storeEmployeeId가 그 store 소속인지 확인
    - scheduleId 수정/삭제 시 그 schedule이 해당 store 소속인지 확인
*/
@Service
@RequiredArgsConstructor
public class OwnerScheduleService {

    private final StoreMapper storeMapper;
    private final ScheduleMapper scheduleMapper;

    private void validateOwner(Long storeId, Long userId, String role) {
        if (!"ROLE_OWNER".equals(role)) throw new RuntimeException("FORBIDDEN_OWNER_ONLY");
        if (storeMapper.countByStoreId(storeId) == 0) throw new RuntimeException("STORE_NOT_FOUND");

        Long ownerUserId = storeMapper.findOwnerUserId(storeId);
        if (ownerUserId == null || !ownerUserId.equals(userId)) throw new RuntimeException("FORBIDDEN_STORE_ACCESS");
    }

    public Long create(Long storeId, Long storeEmployeeId, ScheduleEntity entity, Long userId, String role) {
        validateOwner(storeId, userId, role);

        if (scheduleMapper.countStoreEmployeeInStore(storeId, storeEmployeeId) == 0) {
            throw new RuntimeException("STORE_EMPLOYEE_NOT_FOUND");
        }

        // entity는 DTO에서 toEntity(storeEmployeeId)로 완성됨
        int result = scheduleMapper.insertSchedule(entity);
        if (result == 0) throw new RuntimeException("SCHEDULE_CREATE_FAIL");

        return entity.getScheduleId();
    }

    public void update(Long storeId, Long scheduleId, ScheduleEntity entity, Long userId, String role) {
        validateOwner(storeId, userId, role);

        if (scheduleMapper.countScheduleInStore(storeId, scheduleId) == 0) {
            throw new RuntimeException("SCHEDULE_NOT_FOUND");
        }

        // 프론트에서 scheduleId를 바꿔치기 못하도록 강제로 덮어쓰기
        entity.setScheduleId(scheduleId);

        int result = scheduleMapper.updateSchedule(entity);
        if (result == 0) throw new RuntimeException("SCHEDULE_UPDATE_FAIL");
    }

    public void delete(Long storeId, Long scheduleId, Long userId, String role) {
        validateOwner(storeId, userId, role);

        if (scheduleMapper.countScheduleInStore(storeId, scheduleId) == 0) {
            throw new RuntimeException("SCHEDULE_NOT_FOUND");
        }

        int result = scheduleMapper.deleteSchedule(scheduleId);
        if (result == 0) throw new RuntimeException("SCHEDULE_DELETE_FAIL");
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/PasswordResetService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.mapper.UserMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Service;

import java.util.UUID;
import java.util.concurrent.TimeUnit;

@Service
@RequiredArgsConstructor
public class PasswordResetService {

    private final UserMapper userMapper;
    private final MailService mailService;
    private final BCryptPasswordEncoder passwordEncoder;

    private final StringRedisTemplate redisTemplate;
    private static final String prefix = "password-reset:";
    private static final long ttl_min = 30;

    @Value("${app.base-url}")
    private String baseUrl;

    public void save(String token, Long userId) {
        redisTemplate.opsForValue().set(
                prefix + token,
                userId.toString(),
                ttl_min,
                TimeUnit.MINUTES
        );
    }

    public Long getUserId(String token) {
        String value = redisTemplate.opsForValue().get(prefix + token);
        return value == null ? null : Long.valueOf(value);
    }

    public void delete(String token) {
        redisTemplate.delete(prefix + token);
    }

    public void requestPasswordReset(String email) {
        Long userId = userMapper.findUserIdByEmail(email);

        if (userId == null) {
            return;
        }

        String tempToken = UUID.randomUUID().toString().replace("-", "");

        save(tempToken, userId);

        String resetUrl = baseUrl + "/reset-password?token=" + tempToken;
        mailService.sendPasswordResetMail(email, resetUrl);
    }

    public void confirmPasswordReset(String token,
                                     String newPassword,
                                     String newPasswordConfirm) {
        if (token == null || token.isBlank()) {
            throw new IllegalArgumentException("토큰이 유효하지 않습니다.");
        }
        if (newPassword == null || newPassword.isBlank()) {
            throw new IllegalArgumentException("비밀번호를 입력해 주세요.");
        }
        if (!newPassword.equals(newPasswordConfirm)) {
            throw new IllegalArgumentException("비밀번호가 일치하지 않습니다.");
        }

        Long userId = getUserId(token);
        if (userId == null) {
            throw new IllegalArgumentException("유효하지 않거나 만료된 토큰입니다.");
        }

        String encodedPassword = passwordEncoder.encode(newPassword);

        int updated = userMapper.updatePassword(userId, encodedPassword);
        if (updated == 0) {
            throw new IllegalStateException("비밀번호 변경에 실패하였습니다.");
        }

        delete(token);
    }
}

==================================================
FILE: src/main/java/com/korit/sa_one_back/service/payroll/PayrollFunctions.java
==================================================

package com.korit.sa_one_back.service.payroll;

import com.korit.sa_one_back.dto.request.payroll.PayrollDetailDto;
import com.korit.sa_one_back.entity.payroll.InsuranceRateEntity;
import com.korit.sa_one_back.entity.payroll.LimitEntity;
import com.korit.sa_one_back.entity.payroll.PayrollDetailEntity;
import com.korit.sa_one_back.mapper.PayrollMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.math.RoundingMode;
import java.time.YearMonth;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class PayrollFunctions {

    private final PayrollMapper payrollMapper;

    public YearMonth parseYearMonth(String yyyyMm) {
        if (yyyyMm == null || yyyyMm.length() != 6) {
            throw new IllegalStateException("월별 급여명세서 형식은 yyyymm 이어야 합니다. :" + yyyyMm);
        }
        int year = Integer.parseInt(yyyyMm.substring(0, 4));
        int month = Integer.parseInt(yyyyMm.substring(4, 6));
        return YearMonth.of(year, month);
    }

    public int calcMinutesPay(int minutes, int hourlyRate) {
        BigDecimal perMinutes =
                BigDecimal.valueOf(hourlyRate)
                        .divide(BigDecimal.valueOf(60), 10, RoundingMode.HALF_UP);
        return perMinutes.multiply(BigDecimal.valueOf(minutes))
                .setScale(0, RoundingMode.HALF_UP)
                .intValue();
    }

    public int calcPremium(int premiumMinutes, int hourlyRate, double multiplier) {
        if (premiumMinutes <= 0) return 0;
        if (multiplier <= 1.0) return 0;

        BigDecimal extra = BigDecimal.valueOf(multiplier).subtract(BigDecimal.ONE);

        BigDecimal perMinute =
                BigDecimal.valueOf(hourlyRate)
                        .divide(BigDecimal.valueOf(60), 10, RoundingMode.HALF_UP);

        BigDecimal amount = perMinute
                .multiply(BigDecimal.valueOf(premiumMinutes))
                .multiply(extra);

        return amount.setScale(0, RoundingMode.HALF_UP).intValue();
    }

    public int calcRateAmount(int baseAmount, double rate) {
        if (rate <= 0) return 0;
        return BigDecimal
                .valueOf(baseAmount)
                .multiply(BigDecimal.valueOf(rate))
                .setScale(0, RoundingMode.HALF_UP)
                .intValue();
    }

    public int calcInsuranceWithLimit(int grossPay,
                                       LimitEntity limitEntity,
                                       InsuranceRateEntity rateEntity) {
        if (rateEntity == null) return 0;
        double rate = rateEntity.getEmployeeRate();
        if (rate <= 0) return 0;

        int base = grossPay;
        if (limitEntity != null) {
            base = Math.max(base, limitEntity.getLowerLimit());
            base = Math.min(base, limitEntity.getUpperLimit());
        }

        return calcRateAmount(base, rate);
    }

    public int calcInsuranceWithNoLimit(int grossPay, InsuranceRateEntity rateEntity) {
        if (rateEntity == null) return 0;
        double rate = rateEntity.getEmployeeRate();
        if (rate <= 0) return 0;
        return calcRateAmount(grossPay, rate);
    }

    public void addDetail(List<PayrollDetailEntity> details,
                          Long payrollId,
                          Map<String, Long> itemIdMap,
                          PayrollDetailDto dto) {
        Long itemId = itemIdMap.get(dto.getItemCode());

        if (itemId == null) {
            throw new IllegalStateException("payroll_item_id에 item_code가 없습니다." + dto.getItemCode());
        }

        details.add(dto.toEntity(payrollId, itemId));
    }

    public Double rateOrNull(InsuranceRateEntity entity) {
        if (entity == null) return null;
        double rate = entity.getEmployeeRate();
        return (rate <= 0) ? null : rate;
    }

    public Map<String, Long> loadPayrollItemIdMap() {
        List<Map<String, Object>> rows = payrollMapper.findPayrollItemCodeIdList();
        Map<String, Long> map = new HashMap<>();
        for (Map<String, Object> r : rows) {
            String code = (String) r.get("itemCode");
            Object idObj = r.get("payrollItemId");
            if (code == null || idObj == null) continue;
            map.put(code, ((Number) idObj).longValue());
        }
        return map;
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/payroll/PayrollService.java
==================================================

package com.korit.sa_one_back.service.payroll;

import com.korit.sa_one_back.dto.request.payroll.PayrollDetailDto;
import com.korit.sa_one_back.dto.request.payroll.PayrollDto;
import com.korit.sa_one_back.dto.response.PayrollDetailRespDto;
import com.korit.sa_one_back.dto.response.PayrollDetailViewRespDto;
import com.korit.sa_one_back.entity.PayEntity;
import com.korit.sa_one_back.entity.payroll.*;
import com.korit.sa_one_back.mapper.PayrollMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.time.YearMonth;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class PayrollService {

    private final PayrollMapper payrollMapper;
    private final PayrollFunctions payrollFunctions;

    @Transactional
    public Long generateMyPayroll(Long userId, Long storeId, String payslipYearMonth) {
        Long storeEmployeeId = storeEmployeeId(userId, storeId);
        return generatePayrollForEmployeeMonth(storeId, storeEmployeeId, payslipYearMonth);
    }

    public PayrollEntity getMyPayroll(Long userId, Long storeId, String payslipYearMonth) {
        Long storeEmployeeId = payrollMapper.findStoreEmployeePayrollByUserIdAndStoreId(userId, storeId);
        PayrollEntity payroll = payrollMapper.findPayrollByYm(storeEmployeeId, payslipYearMonth );
        if (payroll == null) {
            throw new IllegalStateException("급여 명세서가 없습니다. 날짜 :" + payslipYearMonth);
        }
        return payroll;
    }

    public List<PayrollDetailEntity> getMyPayrollDetails(Long userId, Long storeId, String payslipYearMonth) {
        PayrollEntity payroll = getMyPayroll(userId, storeId, payslipYearMonth);
        return payrollMapper.findPayrollDetailsByPayrollId(payroll.getPayrollId());
    }

    private Long storeEmployeeId(Long userId, Long storeId) {
        Long storeEmployeeId = payrollMapper.findStoreEmployeePayrollByUserIdAndStoreId(userId, storeId);
        if (storeEmployeeId == null) {
            throw new IllegalStateException("해당 매장의 직원이 아닙니다.");
        }
        return storeEmployeeId;
    }

    @Transactional
    public Long generatePayrollForEmployeeMonth(Long storeId,
                                                Long storeEmployeeId,
                                                String payslipYearMonth) {
        PayrollEntity existPayroll = payrollMapper.findPayrollByYm(storeEmployeeId, payslipYearMonth);
        if (existPayroll != null) return existPayroll.getPayrollId();

        YearMonth ym = YearMonth.parse(payslipYearMonth);
        LocalDate periodStart = ym.atDay(1);
        LocalDate periodEnd = ym.atEndOfMonth();
        LocalDate asOf = periodEnd;

        MonthlyAttendanceSummaryEntity monthlyEntity = payrollMapper.findMonthlySummary(storeEmployeeId, payslipYearMonth);
        if (monthlyEntity == null) {
            throw new IllegalStateException("월별 출퇴 요약 데이터가 없습니다. storeEmployeeId :"
            + storeEmployeeId + ", 급여명세서 년월 :" + payslipYearMonth);
        }

        PayEntity payEntity = payrollMapper.findEffectivePay(storeEmployeeId, asOf);
        if (payEntity == null) {
            throw new IllegalStateException("유효한 월급 데이터가 없습니다. storeEmployeeId : "
            + storeEmployeeId);
        }

        PayPolicyEntity policyEntity = payrollMapper.findEffectivePolicy(storeId, asOf);
        if (policyEntity == null) {
            throw new IllegalStateException("유효한 월급 정책 데이터가 없습니다. storeId: "
            + storeId);
        }

        Integer hourlyRate = payEntity.getHourlyRate();
        if (hourlyRate == null || hourlyRate <= 0) {
            throw new IllegalStateException("정해진 시급이 없습니다. payId :"
            + payEntity.getPayId() + ", hourlyRate : " + hourlyRate);
        }

        int weeklyAllowanceAmount = 0;
        if (policyEntity.isWeeklyAllowanceYn()) {
            Integer sum = payrollMapper.sumWeeklyAllowanceAmountInMonth(storeEmployeeId, periodStart, periodEnd);
            weeklyAllowanceAmount = (sum == null) ? 0 : sum;
        }

        int totalWorkMinutes = monthlyEntity.getTotalWorkMinutes();
        int totalOvertimeMinutes = monthlyEntity.getTotalOvertimeMinutes();
        int totalNightMinutes = monthlyEntity.getTotalNightMinutes();

        int basePay = payrollFunctions.calcMinutesPay(totalWorkMinutes, hourlyRate);

        double overtimeMultiplier = (policyEntity.getOvertimeMultiplier() <= 0) ? 1.50 : policyEntity.getOvertimeMultiplier();
        double nightMultiplier = (policyEntity.getNightMultiplier() <= 0) ? 1.50 : policyEntity.getNightMultiplier();

        int overtimePremium = payrollFunctions.calcPremium(totalOvertimeMinutes, hourlyRate, overtimeMultiplier);
        int nightPremium = payrollFunctions.calcPremium(totalNightMinutes, hourlyRate, nightMultiplier);

        int grossPay = basePay + weeklyAllowanceAmount + overtimePremium + nightPremium;

        int year = ym.getYear();

        TaxRateEntity taxRateEntity = payrollMapper.findTaxRate(year);
        LimitEntity pensionLimit = payrollMapper.findNationalPensionLimit(year);
        LimitEntity healthLimit = payrollMapper.findHealthInsuranceLimit(year);

        InsuranceRateEntity pensionRate = payrollMapper.findInsuranceRate("NATIONAL_PENSION", year);
        InsuranceRateEntity healthRate = payrollMapper.findInsuranceRate("HEALTH_INSURANCE", year);
        InsuranceRateEntity employmentRate = payrollMapper.findInsuranceRate("EMPLOYMENT_INSURANCE", year);
        InsuranceRateEntity accidentRate = payrollMapper.findInsuranceRate("ACCIDENT_INSURANCE", year);

        int incomeTax = payrollFunctions.calcRateAmount(grossPay, taxRateEntity.getIncomeTaxRate());
        int localTax = payrollFunctions.calcRateAmount(incomeTax, taxRateEntity.getLocalTaxRate());

        int nationalPension = payrollFunctions.calcInsuranceWithLimit(grossPay, pensionLimit, pensionRate);
        int healthInsurance = payrollFunctions.calcInsuranceWithLimit(grossPay, healthLimit, healthRate);
        int employmentInsurance = payrollFunctions.calcInsuranceWithNoLimit(grossPay, employmentRate);

        int totalDeduction = incomeTax + localTax + nationalPension + healthInsurance + employmentInsurance;
        int netPay = grossPay - totalDeduction;

        int industrialAccidentInsurance = payrollFunctions.calcInsuranceWithNoLimit(grossPay, accidentRate);

        PayrollDto dto = PayrollDto.builder()
                .storeEmployeeId(storeEmployeeId)
                .payslipYearMonth(payslipYearMonth)
                .periodStart(periodStart)
                .periodEnd(periodEnd)
                .payDate(null)
                .status("DRAFT")
                .weeklyAllowanceYn(policyEntity.isWeeklyAllowanceYn())
                .overtimeMultiplier(overtimeMultiplier)
                .nightMultiplier(nightMultiplier)

                .totalWorkMinutes(totalWorkMinutes)
                .totalOvertimeMinutes(totalOvertimeMinutes)
                .totalNightMinutes(totalNightMinutes)

                .grossPay(grossPay)
                .totalDeduction(totalDeduction)
                .netPay(netPay)

                .incomeTaxRate(taxRateEntity.getIncomeTaxRate())
                .localTaxRate(taxRateEntity.getLocalTaxRate())
                .nationalPensionRate(payrollFunctions.rateOrNull(pensionRate))
                .healthInsuranceRate(payrollFunctions.rateOrNull(healthRate))
                .employmentInsuranceRate(payrollFunctions.rateOrNull(employmentRate))
                .industrialAccidentInsurance(industrialAccidentInsurance)

                .build();

        PayrollEntity payroll = dto.toEntity();

        payrollMapper.insertPayroll(payroll);
        Long payrollId = payroll.getPayrollId();

        Map<String, Long> itemIdMap = payrollFunctions.loadPayrollItemIdMap();
        List<PayrollDetailEntity> details = new ArrayList<>();

        payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("BASE")
                                .amount(basePay)
                                .minutes(totalWorkMinutes)
                                .unitPrice(hourlyRate)
                                .multiplier(1.0)
                                .memo("기본급")
                                .build());

        if (weeklyAllowanceAmount > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("WEEKLY_ALLOWANCE")
                                .amount(weeklyAllowanceAmount)
                                .memo("주휴수당")
                                .build());

        if (overtimePremium > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("OVERTIME_PREMIUM")
                                .amount(overtimePremium)
                                .minutes(totalOvertimeMinutes)
                                .unitPrice(hourlyRate)
                                .multiplier(overtimeMultiplier)
                                .memo("연장 프리미엄")
                                .build());

        if (nightPremium > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("NIGHT_PREMIUM")
                                .amount(nightPremium)
                                .minutes(totalNightMinutes)
                                .unitPrice(hourlyRate)
                                .multiplier(nightMultiplier)
                                .memo("야간 프리미엄")
                                .build());

        if (incomeTax > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("INCOME_TAX")
                                .amount(incomeTax)
                                .memo("소득세")
                                .build());

        if (localTax > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("LOCAL_TAX")
                                .amount(localTax)
                                .memo("지방소득세")
                                .build());

        if (nationalPension > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("NATIONAL_PENSION")
                                .amount(nationalPension)
                                .memo("국민연금(근로자)")
                                .build());

        if (healthInsurance > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("HEALTH_INSURANCE")
                                .amount(healthInsurance)
                                .memo("건강보험(근로자)")
                                .build());

        if (employmentInsurance > 0) payrollFunctions
                .addDetail(details, payrollId, itemIdMap,
                        PayrollDetailDto.builder()
                                .itemCode("EMPLOYMENT_INSURANCE")
                                .amount(employmentInsurance)
                                .memo("고용보험(근로자)")
                                .build());

        if (!details.isEmpty()) {
            payrollMapper.insertPayrollDetails(details);
        }

        return payrollId;
    }

    public List<PayrollEntity> listMyPayrolls(Long userId, Long storeId) {
        Long storeEmployeeId = storeEmployeeId(userId, storeId);
        return payrollMapper.findPayrollListByStoreEmployeeId(storeEmployeeId);
    }

    public PayrollDetailRespDto getMyPayrollDetail(Long userId, Long storeId, String yyyyMM) {
        PayrollEntity payroll = getMyPayroll(userId, storeId, yyyyMM);
        List<PayrollDetailViewRespDto> details = payrollMapper.findPayrollDetailViewByPayrollId(payroll.getPayrollId());
        return new PayrollDetailRespDto(payroll, details);
    }

}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/StoreApplicationService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.request.admin.StoreApplicationReqDto;
import com.korit.sa_one_back.dto.response.MyStoreRespDto;
import com.korit.sa_one_back.entity.StoreApplicationEntity;
import com.korit.sa_one_back.exception.StoreApplicationException;
import com.korit.sa_one_back.mapper.StoreMapper;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.List;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class StoreApplicationService {
    private final StoreMapper storeMapper;

    // 유저용
    public void postMyApplication(StoreApplicationReqDto dto, Long userId) {
        StoreApplicationEntity storeApplicationEntity = dto.toStoreApplicationEntity(userId);

        storeMapper.insertStoreApplication(storeApplicationEntity);
    }

    public StoreApplicationEntity getMyApplication (Long userId) {
        StoreApplicationEntity storeApplication = storeMapper.selectByUserId(userId);

        if (storeApplication == null) {
            throw new StoreApplicationException();
        }

        return storeApplication;
    }

    public List<MyStoreRespDto> getMyStores(Long userId) {
        return storeMapper.findMyStoresByUserId(userId)
                .stream()
                .map(MyStoreRespDto::fromEntity)
                .collect(Collectors.toList());
    }

    // 어드민용
    @Transactional
    public void createStoreInformation(StoreApplicationReqDto dto) throws IllegalAccessException {
        StoreApplicationEntity storeApplication = storeMapper.selectByApplicationIdForAdmin(dto.getStoreApplicationId());

        if (storeApplication == null) {
            throw new IllegalAccessException("요청하신 신청 정보를 찾을 수 없습니다.");
        }

        if (!"PENDING".equalsIgnoreCase(storeApplication.getStatus())) {
            throw new IllegalAccessException("이미 처리된 신청입니다.");
        }

        storeMapper.insertStore(dto.toStoreEntity());

        storeMapper.updateApplicationStatus(dto.getStoreApplicationId(), "APPROVED", LocalDateTime.now(), null);
    }

    public void rejectApplication(Long storeApplicationId, String rejectReason) throws IllegalAccessException {
        StoreApplicationEntity storeApplication = storeMapper.selectByApplicationIdForAdmin(storeApplicationId);

        if (storeApplication == null) {
            throw new IllegalAccessException("요청하신 신청 정보를 찾을 수 없습니다.");
        }

        if (!"REJECTED".equalsIgnoreCase(storeApplication.getStatus())) {
            throw new IllegalAccessException("이미 처리된 신청입니다.");
        }

        storeMapper.updateApplicationStatus(storeApplicationId, "REJECTED", LocalDateTime.now(), rejectReason);
    }
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/service/UserService.java
==================================================

package com.korit.sa_one_back.service;

import com.korit.sa_one_back.dto.request.*;
import com.korit.sa_one_back.dto.response.UserMeRespDto;
import com.korit.sa_one_back.entity.UserEntity;
import com.korit.sa_one_back.jwt.JwtTokenProvider;
import com.korit.sa_one_back.mapper.MyPageMapper;
import com.korit.sa_one_back.mapper.UserMapper;
import com.korit.sa_one_back.security.PrincipalUser;
import lombok.RequiredArgsConstructor;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.oauth2.client.userinfo.DefaultOAuth2UserService;
import org.springframework.security.oauth2.client.userinfo.OAuth2UserRequest;
import org.springframework.security.oauth2.core.OAuth2AuthenticationException;
import org.springframework.security.oauth2.core.user.OAuth2User;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.UUID;


@Service
@RequiredArgsConstructor
public class UserService extends DefaultOAuth2UserService {

    private final UserMapper userMapper;
    private final JwtTokenProvider jwtTokenProvider;
    private final BCryptPasswordEncoder passwordEncoder;
    private final MyPageMapper myPageMapper;
    private final MailService mailService;

    // Local 회원 생성
    public void createLocalUser(SignUpReqDto dto) {
        UserEntity user = dto.toLocalEntity(passwordEncoder);
        userMapper.insertLocalUser(user);
    }

    // OAuth2 회원 생성
    public void createOauth2User(OAuth2SignUpReqDto dto) {
        String password = UUID.randomUUID().toString();
        String encodedPassword = passwordEncoder.encode(password);
        UserEntity user = dto.toOauth2Entity(encodedPassword);
        userMapper.insertOauth2User(user);
    }

    public String signin(SignInReqDto dto) {
        final String username = dto.getUsername();
        final String password = dto.getPassword();
        final String defaultMessage = "사용자 정보를 확인하세요.";

        UserEntity foundUser = userMapper.findUserByUsername(username);
        if (foundUser == null) {
            throw new UsernameNotFoundException(defaultMessage);
        }
        if (!passwordEncoder.matches(password, foundUser.getPassword())) {
            throw new BadCredentialsException(defaultMessage);
        }
        // 토큰 생성
        final String accessToken = jwtTokenProvider.createToken(foundUser);

        return accessToken;
    }

    public void deleteUser(long userId, String rawPassword) throws IllegalAccessException {
        UserEntity user = userMapper.findByUserId(userId);

        if (user == null || user.isDeleted()) {
            throw new IllegalAccessException("이미 탈퇴한 사용자 입니다.");
        }

        boolean isOauthUser = user.getProvider() != null && !user.getProvider().isBlank()
                && user.getOauth2Id() != null && !user.getOauth2Id().isBlank();

        // Local 유저면 비번 검증
        if (!isOauthUser) {
            if (rawPassword == null || rawPassword.isBlank()) {
                throw new BadCredentialsException("비밀번호를 입력해주세요.");
            }
            if (user.getPassword() == null || !passwordEncoder.matches(rawPassword, user.getPassword())) {
                throw new BadCredentialsException("비밀번호가 일치하지 않습니다.");
            }
        }

        int result = userMapper.softDelete(userId);
        if (result == 0) {
            throw new IllegalAccessException("회원탈퇴 처리 실패");
        }
    }

    /**
     * 마이페이지 정보 조회 (사장 / 직원 공통)
     * 1) userId로 user_tb 조회 (공통 정보)
     * 2) role_tb join해서 role_name 조회
     * 3) role에 따라 필요한 정보만 추가 조회
     * - EMPLOYEE → employeeInfo
     * - OWNER / MANAGER → ownerInfo (매장 목록 + 선택 매장)
     * 4) 하나의 Response DTO로 조립해서 반환
     */
    public UserMeRespDto getMyPage(Long userId, Long storeId) {

        // 공통 유저 정보
        UserEntity user = userMapper.findByUserId(userId);

        // role 이름 (OWNER / MANAGER / EMPLOYEE)
        String roleName = userMapper.findRoleNameByUserId(userId);

        // role별 추가 정보 (기본 null)
        UserMeRespDto.EmployeeInfo employeeInfo = null;
        UserMeRespDto.OwnerInfo ownerInfo = null;

        // 직원인 경우
        if ("EMPLOYEE".equals(roleName)) {
            employeeInfo = myPageMapper.findEmployeeInfoByUserId(userId);

            // 사장 / 매니저인 경우
        } else if ("OWNER".equals(roleName) || "MANAGER".equals(roleName)) {

            // (1) 내 사업장 목록
            List<UserMeRespDto.StoreInfo> storeList =
                    myPageMapper.findMyStoreList(userId);

            // (2) 선택된 storeId 결정
            // - 프론트에서 storeId 안 주면 첫 번째 매장 자동 선택
            Long resolvedStoreId = storeId;
            if (resolvedStoreId == null) {
                resolvedStoreId = myPageMapper.findFirstStoreId(userId);
            }

            // (3) 선택된 사업장 상세
            UserMeRespDto.StoreInfo selectedStore = null;
            if (resolvedStoreId != null) {
                selectedStore =
                        myPageMapper.findMyStoreDetail(userId, resolvedStoreId);
            }

            ownerInfo = UserMeRespDto.OwnerInfo.builder()
                    .storeList(storeList)
                    .selectedStore(selectedStore)
                    .build();
        }

        // 최종 응답 DTO 조립
        return UserMeRespDto.builder()
                .userId(user.getUserId())
                .role(roleName)
                .username(user.getUsername())

                .email(user.getEmail())
                .phone(user.getPhone())
                .imgUrl(user.getImgUrl())

                .name(user.getName())
                .gender(user.getGender())
                .birthDate(user.getBirthDate())

                .employeeInfo(employeeInfo)
                .ownerInfo(ownerInfo)
                .build();
    }

    /**
     * 마이페이지 수정

     * 1) 로그인 userId를 서버에서 확정한다 (프론트가 바꾸게 두면 안 됨)
     * 2) PATCH이므로 넘어온 값만 Entity에 담는다
     * 3) mapper update 실행
     * 4) 반영된 row가 0이면 예외(유저 없음 등)
     */
    public void updateMyPage(Long userId, UpdateMyPageReqDto dto) {

        UserEntity user = new UserEntity();
        user.setUserId(userId);

        // PATCH: null/빈문자면 수정하지 않도록 mapper에서 if 처리함
        user.setEmail(dto.getEmail());
        user.setPhone(dto.getPhone());
        user.setImgUrl(dto.getImgUrl());

        int result = userMapper.updateMyPage(user);

        if (result == 0) {
            throw new RuntimeException("회원 정보 수정에 실패했습니다.");
        }
    }

    public void findUsernameAndSendMail(FindUsernameReqDto dto) {
        String username = userMapper.findUsernameByNameAndEmail(dto.getName(), dto.getEmail());

        if (username == null || username.isBlank()) return;

        String masked = maskingUsername(username);
        mailService.sendMarkedUsername(dto.getEmail(), masked);
    }

    private String maskingUsername(String username) {
        int n = username.length();
        if (n <= 1) return "*";
        if (n == 2) return username.charAt(0) + "*";
        if (n <= 4) return username.substring(0, 1) + "**" + username.substring(n - 1);
        return username.substring(0,2) + "***" + username.substring(n - 2);
    }
}



==================================================
FILE: src/main/java/com/korit/sa_one_back/util/PageParam.java
==================================================

package com.korit.sa_one_back.util;

import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class PageParam {
    private int page;
    private int size;
    private int offset;
}


==================================================
FILE: src/main/java/com/korit/sa_one_back/util/PageUtil.java
==================================================

package com.korit.sa_one_back.util;

public class PageUtil {

    private PageUtil() {}

    public static PageParam resolve(Integer page, Integer size) {
        int p = (page == null || page < 1) ? 1 : page;
        int s = (size == null || size < 1) ? 20 : size;
        int offset = (p - 1) * s;

        return new PageParam(p, s, offset);
    }
}


==================================================
FILE: src/main/resources/application-secret.yml
==================================================

spring:
  config:
    activate:
      on-profile: secret
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://34.11.250.12:3306/post_project_db
    username: root
    password: 1q2w3e4r!
  security:
    oauth2:
      client:
        registration:
          naver:
            client-id: HXtdmFrYcIVf4L6ad7Vl
            client-secret: RLB6pE0go0
            redirect-uri: http://localhost:8080/login/oauth2/code/naver
            authorization-grant-type: authorization_code
            client-name: NAVER
        provider:
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
  mail:
    host: smtp.gmail.com
    port: 587
    username: dongwan03224@gmail.com
    password: jxzpgwqmswklzupt
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

jwt:
  secret: f01a781c5b05d34a908562b13436d0c9a8a9e77ff6827b99801ce6206489b6e5bdafa888e6a166c835bba7909914f1a74b895838e3b8a6c636ce258faff7cf51



==================================================
FILE: src/main/resources/application.yml
==================================================

spring:
  profiles:
    active: dev
    group:
      dev: dev, common, secret
      local: common, secret

---

spring:
  config:
    activate:
      on-profile: dev

---

spring:
  config:
    activate:
      on-profile: secret
    import:
      - classpath:application-secret-dev.yml
      - classpath:application-secret-prod.yml

---

spring:
  config:
    activate:
      on-profile: common
  servlet:
    multipart:
      max-file-size: 10MB    # 파일 하나당 크기
      max-request-size: 100MB    # 요청 전체 크기
  data:
    redis:
      host: localhost
      port: 6379

domain:
  name:
    http: http://localhost:80
    https: https://localhost:443

server:
  tomcat:
    max-swallow-size: -1  # 스프링 부트가 주는걸 다 기다리겠다

app:
  base-url: "http://localhost:8080"

springdoc:
  swagger-ui:
    path: doc

mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
  type-aliases-package: com.korit.sa_one_back.entity

==================================================
FILE: src/main/resources/githubyml.yml
==================================================

name: GCP-VM-CICD

on:
  push:
    branches: [deploy-dongwan, deploy-dabin, deploy-seohyun]
  pull_request:
    branches: [deploy-dongwan, deploy-dabin, deploy-seohyun]

jobs:
  build-deploy-dongwan:
    if: github.ref == 'refs/heads/deploy-dongwan'
    runs-on: ubuntu-22.04
    steps:
      - name: set-env
        run: |
          if [ ${{github.ref}} == 'refs/heads/deploy-dongwan' ]; then
          
            echo "GCP_VM_HOST=${{secrets.GCP_VM_HOST_DONGWAN}}" >> $GITHUB_ENV
            echo "GCP_VM_USERNAME=${{secrets.GCP_VM_USERNAME_DONGWAN}}" >> $GITHUB_ENV
            echo "GCP_VM_SSHKEY=${{secrets.GCP_VM_SSHKEY_DONGWAN}}" >> $GITHUB_ENV
            echo "DOCKER_USERNAME=${{secrets.DOCKER_USERNAME_DONGWAN}}" >> $GITHUB_ENV
            echo "DOCKER_PASSWORD=${{secrets.DOCKER_PASSWORD_DONGWAN}}" >> $GITHUB_ENV
            echo "APPLICATION_SECRET=${{secrets.APPLICATION_SECRET_DONGWAN}}" >> $GITHUB_ENV
            echo "REACT_ENV=${{secrets.REACT_ENV_DONGWAN}}" >> $GITHUB_ENV
          
          elif [ ${{github.ref}} == 'refs/heads/deploy-seohyun' ]; then

            echo "GCP_VM_HOST=${{secrets.GCP_VM_HOST_SEOHYUN}}" >> $GITHUB_ENV
            echo "GCP_VM_USERNAME=${{secrets.GCP_VM_USERNAME_SEOHYUN}}" >> $GITHUB_ENV
            echo "GCP_VM_SSHKEY=${{secrets.GCP_VM_SSHKEY_SEOHYUN}}" >> $GITHUB_ENV
            echo "DOCKER_USERNAME=${{secrets.DOCKER_USERNAME_SEOHYUN}}" >> $GITHUB_ENV
            echo "DOCKER_PASSWORD=${{secrets.DOCKER_PASSWORD_SEOHYUN}}" >> $GITHUB_ENV
            echo "APPLICATION_SECRET=${{secrets.APPLICATION_SECRET_SEOHYUN}}" >> $GITHUB_ENV
            echo "REACT_ENV=${{secrets.REACT_ENV_SEOHYUN}}" >> $GITHUB_ENV

          elif [ ${{github.ref}} == 'refs/heads/deploy-dabin' ]; then

            echo "GCP_VM_HOST=${{secrets.GCP_VM_HOST_DABIN}}" >> $GITHUB_ENV
            echo "GCP_VM_USERNAME=${{secrets.GCP_VM_USERNAME_DABIN}}" >> $GITHUB_ENV
            echo "GCP_VM_SSHKEY=${{secrets.GCP_VM_SSHKEY_DABIN}}" >> $GITHUB_ENV
            echo "DOCKER_USERNAME=${{secrets.DOCKER_USERNAME_DABIN}}" >> $GITHUB_ENV
            echo "DOCKER_PASSWORD=${{secrets.DOCKER_PASSWORD_DABIN}}" >> $GITHUB_ENV
            echo "APPLICATION_SECRET=${{secrets.APPLICATION_SECRET_DABIN}}" >> $GITHUB_ENV
            echo "REACT_ENV=${{secrets.REACT_ENV_DABIN}}" >> $GITHUB_ENV

          fi

      - name: Checkout
        uses: actions/checkout@v6.0.2
        with:
          ref: ${{github.ref}}

      - name: Install JDK 21
        uses: actions/setup-java@v5.2.0
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Springboot Build
        run: |
          cd sa_one_back
          echo ${{env.APPLICATION_SECRET}} | base64 --decode > ./src/main/resources/application-secret.yml
          chmod 777 ./mvnw
          ./mvnw clean package -Dtestskip

      - name: Springboot Docker image build
        run: |
          cd sa_one_back
          docker build -t ${{env.DOCKER_USERNAME}}/springboot-app:latest .

      - name: Springboot Docker image push
        run: |
          echo "${{env.DOCKER_PASSWORD}}" | docker login -u ${{env.DOCKER_USERNAME}} --password-stdin
          docker push ${{env.DOCKER_USERNAME}}/springboot-app:latest

      - name: React Docker image build
        run: |
          cd sa_one_front
          echo ${{env.REACT_ENV}} | base64 --decode > .env
          docker build -t ${{env.DOCKER_USERNAME}}/react-app:latest .

      - name: React Docker image push
        run: |
          docker push ${{env.DOCKER_USERNAME}}/react-app:latest

==================================================
FILE: src/main/resources/mapper/admin/admin_inquiry_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminInquiryMapper">

    <sql id="keywordFilter">
        <if test="keyword != null and keyword != ''">
            and (
            i.title like concat('%', #{keyword}, '%')
            or i.content like concat('%', #{keyword}, '%')
            )
        </if>
    </sql>

    <select id="count" resultType="int">
        select count
            (*)
        from
            inquiry_tb i
        where
            i.status = #{status}
        <include refid="keywordFilter"/>
    </select>

    <select id="findList" resultType="com.korit.sa_one_back.dto.response.admin.AdminInquiryListItemRespDto">
        select
            i.inquiry_id   as inquiryId,
            i.title        as title,
            i.status       as status,
            u.user_id      as userId,
            u.name         as userName,
            s.store_name   as storeName,
            i.created_at   as createdAt
        from
            inquiry_tb i
        join
            user_tb u
        on
            u.user_id = i.user_id
        left join
            store_tb s
        on
            s.store_id = i.store_id
        where
            i.status = #{status}
        <include refid="keywordFilter"/>
        order by i.created_at desc
        limit #{size} offset #{offset}
    </select>

    <select id="findDetail" resultType="com.korit.sa_one_back.dto.response.admin.AdminInquiryDetailRespDto">
        select
            i.inquiry_id   as inquiryId,
            i.title        as title,
            i.content      as content,
            i.status       as status,

            u.user_id      as userId,
            u.name         as userName,
            u.email        as userEmail,

            s.store_id     as storeId,
            s.store_name   as storeName,

            i.created_at   as createdAt,
            i.reviewed_at  as reviewedAt
        from
            inquiry_tb i
        join
            user_tb u
        on
            u.user_id = i.user_id
        left join
            store_tb s
        on
            s.store_id = i.store_id
        where
            i.inquiry_id = #{id}
    </select>

    <select id="findComments" resultType="InquiryCommentEntity">
        select
            c.comment_id  as commentId,
            c.inquiry_id  as inquiryId,
            c.user_id     as userId,
            c.content     as content,
            c.created_at  as createdAt,
            c.updated_at  as updatedAt
        from
            inquiry_comment_tb c
        where
            c.inquiry_id = #{inquiryId}
        order by c.created_at asc
    </select>

    <update id="updateStatus">
        update
            inquiry_tb
        set
            status = #{status},
            reviewed_at = if (#{status} in ('IN_PROGRESS', 'CLOSED'), now(), reviewed_at)
        where
            inquiry_id = #{id}
    </update>

    <insert id="insertComment">
        insert into inquiry_comment_tb (
            inquiry_id,
            user_id,
            content,
            created_at,
            updated_at
        ) values (
            #{inquiryId},
            #{userId},
            #{content},
            now(),
            now()
        )
    </insert>

</mapper>

==================================================
FILE: src/main/resources/mapper/admin/admin_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminDashboardMapper">

    <select id="countStoreApplicationsByStatus" resultType="java.lang.Integer">
        select count
            (*)
        from
            store_application_tb
        where
            status = 'PENDING'
    </select>
    <select id="countInquiryByStatus" resultType="java.lang.Integer">
        select count
            (*)
        from
            inquiry_tb
        where
            status = #{status}
    </select>
    <select id="existMinimumWage" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                minimum_wage_tb
            where
                year = #{year}
        )
    </select>
    <select id="existTaxRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                tax_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existInsuranceRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                insurance_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existNationalPensionRateLimit" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                national_pension_limit_tb
            where
                year = #{year}
        )
    </select>
    <select id="existHealthInsuranceRateLimit" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                health_insurance_limit_tb
            where
                year = #{year}
        )
    </select>
    <select id="existEmploymentCompanyRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                employment_company_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="existIndustrialAccidentRate" resultType="java.lang.Integer">
        select exists(
            select
                1
            from
                industrial_accident_rate_tb
            where
                year = #{year}
        )
    </select>
    <select id="countPendingInquiry" resultType="java.lang.Integer">
        select
            count(*)
        from
            inquiry_tb
        where
            status = 'OPEN'
    </select>
    <select id="countInProgressInquiry" resultType="java.lang.Integer">
        select
            count(*)
        from
            inquiry_tb
        where
            status = 'IN_PROGRESS'
    </select>
    <select id="selectInquiry" resultType="java.lang.Integer">
        select
            *
        from
            inquiry_tb
        where
            inquiry_id = #{inquiry_id}
    </select>
    <update id="updateInquiryStatus">
        update
            inquiry_tb
        set
            status = 'IN_PROGRESS',
            reviewed_at = now()
        where
            inquiry_id = #{inquiryId}
            and status = 'OPEN'
    </update>
</mapper>

==================================================
FILE: src/main/resources/mapper/admin/admin_policy_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminPolicyMapper">

</mapper>

==================================================
FILE: src/main/resources/mapper/admin/admin_policy_master_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminPolicyMasterMapper">

    <select id="findTaxRate" parameterType="int" resultType="TaxRateEntity">
        select
            year,
            income_tax_rate as incomeTaxRate,
            local_tax_rate  as localTaxRate
        from
            tax_rate_tb
        where
            year = #{year}
    </select>

    <select id="findMinimumWage" parameterType="int" resultType="MinimumWageEntity">
        select
            minimum_wage_id as minimumWageId,
            year,
            hourly_wage as hourlyWage,
            effective_from as effectiveFrom,
            created_at as createdAt,
            updated_at as updatedAt
        from
            minimum_wage_tb
        where
            year = #{year}
    </select>

    <select id="findNationalPensionLimit" parameterType="int" resultType="NationalPensionLimitEntity">
        select
            national_pension_limit_id as nationalPensionLimitId,
            year,
            lower_limit as lowerLimit,
            upper_limit as upperLimit
        from
            national_pension_limit_tb
        where
            year = #{year}
    </select>

    <select id="findHealthInsuranceLimit" parameterType="int" resultType="HealthInsuranceLimitEntity">
        select
            health_insurance_limit_id as healthInsuranceLimitId,
            year,
            lower_limit as lowerLimit,
            upper_limit as upperLimit
        from
            health_insurance_limit_tb
        where
            year = #{year}
    </select>

    <select id="findInsuranceRates" parameterType="int" resultType="InsuranceRateEntity">
        select
            insurance_rate_id as insuranceRateId,
            insurance_id as insuranceId,
            year,
            employee_rate as employeeRate,
            employer_rate as employerRate,
            total_rate as totalRate,
            note
        from
            insurance_rate_tb
        where
            year = #{year}
        order by insurance_id asc
    </select>

    <select id="findEmploymentCompanyRates" parameterType="int" resultType="EmploymentCompanyRateEntity">
        select
            company_rate_id as companyRateId,
            year,
            company_type as companyType,
            employer_rate as employerRate
        from
            employment_company_rate_tb
        where
            year = #{year}
        order by company_type asc
    </select>

    <select id="findIndustrialAccidentRates" parameterType="int" resultType="IndustrialAccidentRateEntity">
        select
            industrial_rate_id as industrialRateId,
            industry_code as industryCode,
            year,
            employer_rate as employerRate
        from
            industrial_accident_rate_tb
        where
            year = #{year}
        order by industry_code asc
    </select>

    <insert id="upsertTaxRate">
        insert into tax_rate_tb (
            year,
            income_tax_rate,
            local_tax_rate
        ) values (
            #{year},
            #{incomeTaxRate},
            #{localTaxRate}
        )
        on duplicate key update
            income_tax_rate = values(income_tax_rate),
            local_tax_rate = values(local_tax_rate)
    </insert>

    <insert id="upsertMinimumWage">
        insert into minimum_wage_tb (
            year,
            hourly_wage,
            effective_from
        ) values (
            #{year},
            #{hourlyWage},
            #{effectiveFrom}
        )
        on duplicate key update
            hourly_wage = values(hourly_wage),
            effective_from = values(effective_from),
            updated_at = now()
    </insert>

    <insert id="upsertNationalPensionLimit">
        insert into national_pension_limit_tb (
            year,
            lower_limit,
            upper_limit
        ) values (
            #{year},
            #{lowerLimit},
            #{upperLimit}
        )
        on duplicate key update
            lower_limit = values(lower_limit),
            upper_limit = values(upper_limit)
    </insert>

    <insert id="upsertHealthInsuranceLimit">
        insert into health_insurance_limit_tb (
            year,
            lower_limit,
            upper_limit
        ) values (
            #{year},
            #{lowerLimit},
            #{upperLimit}
        )
        on duplicate key update
            lower_limit = values(lower_limit),
            upper_limit = values(upper_limit)
    </insert>

    <insert id="upsertInsuranceRates">
        insert into insurance_rate_tb (
            insurance_id,
            year,
            employee_rate,
            employer_rate,
            total_rate, note
        )
        values
        <foreach collection="list" item="r" separator=",">
            (
                #{r.insuranceId},
                #{r.year},
                #{r.employeeRate},
                #{r.employerRate},
                #{r.totalRate},
                #{r.note}
            )
        </foreach>
        on duplicate key update
            employee_rate = values(employee_rate),
            employer_rate = values(employer_rate),
            total_rate = values(total_rate),
            note = values(note)
    </insert>

    <insert id="upsertEmploymentCompanyRates">
        insert into employment_company_rate_tb (
            year,
            company_type,
            employer_rate
        )
        values
        <foreach collection="list" item="r" separator=",">
            (
                #{r.year},
                #{r.companyType},
                #{r.employerRate}
            )
        </foreach>
        on duplicate key update
            employer_rate = values(employer_rate)
    </insert>

    <insert id="upsertIndustrialAccidentRates">
        insert into industrial_accident_rate_tb (
            industry_code,
            year,
            employer_rate
        )
        values
        <foreach collection="list" item="r" separator=",">
            (
                #{r.industryCode},
                #{r.year},
                #{r.employerRate}
            )
        </foreach>
        on duplicate key update
            employer_rate = values(employer_rate)
    </insert>

</mapper>

==================================================
FILE: src/main/resources/mapper/admin/admin_store.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminStoreMapper">

    <sql id="storeKeywordFilter">
        <if test="keyword != null and keyword != ''">
            and (
                s.store_name like concat('%', #{keyword}, '%')
                or s.business_number like concat('%', #{keyword}, '%')
                or s.owner_name like concat('%', #{keyword}, '%')
            )
        </if>
    </sql>

    <select id="countStores" resultType="int">
        select count
            (*)
        from
            store_tb s
        where
            1=1
        <include refid="storeKeywordFilter"/>
    </select>

    <select id="findStores" resultType="com.korit.sa_one_back.dto.response.admin.AdminStoreListItemRespDto">
        select
            s.store_id        as storeId,
            s.store_name      as storeName,
            s.address         as address,
            s.business_number as businessNumber,
            s.owner_name      as ownerName,
            s.store_phone     as storePhone,

            bi.company_type   as companyType,
            bi.industry_code  as industryCode,

            i.industry_name   as industryName,

            s.created_at      as createdAt
        from
            store_tb s
        left join
            store_business_info_tb bi
        on
            bi.store_id = s.store_id
        left join
            industry_tb i
        on
            i.industry_code = bi.industry_code

        where 1=1
        <include refid="storeKeywordFilter"/>

        order by s.created_at desc
        limit #{size} offset #{offset}
    </select>

    <select id="findStoreDetail" resultType="com.korit.sa_one_back.dto.response.admin.AdminStoreDetailRespDto">
        select
            s.store_id        as storeId,
            s.store_name      as storeName,
            s.address         as address,
            s.business_number as businessNumber,
            s.owner_name      as ownerName,
            s.store_phone     as storePhone,
            s.user_id         as userId,

            bi.company_type   as companyType,
            bi.industry_code  as industryCode,
            i.industry_name   as industryName,

            s.created_at      as createdAt,
            s.updated_at      as updatedAt
        from
            store_tb s
        left join
            store_business_info_tb bi
        on
            bi.store_id = s.store_id
        left
            join industry_tb i
        on
            i.industry_code = bi.industry_code
        where
            s.store_id = #{storeId}
    </select>

</mapper>

==================================================
FILE: src/main/resources/mapper/admin/admin_store_application.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.admin.AdminStoreApplicationMapper">

    <select id="countByStatus" resultType="int">
        select count
            (*)
        from
            store_application_tb
        where
            status = #{status}
    </select>

    <select id="findByStatus" resultType="StoreApplicationEntity">
        select
            store_application_id,
            store_name,
            address,
            business_number,
            owner_name,
            store_phone,
            status,
            reject_reason,
            reviewed_at,
            created_at,
            user_id
        from
            store_application_tb
        where
            status = #{status}
        order by created_at desc
        limit #{size} offset #{offset}
    </select>

    <select id="findById" resultType="StoreApplicationEntity">
        select
            store_application_id,
            store_name,
            address,
            business_number,
            owner_name,
            store_phone,
            status,
            reject_reason,
            reviewed_at,
            created_at,
            user_id
        from
            store_application_tb
        where
            store_application_id = #{id}
    </select>

    <update id="updateApproved">
        update
            store_application_tb
        set
            status = 'APPROVED',
            reviewed_at = now()
        where
            store_application_id = #{id}
    </update>

    <update id="updateRejected">
        update
            store_application_tb
        set
            status = 'REJECTED',
            reject_reason = #{reason},
            reviewed_at = now()
        where
            store_application_id = #{id}
    </update>

    <insert id="insertStore" parameterType="StoreEntity"
            useGeneratedKeys="true" keyProperty="storeId">
        insert into store_tb (
            store_name,
            address,
            business_number,
            owner_name,
            store_phone,
            user_id
        ) values (
            #{storeName},
            #{address},
            #{businessNumber},
            #{ownerName},
            #{storePhone},
            #{userId}
        )
    </insert>

    <insert id="insertStoreBusinessInfo">
        insert into store_business_info_tb (
            store_id,
            company_type,
            industry_code
        ) values (
            #{storeId},
            null,
            null
        )
    </insert>

</mapper>

==================================================
FILE: src/main/resources/mapper/attendance_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.AttendanceMapper">

    <select id="findStoreEmployeeId" resultType="java.lang.Long">
        select
            store_employee_id
        from
            store_employee_tb
        where
            user_id = #{userId}
        and
            store_id = #{storeId}
        and
            work_status IN ('ACTIVE', 'WORKING')

    </select>

    <select id="countTodayAttendance" resultType="int">
        select
            count(*)
        from
            attendance_tb
        where
            store_employee_id = #{storeEmployeeId}
        and
            work_date = #{workDate}
    </select>

    <insert id="insertCheckIn" useGeneratedKeys="true" keyProperty="attendanceId">
        insert into attendance_tb (
            attendance_id,
            store_employee_id,
            work_date,
            check_in_time,
            check_in_img_url,
            attendance_status,
            created_at,
            updated_at
        ) values (
            default,
            #{storeEmployeeId},
            #{workDate},
            #{checkInTime},
            #{checkInImgUrl},
            #{attendanceStatus},
            now(),
            now()
        )
    </insert>

    <select id="findTodayAttendanceForCheckOut"
            resultType="com.korit.sa_one_back.entity.AttendanceEntity">
        select
            *
        from
            attendance_tb
        where
            store_employee_id = #{storeEmployeeId}
        and
            work_date = #{workDate}
        order by check_out_time is not null, attendance_id desc
        limit 1
    </select>

    <update id="updateCheckOut">
        update
            attendance_tb
        set
            check_out_time = #{checkOutTime},
            check_out_img_url = #{checkOutImgUrl},
            work_minutes = #{workMinutes},
            attendance_status = #{attendanceStatus},
            updated_at = now()
        where
            attendance_id = #{attendanceId}
    </update>

    <select id="findMyAttendances"
            resultType="com.korit.sa_one_back.dto.response.MyAttendanceRespDto">
        select
            a.attendance_id attendanceId,
            se.store_id workplaceId,
            s.store_name workplaceName,
            a.work_date date,
            a.check_in_time checkInTime,
            a.check_out_time checkOutTime,
            a.work_minutes workedMinutes,
            a.attendance_status status
        from
            attendance_tb a
        join store_employee_tb se on se.store_employee_id = a.store_employee_id
        join store_tb s on s.store_id = se.store_id
        where a.store_employee_id = #{storeEmployeeId}
        order by a.work_date desc, a.attendance_id desc
    </select>

    <!--  사장 출근현황 리스트 -->
<!--    <select id="findOwnerAttendanceItems"-->
<!--            resultType="com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto">-->
<!--        select-->
<!--            a.attendance_id attendanceId,-->
<!--            se.store_employee_id employeeId,-->
<!--            u.name employeeName,-->
<!--            #{workDate} date,-->
<!--            a.check_in_time checkInTime,-->
<!--            a.check_out_time checkOutTime,-->
<!--            a.work_minutes workedMinutes,-->
<!--            a.attendance_status status,-->
<!--            lt.leave_type_name absentReason-->
<!--        from-->
<!--            store_employee_tb se-->
<!--        join user_tb u on u.user_id = se.user_id-->
<!--        left join attendance_tb a-->
<!--        on a.store_employee_id = se.store_employee_id-->
<!--        and a.work_date = #{workDate}-->
<!--        left join leave_tb l-->
<!--        on l.store_employee_id = se.store_employee_id-->
<!--        and #{workDate} between l.start_date and l.end_date-->
<!--        and l.work_status = 'APPROVED'-->
<!--        left join leave_type_tb lt on lt.leave_type_id = l.leave_type_id-->
<!--        where se.store_id = #{storeId}-->
<!--        and se.work_status IN ('ACTIVE', 'WORKING')-->

<!--        order by se.store_employee_id desc-->
<!--    </select>-->

    <select id="findOwnerAttendanceItems"
            resultType="com.korit.sa_one_back.dto.response.OwnerAttendanceRespDto">
        select
            s.store_id storeId,
            s.store_name storeName,

            a.attendance_id attendanceId,
            se.store_employee_id employeeId,
            u.name employeeName,
            #{workDate} date,
            a.check_in_time checkInTime,
            a.check_out_time checkOutTime,
            a.work_minutes workedMinutes,
            a.attendance_status status,
            lt.leave_type_name absentReason
        from
        store_employee_tb se
        join store_tb s
        on s.store_id = se.store_id
        join user_tb u
        on u.user_id = se.user_id
        left join attendance_tb a
        on a.store_employee_id = se.store_employee_id
        and a.work_date = #{workDate}
        left join leave_tb l
        on l.store_employee_id = se.store_employee_id
        and #{workDate} between l.start_date and l.end_date
        and l.work_status = 'APPROVED'
        left join leave_type_tb lt
        on lt.leave_type_id = l.leave_type_id
        where
        se.store_id = #{storeId}
        and se.work_status in ('ACTIVE','WORKING')
        order by se.store_employee_id desc
    </select>


    <!-- 운영 시작 시간 -->
    <select id="findOpenTime" resultType="java.time.LocalDateTime">
        select
            min(a.check_in_time)
        from
            attendance_tb a
        join store_employee_tb se on se.store_employee_id = a.store_employee_id
        where se.store_id = #{storeId}
        and a.work_date = #{workDate}
    </select>

    <!-- 운영 종료 시간 -->
    <select id="findCloseTime" resultType="java.time.LocalDateTime">
        select
            max(a.check_out_time)
        from
            attendance_tb a
        join store_employee_tb se on se.store_employee_id = a.store_employee_id
        where se.store_id = #{storeId}
        and a.work_date = #{workDate}
    </select>

    <!-- 매장 카드 -->
    <select id="findStoreCard"
            resultType="com.korit.sa_one_back.dto.response.StoreRespDto">
        select
            store_name storeName,
            address storeAddress,
            store_phone storeIntro,
            null storeHoliday
        from
            store_tb
        where
            store_id = #{storeId}
    </select>

    <select id="countOwnerStore" resultType="int">
        select
        count(*)
        from
        store_tb
        where
        store_id = #{storeId}
        and user_id = #{userId}

    </select>


    <select id="findStoreEmployeeIdByNoAndName" resultType="java.lang.Long">
        select
        se.store_employee_id
        from
        store_employee_tb se
        join user_tb u on u.user_id = se.user_id
        where
        se.store_id = #{storeId}
        and
        se.employee_no = #{employeeNo}
        and
        u.name = #{storeEmployeeName}
        and
        se.work_status IN ('ACTIVE', 'WORKING')

        limit 1
    </select>

    <select id="countActiveEmployee" resultType="int">
        select
        count(*)
        from
        store_employee_tb
        where
        store_id = #{storeId}
        and
        user_id = #{userId}
        and
<!--        work_status = 'ACTIVE'-->
        work_status IN ('ACTIVE', 'WORKING')

    </select>

    <select id="findEmployeeName" resultType="java.lang.String">
        select
        u.name
        from
        store_employee_tb se
        join user_tb u on u.user_id = se.user_id
        where
        se.store_employee_id = #{storeEmployeeId}
    </select>
</mapper>


==================================================
FILE: src/main/resources/mapper/employee_inquiry_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.inquiry.EmployeeInquiryMapper">

    <sql id="keywordFilter">
        <if test="keyword != null and keyword != ''">
            and (
            i.title like concat('%', #{keyword}, '%')
            or i.content like concat('%', #{keyword}, '%')
            )
        </if>
    </sql>

    <select id="existsEmployeeInStore" resultType="boolean">
        select exists(
            select 1
        from store_employee_tb se
        where se.user_id = #{userId}
        and se.store_id = #{storeId}
        )
    </select>

    <select id="existsMyInquiry" resultType="boolean">
        select exists(
            select 1
        from inquiry_tb i
        where i.inquiry_id = #{inquiryId}
        and i.user_id = #{userId}
        )
    </select>

    <select id="countMyInquiries" resultType="int">
        select count(*)
        from inquiry_tb i
        where i.user_id = #{userId}
        and i.status = #{status}
        <include refid="keywordFilter"/>
    </select>

    <select id="findMyInquiryList"
            resultType="com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryListItemRespDto">
        select
            i.inquiry_id as inquiryId,
            i.title as title,
            i.content as content,
            i.status as status,
            s.store_name as storeName,
            DATE_FORMAT(i.created_at, '%Y-%m-%d %H:%i:%s') as createdAt
        from inquiry_tb i
        left join store_tb s on s.store_id = i.store_id
        where i.user_id = #{userId}
        and i.status = #{status}
        <include refid="keywordFilter"/>
        order by i.created_at desc
        limit #{size} offset #{offset}
    </select>

    <select id="findDetail"
            resultType="com.korit.sa_one_back.dto.response.inquiry.EmployeeInquiryDetailRespDto">
        select
            i.inquiry_id as inquiryId,
            i.title as title,
            i.content as content,
            i.status as status,

            u.user_id as userId,
            u.name as userName,
            u.email as userEmail,

            s.store_id as storeId,
            s.store_name as storeName,

            DATE_FORMAT(i.created_at, '%Y-%m-%d %H:%i:%s')  as createdAt,
            DATE_FORMAT(i.reviewed_at, '%Y-%m-%d %H:%i:%s') as reviewedAt
        from inquiry_tb i
        join user_tb u on u.user_id = i.user_id
        left join store_tb s on s.store_id = i.store_id
        where i.inquiry_id = #{inquiryId}
    </select>

    <select id="findComments" resultType="InquiryCommentEntity">
        select
            c.comment_id as commentId,
            c.inquiry_id as inquiryId,
            c.user_id as userId,
            c.content as content,
            c.created_at as createdAt,
            c.updated_at as updatedAt
        from inquiry_comment_tb c
        where c.inquiry_id = #{inquiryId}
        order by c.created_at asc
    </select>

    <insert id="insertInquiry">
        insert into inquiry_tb (
        inquiry_id, user_id, store_id, title, content, status, reviewed_at, created_at, updated_at
        ) values (
        default, #{userId}, #{storeId}, #{title}, #{content}, 'OPEN', null, now(), now()
        )
    </insert>

    <insert id="insertComment">
        insert into inquiry_comment_tb (
        comment_id, inquiry_id, user_id, content, created_at, updated_at
        ) values (
        default, #{inquiryId}, #{userId}, #{content}, now(), now()
        )
    </insert>

</mapper>


==================================================
FILE: src/main/resources/mapper/employee_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.EmployeeMapper">

    <!-- storeId + userId가 ACTIVE 상태로 이미 등록돼있는지 체크 -->
    <select id="existsActiveEmployee" resultType="boolean">
        select exists(
            select 1
        from store_employee_tb
        where store_id = #{storeId}
        and user_id = #{userId}
        and work_status = 'ACTIVE'
        )
    </select>

    <!-- 직원 소속(store_employee) 추가 -->
    <insert id="insertStoreEmployee" useGeneratedKeys="true" keyProperty="storeEmployeeId">
        insert into store_employee_tb (
            store_employee_id,
            store_id,
            user_id,
            employee_no,

            position_id,
            join_date,
            work_status,
            updated_at
        ) values (
            default,
            #{storeId},
            #{userId},
            #{employeeNo},

            #{positionId},
            #{joinDate},
            #{workStatus},
            now()
        )
    </insert>

    <!--  직원 목록 조회 -->

    <select id="selectEmployees" resultType="com.korit.sa_one_back.dto.response.EmployeeListRespDto">
        <![CDATA[
        select
            se.store_employee_id,
            se.store_id,
            se.user_id,
            se.employee_no,
            se.position_id,
            se.join_date,
            se.work_status,

            u.name,
            u.email,
            u.phone,
            u.img_url,
            u.img_path,
            u.birth_date,

            p.position_name,

            pay.pay_type,
            pay.hourly_rate,
            pay.monthly_salary,
            pay.start_date,
            pay.end_date
        from store_employee_tb se
        join user_tb u on u.user_id = se.user_id
        left join position_tb p on p.position_id = se.position_id
        left join pay_tb pay
            on pay.store_employee_id = se.store_employee_id
           and pay.start_date <= #{today}
           and (pay.end_date is null or pay.end_date >= #{today})
        where se.store_id = #{storeId}
          and se.work_status = 'ACTIVE'
        order by se.store_employee_id desc
        ]]>
    </select>

    <!-- 요청 ids가 해당 store 소속인지 검증 -->
    <select id="countBelonging" resultType="int">
        select count(*)
        from store_employee_tb
        where store_id = #{storeId}
        and store_employee_id in
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <!-- 퇴사 처리: work_status 변경 -->
    <update id="updateWorkStatus">
        update store_employee_tb
        set
        work_status = #{workStatus},
        updated_at = now()
        where store_employee_id = #{storeEmployeeId}
    </update>

</mapper>


==================================================
FILE: src/main/resources/mapper/mypage_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.MyPageMapper">

    <!-- =========================================================
         [직원] 마이페이지 조회
         - 고용형태: pay_tb.pay_type
         ========================================================= -->
    <select id="findEmployeeInfoByUserId"
            resultType="com.korit.sa_one_back.dto.response.UserMeRespDto$EmployeeInfo">

        select
            se.store_employee_id,
            st.store_name,
            se.employee_no,
            se.join_date,
            se.work_status,
            p.pay_type,
            p.hourly_rate,
            p.monthly_salary
        from store_employee_tb se
        join store_tb st
            on st.store_id = se.store_id
        left join pay_tb p
            on p.store_employee_id = se.store_employee_id
        where se.user_id = #{userId}
        order by p.start_date desc
        limit 1

    </select>

    <!-- =========================================================
         [사장/매니저] 내 사업장 목록
         ========================================================= -->
    <select id="findMyStoreList"
            resultType="com.korit.sa_one_back.dto.response.UserMeRespDto$StoreInfo">

        select distinct
            st.store_id,
            st.store_name
        from store_employee_tb se
        join store_tb st on st.store_id = se.store_id
        where se.user_id = #{userId}
        order by st.store_id asc

    </select>

    <!-- 첫 번째 사업장 id -->
    <select id="findFirstStoreId" resultType="long">

        select
            st.store_id
        from store_employee_tb se
        join store_tb st on st.store_id = se.store_id
        where se.user_id = #{userId}
        order by st.store_id asc
        limit 1

    </select>

    <!-- =========================================================
         [사장/매니저] 선택된 사업장 상세
         ========================================================= -->
    <select id="findMyStoreDetail"
            resultType="com.korit.sa_one_back.dto.response.UserMeRespDto$StoreInfo">

        select
            st.store_id,
            st.store_name,
            st.business_number,
            st.store_phone,
            st.address,

            sbi.company_type,
            sbi.industry_code,

            it.industry_name

        from store_tb st
        join store_employee_tb se on se.store_id = st.store_id

        left join store_business_info_tb sbi on sbi.store_id = st.store_id
        left join industry_tb it on it.industry_code = sbi.industry_code

        where se.user_id = #{userId}
            and st.store_id = #{storeId}
        limit 1

    </select>

</mapper>


==================================================
FILE: src/main/resources/mapper/my_calendar_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.MyCalendarMapper">

    <resultMap id="CalendarRowMap" type="com.korit.sa_one_back.dto.response.CalendarRowRespDto">
        <result property="storeId" column="store_id"/>
        <result property="storeName" column="store_name"/>

        <result property="storeEmployeeId" column="store_employee_id"/>
        <result property="userId" column="user_id"/>
        <result property="name" column="name"/>

        <result property="scheduleId" column="schedule_id"/>
        <result property="workDate" column="work_date"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="breakMinutes" column="break_minutes"/>
        <result property="scheduleNote" column="schedule_note"/>

        <result property="attendanceId" column="attendance_id"/>
        <result property="checkInTime" column="check_in_time"/>
        <result property="checkOutTime" column="check_out_time"/>
        <result property="workMinutes" column="work_minutes"/>
        <result property="attendanceStatus" column="attendance_status"/>

        <result property="leaveId" column="leave_id"/>
        <result property="leaveTypeName" column="leave_type_name"/>
    </resultMap>

    <select id="countMyStoreEmployee" resultType="int">
        select count(*)
        from store_employee_tb
        where store_id = #{storeId}
        and user_id = #{userId}
        and work_status = 'WORKING'
    </select>

    <select id="findMyMonthRows" resultMap="CalendarRowMap">
        select
            s.store_id,
            s.store_name,

            se.store_employee_id,
            u.user_id,
            u.name,

            sc.schedule_id,
            sc.work_date,
            sc.start_time,
            sc.end_time,
            sc.break_minutes,
            sc.note as schedule_note,

            a.attendance_id,
            a.check_in_time,
            a.check_out_time,
            a.work_minutes,
            a.attendance_status,

            l.leave_id,
            lt.leave_type_name
        from store_tb s
        join store_employee_tb se
        on se.store_id = s.store_id
        join user_tb u
        on u.user_id = se.user_id
        left join schedule_tb sc
        on sc.store_employee_id = se.store_employee_id
        and sc.work_date between #{start} and #{end}
        left join attendance_tb a
        on a.store_employee_id = se.store_employee_id
        and a.work_date = sc.work_date
        left join leave_tb l
        on l.store_employee_id = se.store_employee_id
        and sc.work_date between l.start_date and l.end_date
        left join leave_type_tb lt
        on lt.leave_type_id = l.leave_type_id
        where
        s.store_id = #{storeId}
        and u.user_id = #{userId}
        order by
        sc.work_date asc
    </select>

</mapper>


==================================================
FILE: src/main/resources/mapper/owner_attendance_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.OwnerAttendanceMapper">

    <resultMap id="CalendarRowMap" type="com.korit.sa_one_back.dto.response.CalendarRowRespDto">
        <result property="storeId" column="store_id"/>
        <result property="storeName" column="store_name"/>

        <result property="storeEmployeeId" column="store_employee_id"/>
        <result property="userId" column="user_id"/>
        <result property="name" column="name"/>

        <result property="workDate" column="work_date"/>

        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>

        <result property="attendanceId" column="attendance_id"/>
        <result property="checkInTime" column="check_in_time"/>
        <result property="checkOutTime" column="check_out_time"/>
        <result property="attendanceStatus" column="attendance_status"/>

        <result property="leaveId" column="leave_id"/>
        <result property="leaveTypeName" column="leave_type_name"/>
    </resultMap>

    <select id="findOwnerDayAttendanceRows" resultMap="CalendarRowMap">
        select
            s.store_id,
            s.store_name,

            se.store_employee_id,
            u.user_id,
            u.name,

            #{workDate} as work_date,

            sc.start_time,
            sc.end_time,

            a.attendance_id,
            a.check_in_time,
            a.check_out_time,
            a.attendance_status,

            l.leave_id,
            lt.leave_type_name
        from store_tb s
        join store_employee_tb se
        on se.store_id = s.store_id
        join user_tb u
        on u.user_id = se.user_id
        left join schedule_tb sc
        on sc.store_employee_id = se.store_employee_id
        and sc.work_date = #{workDate}
        left join attendance_tb a
        on a.store_employee_id = se.store_employee_id
        and a.work_date = #{workDate}
        left join leave_tb l
        on l.store_employee_id = se.store_employee_id
        and #{workDate} between l.start_date and l.end_date
        left join leave_type_tb lt
        on lt.leave_type_id = l.leave_type_id
        where
        s.store_id = #{storeId}
        and se.work_status in ('WORKING', 'ACTIVE')
        order by
        u.name asc
    </select>

</mapper>


==================================================
FILE: src/main/resources/mapper/owner_calendar_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.OwnerCalendarMapper">

    <resultMap id="CalendarRowMap" type="com.korit.sa_one_back.dto.response.CalendarRowRespDto">
        <result property="storeId" column="store_id"/>
        <result property="storeName" column="store_name"/>

        <result property="storeEmployeeId" column="store_employee_id"/>
        <result property="userId" column="user_id"/>
        <result property="name" column="name"/>

        <result property="scheduleId" column="schedule_id"/>
        <result property="workDate" column="work_date"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="breakMinutes" column="break_minutes"/>
        <result property="scheduleNote" column="schedule_note"/>

        <result property="attendanceId" column="attendance_id"/>
        <result property="checkInTime" column="check_in_time"/>
        <result property="checkOutTime" column="check_out_time"/>
        <result property="workMinutes" column="work_minutes"/>
        <result property="attendanceStatus" column="attendance_status"/>
        <result property="attendanceNote" column="attendance_note"/>

        <result property="leaveId" column="leave_id"/>
        <result property="leaveType" column="leave_type"/>
        <result property="leaveTypeName" column="leave_type_name"/>
    </resultMap>

    <!-- 사장 월 캘린더(전체) -->
    <select id="findOwnerMonthRows" resultMap="CalendarRowMap">
        select
            s.store_id,
            s.store_name,

            se.store_employee_id,
            u.user_id,
            u.name,

            sc.schedule_id,
            sc.work_date,
            sc.start_time,
            sc.end_time,
            sc.break_minutes,
            sc.note as schedule_note,

            a.attendance_id,
            a.check_in_time,
            a.check_out_time,
            a.work_minutes,
            a.attendance_status,

            l.leave_id,
            lt.leave_type_name as leave_type,
            lt.leave_type_name
        from store_tb s
        join store_employee_tb se
        on se.store_id = s.store_id
        join user_tb u
        on u.user_id = se.user_id
        left join schedule_tb sc
        on sc.store_employee_id = se.store_employee_id
        and sc.work_date between #{start} and #{end}
        left join attendance_tb a
        on a.store_employee_id = se.store_employee_id
        and a.work_date = sc.work_date
        left join leave_tb l
        on l.store_employee_id = se.store_employee_id
        and sc.work_date between l.start_date and l.end_date
        left join leave_type_tb lt
        on lt.leave_type_id = l.leave_type_id
        where
        s.store_id = #{storeId}
        and se.work_status in ('WORKING', 'ACTIVE')

        order by
        sc.work_date asc, u.name asc
    </select>

    <!-- 사장 -> 특정 직원 개인 월 캘린더 -->
    <select id="findOwnerEmployeeMonthRows" resultMap="CalendarRowMap">
        select
            s.store_id,
            s.store_name,

            se.store_employee_id,
            u.user_id,
            u.name,

            sc.schedule_id,
            sc.work_date,
            sc.start_time,
            sc.end_time,
            sc.break_minutes,
            sc.note as schedule_note,

            a.attendance_id,
            a.check_in_time,
            a.check_out_time,
            a.work_minutes,
            a.attendance_status,

            l.leave_id,
            lt.leave_type_name as leave_type,
            lt.leave_type_name
        from store_tb s
        join store_employee_tb se
        on se.store_id = s.store_id
        join user_tb u
        on u.user_id = se.user_id
        left join schedule_tb sc
        on sc.store_employee_id = se.store_employee_id
        and sc.work_date between #{start} and #{end}
        left join attendance_tb a
        on a.store_employee_id = se.store_employee_id
        and a.work_date = sc.work_date
        left join leave_tb l
        on l.store_employee_id = se.store_employee_id
        and sc.work_date between l.start_date and l.end_date
        left join leave_type_tb lt
        on lt.leave_type_id = l.leave_type_id
        where
        s.store_id = #{storeId}
        and se.store_employee_id = #{storeEmployeeId}
        order by
        sc.work_date asc
    </select>

</mapper>


==================================================
FILE: src/main/resources/mapper/owner_inquiry_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.inquiry.OwnerInquiryMapper">

    <sql id="keywordFilter">
        <if test="keyword != null and keyword != ''">
            and (
            i.title like concat('%', #{keyword}, '%')
            or i.content like concat('%', #{keyword}, '%')
            )
        </if>
    </sql>

    <select id="existsOwnerStore" resultType="boolean">
        select exists(
        select 1
        from store_tb s
        where s.store_id = #{storeId}
        and s.user_id = #{ownerUserId}
        )
    </select>

    <select id="existsMyInquiry" resultType="boolean">
        select exists(
        select 1
        from inquiry_tb i
        where i.inquiry_id = #{inquiryId}
        and i.user_id = #{userId}
        )
    </select>

    <select id="countMyInquiries" resultType="int">
        select count(*)
        from inquiry_tb i
        where i.user_id = #{userId}
        and i.status = #{status}
        <include refid="keywordFilter"/>
    </select>

    <select id="findMyInquiryList"
            resultType="com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryListItemRespDto">
        select
            i.inquiry_id as inquiryId,
            i.title as title,
            i.content as content,
            i.status as status,
            s.store_name as storeName,
            DATE_FORMAT(i.created_at, '%Y-%m-%d %H:%i:%s') as createdAt
        from inquiry_tb i
        left join store_tb s on s.store_id = i.store_id
        where i.user_id = #{userId}
        and i.status = #{status}
        <include refid="keywordFilter"/>
        order by i.created_at desc
        limit #{size} offset #{offset}
    </select>

    <select id="findDetail"
            resultType="com.korit.sa_one_back.dto.response.inquiry.OwnerInquiryDetailRespDto">
        select
        i.inquiry_id as inquiryId,
        i.title as title,
        i.content as content,
        i.status as status,

        u.user_id as userId,
        u.name as userName,
        u.email as userEmail,

        s.store_id as storeId,
        s.store_name as storeName,

        DATE_FORMAT(i.created_at, '%Y-%m-%d %H:%i:%s')  as createdAt,
        DATE_FORMAT(i.reviewed_at, '%Y-%m-%d %H:%i:%s') as reviewedAt
        from inquiry_tb i
        join user_tb u on u.user_id = i.user_id
        left join store_tb s on s.store_id = i.store_id
        where i.inquiry_id = #{inquiryId}
    </select>

    <select id="findComments" resultType="InquiryCommentEntity">
        select
        c.comment_id as commentId,
        c.inquiry_id as inquiryId,
        c.user_id as userId,
        c.content as content,
        c.created_at as createdAt,
        c.updated_at as updatedAt
        from inquiry_comment_tb c
        where c.inquiry_id = #{inquiryId}
        order by c.created_at asc
    </select>

    <insert id="insertInquiry">
        insert into inquiry_tb (
        inquiry_id, user_id, store_id, title, content, status, reviewed_at, created_at, updated_at
        ) values (
        default, #{userId}, #{storeId}, #{title}, #{content}, 'OPEN', null, now(), now()
        )
    </insert>

    <insert id="insertComment">
        insert into inquiry_comment_tb (
        comment_id, inquiry_id, user_id, content, created_at, updated_at
        ) values (
        default, #{inquiryId}, #{userId}, #{content}, now(), now()
        )
    </insert>

</mapper>


==================================================
FILE: src/main/resources/mapper/payroll_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.PayrollMapper">

    <select id="findMonthlySummary" resultType="com.korit.sa_one_back.entity.payroll.MonthlyAttendanceSummaryEntity">
        select
            summary_id as summaryId,
            store_employee_id as storeEmployeeId,
            payslip_year_month as payslipYearMonth,
            work_days as workDays,
            total_work_minutes as totalWorkMinutes,
            total_overtime_minutes as totalOvertimeMinutes,
            total_night_minutes as totalNightMinutes,
            late_count as lateCount,
            early_leave_count as earlyLeaveCount,
            absent_count as absentCount,
            leave_days as leaveDays,
            created_at as createdAt
        from
            monthly_attendance_summary_tb
        where
            store_employee_id = #{storeEmployeeId}
            and
                payslip_year_month = #{payslipYearMonth}
        limit 1
    </select>

    <select id="findEffectivePay" resultType="com.korit.sa_one_back.entity.PayEntity">
        select
            pay_id as payId,
            store_employee_id as storeEmployeeId,
            pay_type as payType,
            hourly_rate as hourlyRate,
            monthly_salary as monthlySalary,
            start_date as startDate,
            end_date as endDate
        from
            pay_tb
        where
            store_employee_id = #{storeEmployeeId}
            and
                start_date &lt;= #{asOf}
            and
                (end_date is null or end_date &gt;= #{asOf})
        order by start_date desc
        limit 1
    </select>

    <select id="findEffectivePolicy" resultType="com.korit.sa_one_back.entity.payroll.PayPolicyEntity">
        select
            pay_policy_id as payPolicyId,
            store_id as storeId,
            effective_from as effectiveFrom,
            effective_to as effectiveTo,
            is_active as active,
            weekly_allowance_yn as weeklyAllowanceYn,
            overtime_multiplier as overtimeMultiplier,
            night_multiplier as nightMultiplier,
            created_at as createdAt,
            updated_at as updatedAt
        from
            pay_policy_tb
        where
            store_id = #{storeId}
            and
                effective_from &lt;= #{asOf}
            and
                (effective_to is null or effective_to &gt;= #{asOf})
            and
                is_active = 1
        order by effective_from desc
        limit 1
    </select>
    <select id="findTaxRate" resultType="com.korit.sa_one_back.entity.payroll.TaxRateEntity">
        select
            income_tax_rate as incomeTaxRate,
            local_tax_rate as localTaxRate
        from
            tax_rate_tb
        where
            year = #{year}
        limit 1
    </select>
    <select id="findNationalPensionLimit" resultType="com.korit.sa_one_back.entity.payroll.LimitEntity">
        select
            lower_limit as lowerLimit,
            upper_limit as upperLimit
        from
            national_pension_limit_tb
        where
            year = #{year}
        limit 1
    </select>
    <select id="findHealthInsuranceLimit" resultType="com.korit.sa_one_back.entity.payroll.LimitEntity">
        select
            lower_limit as lowerLimit,
            upper_limit as upperLimit
        from
            health_insurance_limit_tb
        where
            year = #{year}
        limit 1
    </select>
    <select id="findInsuranceRate" resultType="com.korit.sa_one_back.entity.payroll.InsuranceRateEntity">
        select
            ir.total_rate as totalRate,
            ir.employee_rate as employeeRate,
            ir.employer_rate as employerRate,
            i.insurance_name as insuranceName
        from
            insurance_rate_tb as ir
        join
            insurance_tb as i
            on i.insurance_id = ir.insurance_id
        where
            ir.year = #{year}
            and
                i.insurance_code = #{insuranceCode}
        limit 1
    </select>
    <select id="findStoreBusinessInfo"
            resultType="com.korit.sa_one_back.entity.payroll.StoreBusinessInfoEntity">
        select
            store_business_info_id as storeBusinessInfoId,
            store_id as storeId,
            company_type as companyType,
            industry_code as industryCode,
            business_number as businessNumber,
            company_name as companyName,
            created_at as createdAt,
            updated_at as updatedAt
        from
            store_business_info_tb
        where
            store_id = #{storeId}
        limit 1
    </select>
    <select id="sumWeeklyAllowanceAmountInMonth" resultType="java.lang.Integer">
        select
            coalesce(sum(wa.allowance_amount),0)
        from
            weekly_allowance_tb as wa
        where
            wa.store_employee_id = #{storeEmployeeId}
            and
                wa.is_eligible = 1
            and
                wa.week_start_date &lt;= #{monthEnd}
            and
                wa.week_end_date &gt;= #{monthStart}
    </select>
    <select id="findPayrollItemIdByCode" resultType="java.lang.Long">
        select
            payroll_item_id
        from
            payroll_item_tb
        where
            item_code = #{itemCode}
        limit 1
    </select>
    <select id="findPayrollByYm" resultType="com.korit.sa_one_back.entity.payroll.PayrollEntity">
        select
            payroll_id as payrollId,
            store_employee_id as storeEmployeeId,
            payslip_year_month as payslipYearMonth,
            period_start as periodStart,
            period_end as periodEnd,
            pay_date as payDate,
            status as status,
            issued_at as issuedAt,
            confirmed_at as confirmedAt,

            weekly_allowance_yn as weeklyAllowanceYn,
            overtime_multiplier as overtimeMultiplier,
            night_multiplier as nightMultiplier,

            total_work_minutes as totalWorkMinutes,
            total_overtime_minutes as totalOvertimeMinutes,
            total_night_minutes as totalNightMinutes,

            gross_pay as grossPay,
            total_deduction as totalDeduction,
            net_pay as netPay,

            income_tax_rate as incomeTaxRate,
            local_tax_rate as localTaxRate,
            national_pension_rate as nationalPensionRate,
            health_insurance_rate as healthInsuranceRate,
            employment_insurance_rate as employmentInsuranceRate,

            industrial_accident_insurance as industrialAccidentInsurance,

            created_at as createdAt,
            updated_at as updatedAt
        from
            payroll_tb
        where
            store_employee_id = #{storeEmployeeId}
            and
                payslip_year_month = #{payslipYearMonth}
        limit 1
    </select>

    <insert id="insertPayroll" useGeneratedKeys="true" keyProperty="payrollId">
        insert into payroll_tb (
            store_employee_id,
            payslip_year_month,
            period_start,
            period_end,
            pay_date,
            status,
            issued_at,
            confirmed_at,
            weekly_allowance_yn,
            overtime_multiplier,
            night_multiplier,
            total_work_minutes,
            total_overtime_minutes,
            total_night_minutes,
            gross_pay,
            total_deduction,
            net_pay,
            income_tax_rate,
            local_tax_rate,
            national_pension_rate,
            health_insurance_rate,
            employment_insurance_rate,
            industrial_accident_insurance,
            created_at,
            updated_at
        ) values (
            #{storeEmployeeId},
            #{payslipYearMonth},
            #{periodStart},
            #{periodEnd},
            #{payDate},
            #{status},
            #{issuedAt},
            #{confirmedAt},
            #{weeklyAllowanceYn},
            #{overtimeMultiplier},
            #{nightMultiplier},
            #{totalWorkMinutes},
            #{totalOvertimeMinutes},
            #{totalNightMinutes},
            #{grossPay},
            #{totalDeduction},
            #{netPay},
            #{incomeTaxRate},
            #{localTaxRate},
            #{nationalPensionRate},
            #{healthInsuranceRate},
            #{employmentInsuranceRate},
            #{industrialAccidentInsurance},
            now(),
            now()
        )
    </insert>
    <insert id="insertPayrollDetails" parameterType="java.util.List">
        insert into payroll_detail_tb (
            payroll_id,
            payroll_item_id,
            amount,
            minutes,
            quantity,
            unit_price,
            multiplier,
            memo,
            updated_at
        )
        values
        <foreach collection="list" item="d" separator=",">
            (
                #{d.payrollId},
                #{d.payrollItemId},
                #{d.amount},
                #{d.minutes},
                #{d.quantity},
                #{d.unitPrice},
                #{d.multiplier},
                #{d.memo},
                now()
            )
        </foreach>
    </insert>
    <select id="findStoreEmployeePayrollByUserIdAndStoreId" resultType="com.korit.sa_one_back.entity.payroll.PayrollEntity">
        select
            store_employee_id
        from
            store_employee_tb
        where
            user_id = #{userId}
            and
                store_id = #{storeId}
        limit 1
    </select>

    <select id="findPayrollDetailsByPayrollId" resultType="com.korit.sa_one_back.entity.payroll.PayrollDetailEntity">
        select
            payroll_detail_id as payrollDetailId,
            payroll_id as payrollId,
            payroll_item_id as payrollItemId,
            amount,
            minutes,
            quantity,
            unit_price as unitPrice,
            multiplier,
            memo,
            updated_at as updatedAt
        from
            payroll_detail_tb
        where
            payroll_id = #{payrollId}
        order by payroll_detail_id asc
    </select>

    <select id="findPayrollItemCodeIdList" resultType="map">
        select
            item_code as itemCode,
            payroll_item_id as payrollItemId
        from
            payroll_item_tb
    </select>

    <select id="findPayrollListByStoreEmployeeId"
            resultType="com.korit.sa_one_back.entity.payroll.PayrollEntity">
        select
            payroll_id as payrollId,
            store_employee_id as storeEmployeeId,
            payslip_year_month as payslipYearMonth,
            period_start as periodStart,
            period_end as periodEnd,
            pay_date as payDate,
            status as status,
            gross_pay as grossPay,
            total_deduction as totalDeduction,
            net_pay as netPay,
            created_at as createdAt,
            updated_at as updatedAt
        from
            payroll_tb
        where
            store_employee_id = #{storeEmployeeId}
        order by payslip_year_month desc
    </select>

    <select id="findPayrollDetailViewByPayrollId"
            resultType="com.korit.sa_one_back.dto.response.payroll.PayrollDetailViewRespDto">
        select
            d.payroll_detail_id as payrollDetailId,
            d.payroll_id as payrollId,
            d.payroll_item_id as payrollItemId,
            i.item_name as itemName,
            i.item_type as itemType,
            i.taxable as taxable,
            d.amount as amount,
            d.minutes as minutes,
            d.unit_price as unitPrice,
            d.multiplier as multiplier,
            d.memo as memo
        from
            payroll_detail_tb d
        join
            payroll_item_tb i
        on
            i.payroll_item_id = d.payroll_item_id
        where
            d.payroll_id = #{payrollId}
        order by d.payroll_detail_id asc
    </select>
</mapper>

==================================================
FILE: src/main/resources/mapper/pay_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.PayMapper">

    <insert id="insertPay" useGeneratedKeys="true" keyProperty="payId">
        insert into pay_tb (
            pay_id,
            store_employee_id,
            pay_type,
            hourly_rate,
            monthly_salary,
            start_date,
            end_date,
            created_at,
            updated_at
        ) values (
            default,
            #{storeEmployeeId},
            #{payType},
            #{hourlyRate},
            #{monthlySalary},
            #{startDate},
            #{endDate},
            now(),
            now()
        )
    </insert>

    <!-- 퇴사 처리 시 현재 유효 급여 종료 -->
    <update id="closeCurrentPayByEmployee">
        update pay_tb
        set
        end_date = #{today},
        updated_at = now()
        where store_employee_id = #{storeEmployeeId}
        and not (start_date > #{today})
        and (end_date is null or end_date >= #{today})
    </update>


</mapper>


==================================================
FILE: src/main/resources/mapper/position_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.PositionMapper">

    <select id="findPositionIdByName" resultType="long">
        select position_id
        from position_tb
        where position_name = #{positionName}
        limit 1
    </select>

</mapper>

==================================================
FILE: src/main/resources/mapper/schedule_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.ScheduleMapper">

    <select id="countStoreEmployeeInStore" resultType="int">
        select count(*)
        from store_employee_tb
        where store_id = #{storeId}
        and store_employee_id = #{storeEmployeeId}
    </select>

    <select id="countScheduleInStore" resultType="int">
        select count(*)
        from schedule_tb sc
        join store_employee_tb se
        on se.store_employee_id = sc.store_employee_id
        where se.store_id = #{storeId}
        and sc.schedule_id = #{scheduleId}
    </select>

    <insert id="insertSchedule" useGeneratedKeys="true" keyProperty="scheduleId">
        insert into schedule_tb (
            schedule_id,
            store_employee_id,
            work_date,
            start_time,
            end_time,
            break_minutes,
            note,
            created_at,
            updated_at
        ) values (
            default,
            #{storeEmployeeId},
            #{workDate},
            #{startTime},
            #{endTime},
            #{breakMinutes},
            #{note},
            now(),
            now()
        )
    </insert>

    <update id="updateSchedule">
        update schedule_tb
        set
            work_date = #{workDate},
            start_time = #{startTime},
            end_time = #{endTime},
            break_minutes = #{breakMinutes},
            note = #{note},
        updated_at = now()
        where schedule_id = #{scheduleId}
    </update>

    <delete id="deleteSchedule">
        delete from schedule_tb
        where schedule_id = #{scheduleId}
    </delete>

</mapper>


==================================================
FILE: src/main/resources/mapper/store_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.StoreMapper">

    <insert id="insertStore" useGeneratedKeys="true" keyProperty="storeId">
        insert into store_tb (
            store_id,
            store_name,
            address,
            business_number,
            owner_name,
            store_phone,
            created_at,
            updated_at,
            user_id
        )
        values(
            default,
            #{storeName},
            #{address},
            #{businessNumber},
            #{ownerName},
            #{storePhone},
            now(),
            now(),
            #{userId}
        )
    </insert>
  
    <insert id="insertStoreApplication">
        insert into store_application_tb (
            store_application_id,
            store_name,
            address,
            business_number,
            owner_name,
            store_phone,
            status,
            reject_reason,
            reviewed_at,
            created_at,
            user_id
        ) values (
            default,
            #{storeName},
            #{address},
            #{businessNumber},
            #{ownerName},
            #{storePhone},
            default,
            null,
            null,
            now(),
            #{userId}
        )

    </insert>
  
    <update id="updateApplicationStatus">
        update
            store_application_tb
        set
            status = #{status},
            reviewed_at = #{reviewedAt},
            reject_reason = #{rejectReason},
            updated_at = now()
        where
            store_application_id = #{storeApplicationId}
    </update>
  
    <select id="selectByUserId" resultType="com.korit.sa_one_back.entity.StoreApplicationEntity">
        select
            *
        from
            store_application_tb
        where
            user_id = #{userId}
    </select>

    <select id="selectByApplicationIdForAdmin" resultType="com.korit.sa_one_back.entity.StoreApplicationEntity">
        select
            *
        from
            store_application_tb
        where
            store_application_id = #{storeApplicationId}
    </select>

    <select id="countByStoreId" resultType="int">
        select count(*)
        from store_tb
        where store_id = #{storeId}
    </select>

    <select id="findOwnerUserId" resultType="long">
        select user_id
        from store_tb
        where store_id = #{storeId}
        limit 1
    </select>

    <select id="findMyStoresByUserId" parameterType="long" resultType="com.korit.sa_one_back.entity.MyStoreEntity">
        select distinct
            s.store_id as storeId,
            s.store_name,
            s.address as address
        from
            store_employee_tb se
        join
            store_tb s
        on
            s.store_id = se.store_id
        where
            se.user_id = #{userId}
            and
                se.work_status = 'WORKING'
        order by s.store_id asc
    </select>
    <select id="findOwnerStoresByUserId"
            parameterType="long"
            resultType="com.korit.sa_one_back.entity.MyStoreEntity">
        select
            store_id as storeId,
            store_name as storeName,
            address as address
        from
            store_tb
        where
            user_id = #{userId}
        order by store_id asc
    </select>

    <select id="countEmployeeInStoreByUserId" resultType="int">
        select count(*)
        from store_employee_tb
        where store_id = #{storeId}
        and user_id = #{userId}
        and work_status = 'WORKING'
    </select>

    <select id="findStoreName" resultType="string">
        select store_name
        from store_tb
        where store_id = #{storeId}
        limit 1
    </select>

</mapper>


==================================================
FILE: src/main/resources/mapper/user_mapper.xml
==================================================

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.korit.sa_one_back.mapper.UserMapper">

    <insert id="insertLocalUser" useGeneratedKeys="true" keyProperty="userId">
        insert into user_tb(
            user_id,
            username,
            password,
            oauth2_id,
            provider,
            name,
            phone,
            email,
            img_url,
            img_path,
            role_id,
            created_at,
            updated_at,
            gender,
            birth_date,
            is_deleted,
            address
        ) values (
            default,
            #{username},
            #{password},
            #{oauth2Id},
            #{provider},
            #{name},
            #{phone},
            #{email},
            #{imgUrl},
            #{imgPath},
            #{roleId},
            now(),
            now(),
            #{gender},
            #{birthDate},
            default,
            #{address}
        )
    </insert>
    <insert id="insertOauth2User" useGeneratedKeys="true" keyProperty="userId">
        insert into user_tb(
            user_id,
            username,
            password,
            oauth2_id,
            provider,
            name,
            phone,
            email,
            img_url,
            img_path,
            role_id,
            created_at,
            updated_at,
            gender,
            birth_date,
            is_deleted,
            address
        ) values (
            default,
            #{username},
            #{password},
            #{name},
            #{phone},
            #{email},
            #{imgUrl},
            #{imgPath},
            #{oauth2Id},
            #{provider},
            #{roleId},
            now(),
            now(),
            #{gender},
            #{birthDate},
            default,
            #{address}
        )
    </insert>

    <update id="softDelete">
        update
            user_tb
        set
            is_deleted = true,
            deleted_at = now(),
            updated_at = now()
        where
            user_id = #{userId}
            and is_deleted = false
    </update>

    <select id="findByUserId" resultType="com.korit.sa_one_back.entity.UserEntity">
        select
            *
        from
            user_tb
        where
            user_id = #{userId}
        and
            is_deleted = false
    </select>

    <select id="findByEmail" resultType="com.korit.sa_one_back.entity.UserEntity">
        select
            *
        from
            user_tb
        where
            email = #{email}
        and
            is_deleted = false
    </select>

    <select id="findByOauth2IdAndProvider" resultType="com.korit.sa_one_back.entity.UserEntity">
        select
            *
        from
            user_tb
        where
            oauth2_id = #{oauth2Id}
        and
            provider = #{provider}
        and
            is_deleted = false
    </select>
    <select id="findUserByUsername" resultType="com.korit.sa_one_back.entity.UserEntity">
        select
            user_id,
            username,
            password,
            oauth2_id,
            provider,
            name,
            phone,
            email,
            img_url,
            img_path,
            role_id,
            created_at,
            updated_at,
            gender,
            birth_date,
            address
        from
            user_tb
        where
            username = #{username}
        and
            is_deleted = false
    </select>

    <select id="findRoleNameByUserId" resultType="string">
        select
            rt.role_name
        from
            user_tb ut
        join
            role_tb rt on rt.role_id = ut.role_id
        where
            ut.user_id = #{userId}
    </select>

    <update id="updateMyPage">
        update user_tb
        <set>
            <if test="email != null and email != ''">
                email = #{email},
            </if>
            <if test="phone != null and phone != ''">
                phone = #{phone},
            </if>
            <if test="imgUrl != null and imgUrl != ''">
                img_url = #{imgUrl},
            </if>
            <if test="dto.address != null and dto.address != ''">
                address = #{address},
            </if>
        </set>
        where user_id = #{userId}
    </update>

    <select id="findUserIdByEmail" resultType="java.lang.Long">
        select
            user_id
        from
            user_tb
        where
            email = #{email}
        and
            is_deleted = false
        limit 1
    </select>

    <update id="updateEmployeeProfile">
        update user_tb
        <set>
            <if test="dto.name != null and dto.name != ''">
                name = #{dto.name},
            </if>
            <if test="dto.phone != null and dto.phone != ''">
                phone = #{dto.phone},
            </if>
            <if test="dto.imgUrl != null and dto.imgUrl != ''">
                img_url = #{dto.imgUrl},
            </if>
            <if test="dto.imgPath != null and dto.imgPath != ''">
                img_path = #{dto.imgPath},
            </if>
            <if test="dto.birthDate != null">
                birth_date = #{dto.birthDate},
            </if>
            <if test="dto.address != null and dto.address != ''">
                address = #{dto.address},
            </if>
        </set>
        where
            user_id = #{userId}
        and
            is_deleted = false
    </update>

    <select id="findUsernameByNameAndEmail" resultType="string">
        select
            username
        from
            user_tb
        where
            name = #{name}
        and
            email = #{email}
        and
            is_deleted = 0
        limit 1
    </select>

    <update id="updatePassword">
        update
            user_tb
        set
            password = #{password},
            updated_at = now()
        where
            user_id = #{userId}
        and
            is_deleted = false
    </update>

    <select id="findRoleIdByUserId" resultType="int">
        select
        role_id
        from
        user_tb
        where
        user_id = #{userId}
    </select>

</mapper>

==================================================
FILE: src/test/java/com/korit/sa_one_back/SaOneBackApplicationTests.java
==================================================

package com.korit.sa_one_back;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class SaOneBackApplicationTests {

    @Test
    void contextLoads() {
    }

}
